---
title: Аварийное восстановление обозреватель данных Azure и непрерывность бизнес-процессов
description: В этой статье описываются возможности обозреватель данных Azure по восстановлению из событий аварийного восстановления.
author: orspod
ms.author: orspodek
ms.reviewer: ankhanol
ms.service: data-explorer
ms.topic: conceptual
ms.date: 08/05/2020
ms.openlocfilehash: 2dcb1fb83d592ff7fd81fcfc5f51cf6fc95254b7
ms.sourcegitcommit: a36981785765b85a961f275be24d297d38e498fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/30/2020
ms.locfileid: "96310040"
---
# <a name="business-continuity-and-disaster-recovery-overview"></a>Обзор непрерывности бизнес-процессов и аварийного восстановления

Непрерывность бизнес-процессов и аварийное восстановление в Azure обозреватель данных позволяет бизнесу продолжать работу в случае нарушения работы. В этой статье рассматривается доступность (внутри региона) и аварийное восстановление. В нем подробно описаны собственные возможности и рекомендации по архитектуре для отказоустойчивого развертывания Azure обозреватель данных. В ИТ подробно описывается восстановление после ошибок человека, высокий уровень доступности, а также несколько конфигураций аварийного восстановления. Эти конфигурации зависят от требований к устойчивости, таких как Целевая точка восстановления (RPO) и целевое время восстановления (RTO), требуемые усилия и затраты.

## <a name="mitigate-disruptive-events"></a>Устранение нарушений событий

* [Человеческий сбой](#human-error)
* [Высокий уровень доступности обозреватель данных Azure](#high-availability-of-azure-data-explorer)
* [Сбой зоны доступности Azure](#outage-of-an-azure-availability-zone)
* [Сбой центра обработки данных Azure](#outage-of-an-azure-datacenter)
* [Сбой в регионе Azure](#outage-of-an-azure-region)

### <a name="human-error"></a>Человеческий сбой 

Человеческие ошибки неизбежны. Пользователи могут случайно удалить кластер, базу данных или таблицу.  

#### <a name="accidental-cluster-or-database-deletion"></a>Удаление случайного кластера или базы данных

Случайное удаление кластера или базы данных является действием Неустранимая. Как владелец ресурса Azure обозреватель данных вы можете предотвратить потери данных, включив функцию [блокировки](/azure/azure-resource-manager/management/lock-resources) удаления, доступную на уровне ресурсов Azure.

#### <a name="accidental-table-deletion"></a>Случайное удаление таблицы

Пользователям с разрешениями администратора таблиц или выше разрешено [удалять таблицы](kusto/management/drop-table-command.md). Если один из этих пользователей случайно удалит таблицу, ее можно восстановить с помощью [`.undo drop table`](kusto/management/undo-drop-table-command.md) команды. Для успешного выполнения этой команды необходимо сначала включить свойство *восстанавливаемости* в [политике хранения](kusto/management/retentionpolicy.md).

#### <a name="accidental-external-table-deletion"></a>Удаление случайной внешней таблицы

[Внешние таблицы](kusto/query/schema-entities/externaltables.md) — это Kusto сущности схемы запросов, которые ссылаются на данные, хранящиеся за пределами базы данных. При удалении внешней таблицы удаляются только метаданные таблицы. Его можно восстановить, повторно выполнив команду создания таблицы. Используйте функцию [обратимого удаления](/azure/storage/blobs/storage-blob-soft-delete) , чтобы защититься от случайного удаления или перезаписи файла или большого двоичного объекта на заданный пользователем период времени.

### <a name="high-availability-of-azure-data-explorer"></a>Высокий уровень доступности обозреватель данных Azure

Высокий уровень доступности относится к отказоустойчивости обозреватель данных Azure, ее компонентам и базовым зависимостям в регионе Azure. Эта отказоустойчивость позволяет избежать единой точки отказа (SPOF) в реализации. В обозреватель данных Azure высокая доступность включает уровень сохраняемости, уровень вычислений и конфигурацию заполнения.

#### <a name="persistence-layer"></a>Уровень сохраняемости

Azure обозреватель данных использует хранилище Azure в качестве устойчивого уровня сохраняемости. Служба хранилища Azure автоматически обеспечивает отказоустойчивость с помощью параметра по умолчанию, который предлагает локально избыточное хранилище (LRS) в центре обработки данных. Сохраняются три реплики. Если во время использования реплика теряется, другая развертывается без прерывания работы. Дополнительная устойчивость возможна благодаря избыточному хранению в пределах зоны, в рамках которого реплики распределяются по регионам региональных зон доступности Azure для обеспечения максимальной отказоустойчивости за дополнительную плату.

#### <a name="compute-layer"></a>Уровень вычислений

Обозреватель данных Azure — это распределенная вычислительная платформа, которая может иметь от двух до многих узлов в зависимости от масштаба и типа роли узла. Во время инициализации выберите зоны доступности, чтобы распространить развертывание узла, в зонах для максимальной устойчивости в пределах региона. Сбой зоны доступности не приведет к полному сбою, а снижает производительность до восстановления зоны. 

#### <a name="leader-follower-cluster-configuration"></a>Конфигурация кластера-заполнителя

Azure обозреватель данных предоставляет дополнительную [возможность](follower.md) для получения доступа к данным и метаданным лидера, а также другим кластерам для чтения. Изменения в лидере, такие как `create` , `append` и, `drop` автоматически синхронизируются со следующим. В то время как лидеры могут охватывать регионы Azure, кластеры-следи должны размещаться в тех же регионах, что и лидер. Если кластер-лидер не работает или базы данных или таблицы случайно отбрасываются, они теряют доступ, пока доступ не будет восстановлен в лидере. 

### <a name="outage-of-an-azure-availability-zone"></a>Сбой зоны доступности Azure

Зоны доступности Azure — это уникальные физические расположения в одном регионе Azure. Они могут защищать вычисление и данные кластера Azure обозреватель данных в результате сбоя частичного региона. Сбой зоны является сценарием доступности, так как он находится внутри региона. 

Закрепите кластер обозреватель данных Azure в той же зоне, что и другие подключенные ресурсы Azure. Дополнительные сведения о включении зон доступности см. в разделе [Создание кластера](create-cluster-database-portal.md#create-a-cluster).

> [!NOTE] 
> Выбор зоны доступности поддерживается только во время создания кластера и не может быть изменен позже.

### <a name="outage-of-an-azure-datacenter"></a>Сбой центра обработки данных Azure

За зоны доступности Azure поступают затраты, и некоторые клиенты выбирают развертывание без избыточности зональные. Если такое развертывание Azure обозреватель данных, сбой в работе центра обработки данных Azure приведет к сбою кластера. Обработка непростоя центра обработки данных Azure, таким образом, идентична сбоям в регионе Azure.

### <a name="outage-of-an-azure-region"></a>Сбой в регионе Azure

Azure обозреватель данных не обеспечивает автоматическую защиту в случае сбоя всего региона Azure. Чтобы уменьшить влияние на бизнес в случае сбоя, несколько кластеров Azure обозреватель данных в [парных регионах Azure](/azure/best-practices-availability-paired-regions). В зависимости от целевого значения времени восстановления (RTO), цели точки восстановления (RPO), а также соображений усилий и затрат существует [несколько конфигураций аварийного восстановления](#disaster-recovery-configurations). Оптимизация затрат и производительности возможна с помощью рекомендаций помощника по Azure и конфигурации [автомасштабирования](manage-cluster-horizontal-scaling.md) .

## <a name="disaster-recovery-configurations"></a>Конфигурации аварийного восстановления

 В этом разделе описаны несколько конфигураций аварийного восстановления в зависимости от требований к устойчивости (RPO и RTO), необходимых усилий и затрат.

Целевое время восстановления (RTO) означает время восстановления после прерывания. Например, RTO в 2 часа означает, что приложение должно быть работоспособным и работающим в течение двух часов перерыва. Целевая точка восстановления (RPO) — это интервал времени, который может пройти во время прерывания, по истечении которого количество потерянных данных в течение этого периода превысит допустимое пороговое значение. Например, если значение RPO равно 24 часам, а приложение имеет данные, начиная с 15 лет назад, они все еще находятся в параметрах согласованной RPO.

Процессы приема, обработки и контроль требуют тщательного проектирования при планировании аварийного восстановления. Прием относится к данным, интегрированным в Azure обозреватель данных из различных источников. Обработка относится к преобразованиям и аналогичным действиям; контроль относится к материализованным представлениям, экспорту в Data Lake и т. д.

Ниже приведены популярные конфигурации аварийного восстановления, которые подробно описаны ниже.
* [Конфигурация "активный — активный — активный" (Always-on)](#active-active-active-configuration)
* [Конфигурация "активный — активный"](#active-active-configuration)
* [Активная резервная конфигурация](#active-hot-standby-configuration)
* [Конфигурация кластера восстановления данных по требованию](#on-demand-data-recovery-configuration)

### <a name="active-active-active-configuration"></a>Конфигурация "активный — активный — активный"

Эта конфигурация также называется Always-on. Для критических развертываний приложений без отклонения для простоев следует использовать несколько кластеров Azure обозреватель данных в парных регионах Azure. Настройка приема, обработки и контроль параллельно для всех кластеров. Номер SKU кластера должен быть одинаковым в разных регионах. Azure обеспечит развертывание и свертывание обновлений в парных регионах Azure. Отключение региона Azure не приведет к сбою приложения. Может возникать задержка или снижение производительности.

:::image type="content" source="media/business-continuity-overview/active-active-active-n.png" alt-text="Конфигурация &quot;активный — активный — активный-n&quot;":::

| **Конфигурация** | **RPO** | **RTO** | **Определенных** | **Стоимость** |
| --- | --- | --- | --- | --- |
| **"Активный — активный — активный"-n** | 0 часов | 0 часов | Ниже | Наивысшая |

### <a name="active-active-configuration"></a>Конфигурация Active-Active

Эта конфигурация идентична конфигурации " [активный — активный — активный](#active-active-active-configuration)", но включает только два парных региона Azure. Настройка двойного приема, обработки и контроль. Пользователи направляются в ближайший регион. Номер SKU кластера должен быть одинаковым в разных регионах.

:::image type="content" source="media/business-continuity-overview/active-active.png" alt-text="Конфигурация &quot;активный — активный&quot;":::

| **Конфигурация** | **RPO** | **RTO** | **Определенных** | **Стоимость** |
| --- | --- | --- | --- | --- |
| **Активный — активный** | Нет | Нет | Ниже | Высокий |

### <a name="active-hot-standby-configuration"></a>Конфигурация Active-Hot Standby

Конфигурация Active-Hot аналогична конфигурации " [активный — активный](#active-active-configuration) " в двойном приеме, обработке и контроль. Однако резервный кластер находится в автономном режиме для конечных пользователей и не должен находиться в том же номере SKU, что и первичный. Кластер с горячей заменой может также иметь меньший номер SKU и масштаб, и, таким образом, это менее производительное. В случае аварии резервный кластер переводится в режим «в сети» и масштабируется.

:::image type="content" source="media/business-continuity-overview/active-hot-standby.png" alt-text="Активная резервная конфигурация":::

| **Конфигурация** | **RPO** | **RTO** | **Определенных** | **Стоимость** |
| --- | --- | --- | --- | --- |
| **Режим "активный — горячий"** | Низкий | Низкий | Средн. | Средн. |

### <a name="on-demand-data-recovery-configuration"></a>Конфигурация восстановления данных по запросу

Это решение обеспечивает наименьшую устойчивость (самое высокое значение RPO и RTO), является наименьшей стоимостью и максимальным объемом усилий. В этой конфигурации кластер восстановления данных отсутствует. Настройте непрерывный экспорт проверенных данных (если не требуются необработанные и промежуточные данные) в учетную запись хранения, настроенную GRS (геоизбыточное хранилище). Кластер восстановления данных отображается при наличии сценария аварийного восстановления. В это время применяются означающего, конфигурация, политики и процессы. Данные принимаются из хранилища с помощью свойства приема [кустокреатионтиме](ingest-data-event-grid-overview.md) для чрезмерного перебора времени приема, которое по умолчанию имеет системное время. 

:::image type="content" source="media/business-continuity-overview/on-demand-data-recovery-cluster.png" alt-text="Конфигурация кластера восстановления данных по требованию":::

| **Конфигурация** | **RPO** | **RTO** | **Определенных** | **Стоимость** |
| --- | --- | --- | --- | --- |
| **Кластер восстановления данных по требованию** | Наивысшая | Наивысшая | Наивысшая | Наименьшая |

### <a name="summary-of-disaster-recovery-configuration-options"></a>Сводка параметров конфигурации аварийного восстановления

| **Конфигурация** | **Устойчивость** | **RPO** | **RTO** | **Определенных** | **Стоимость** |
| --- | --- | --- | --- | --- | --- |
| **"Активный — активный — активный"-n** | Наивысшая | 0 часов | 0 часов | Ниже | Наивысшая |
| **Активный — активный** | Высокий | Нет | Нет | Ниже | Высокий |
| **Режим "активный — горячий"** | Средний | Низкий | Низкий | Средн. | Средн. |
| **Кластер восстановления данных по требованию** | Наименьшая | Наивысшая | Наивысшая | Наивысшая | Наименьшая |

## <a name="best-practices"></a>Рекомендации

Независимо от выбранной конфигурации аварийного восстановления следуйте приведенным ниже рекомендациям.

* Все объекты, политики и конфигурации базы данных должны быть сохранены в системе управления версиями, чтобы их можно было освободить в кластере из средства автоматизации выпуска. Дополнительные сведения см. в статье [Поддержка Azure DevOps для azure обозреватель данных](devops.md). 
* Разрабатывайте, создавайте и реализуйте подпрограммы проверки, чтобы обеспечить синхронизацию всех кластеров с точки зрения данных. Azure обозреватель данных поддерживает [объединение между кластерами](kusto/query/cross-cluster-or-database-queries.md?pivots=azuredataexplorer). Можно проверить простое количество или строки в таблицах.
* Используйте функцию [непрерывного экспорта](kusto/management/data-export/continuous-data-export.md) и экспортируйте данные в обозреватель данных таблицы Azure в хранилище Azure Data Lake. Убедитесь, что выбор GRS для наивысшей устойчивости.
* Процедуры выпуска должны содержать проверки и балансы, обеспечивающие зеркальное отображение кластеров.
* Будьте полностью компания cognizant, что требуется для создания кластера с нуля.
* Создайте контрольный список единиц развертывания. Ваш список будет уникальным для ваших потребностей, но должен включать: сценарии развертывания, подключения приема, средства бизнес-аналитики и другие важные конфигурации. 

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в статье [Создание решений по обеспечению непрерывности бизнес-процессов и аварийного восстановления с помощью Azure обозреватель данных](business-continuity-create-solution.md).

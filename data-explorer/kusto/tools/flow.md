---
title: Microsoft Flow Azure Kusto Connector Connector Connector (Предварительный просмотр) - Исследователь данных Azure (фото) Документы Майкрософт
description: В этой статье описывается Microsoft Flow Azure Kusto Connector (Preview) в Azure Data Explorer.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 04/15/2019
ms.openlocfilehash: c4e732afb9e6165f803b9dc7e801b4e2be4c2588
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81504103"
---
# <a name="microsoft-flow-azure-kusto-connector-preview"></a>Microsoft Flow Azure Kusto Connector (Предварительный просмотр)

Разъем Microsoft Flow Azure Kusto позволяет пользователям автоматически запускать запросы и команды Kusto в рамках запланированной или срабатывающей задачи с помощью [Microsoft Flow.](https://flow.microsoft.com/)

Общие сценарии использования включают в себя:

* Отправка ежедневных отчетов, содержащих таблицы и диаграммы
* Настройка уведомлений на основе результатов запроса
* Команды управления планированием кластеров
* Экспорт и импорт данных между Azure Data Explorer и другими базами данных 

## <a name="limitations"></a>Ограничения

1. Результаты, возвращенные клиенту, ограничены 500 000 записей. Общая память этих записей не может превышать 64 МБ и 7 минут времени выполнения.
2. В настоящее время разъем не поддерживает операторы [вилки](../query/forkoperator.md) и [граней.](../query/facetoperator.md)
3. Поток лучше всего работает на Internet Explorer и Chrome.

##  <a name="login"></a>Имя входа 

1. Войти в [Microsoft Flow](https://flow.microsoft.com/).

1. При первом подключении к разъему Azure Kusto вам будет предложено войти в систему.

1. Нажмите на кнопку **«Знак в»** и введите учетные данные, чтобы начать использовать Azure Kusto Flow.

![альт текст](./Images/KustoTools-Flow/flow-signin.png "поток-сигнин")

## <a name="authentication"></a>Аутентификация

Проверка подлинности на разъемazе Kusto Flow может быть выполнена с помощью учетных данных пользователей или приложения AAD.



### <a name="aad-application-authentication"></a>Аутентификация приложений AAD

Вы можете проверить подлинность в Azure Kusto Flow с помощью приложения AAD, используя следующие действия:

> Примечание: Убедитесь, что приложение является [приложением AAD](../management/access-control/how-to-provision-aad-app.md) и уполномочено выполнять запросы в кластере.

1. Нажмите на три точки в правом верхнем ряде разъема Azure Kusto: ![альт-текст](./Images/KustoTools-Flow/flow-addconnection.png "соединение потока-добавления")

1. Выберите "Добавить новое соединение", а затем нажмите на кнопку "Связь с директором службы".
![альт текст](./Images/KustoTools-Flow/flow-signin.png "поток-сигнин")

1. Заполните идентификатор приложения, ключ приложения и идентификатор клиента.

Например, идентификатор арендатора Майкрософт: 72f988bf-86f1-41af-91ab-2d7cd011db47.
Значение значения названия соединения — это строка вашего выбора, предназначенная для распознавания добавленного нового соединения.
![альт текст](./Images/KustoTools-Flow/flow-appauth.png "поток-аппаут")

Как только проверка подлинности будет завершена, вы сможете увидеть, что ваш поток использует добавленное новое соединение.
![альт текст](./Images/KustoTools-Flow/flow-appauthcomplete.png "поток-аппаупол")

Отныне этот поток будет работать с использованием учетных данных приложения.

## <a name="find-the-azure-kusto-connector"></a>Найти разъем Azure Kusto

Для использования разъема Azure Kusto необходимо сначала добавить триггер. Триггер может быть определен на основе повторяющихся период овсяных временилий или как ответ на предыдущее действие потока.

1. [Создайте новый поток.](https://flow.microsoft.com/manage/flows/new)
2. В качестве первого шага добавьте «Расписание – повторение».
3. Введите 'Azure Kusto' в поле поиска второго шага.

Теперь вы должны иметь возможность видеть 'Azure Kusto', как показано на рисунке ниже.

![альт текст](./Images/KustoTools-Flow/flow-actions.png "поток действия")

## <a name="azure-kusto-flow-actions"></a>Действия потока Azure Kusto

При поиске разъема Azure Kusto в Потоке вы увидите 3 возможных действия, которые можно добавить в поток.

В следующем разделе описаны возможности и параметры для каждого действия Azure Kusto Flow.

![альт текст](./Images/KustoTools-Flow/flow-actions.png "поток действия")

### <a name="azure-kusto---run-query-and-visualize-results"></a>Azure Kusto - Выполнить запрос и визуализировать результаты

> Примечание: Если ваш запрос начинается с точки (имеется в виду, что это [команда управления),](../management/index.md)пожалуйста, используйте [команду управления Run и визуализировать результаты](./flow.md#azure-kusto---run-control-command-and-visualize-results)

Чтобы визуализировать результат запроса Kusto как таблицу или диаграмму, можно использовать действие «Azure Kusto - Run» и визуализировать результаты. Результаты этого действия могут быть позже отправлены по электронной почте. Этот поток можно использовать, например, в случае, если вы хотите получать ежедневные отчеты ICM. 

![альт текст](./Images/KustoTools-Flow/flow-runquery.png "поток-runquery")

В этом примере результаты запроса возвращаются в виде таблицы HTML.

### <a name="azure-kusto---run-control-command-and-visualize-results"></a>Azure Kusto - Управление командой управления и визуализация результатов

Подобно действию «Azure Kusto - Run' и визуализировать результаты», вы также можете запустить [команду управления](../management/index.md) с помощью команды управления Azure Kusto - Run и визуализировать результаты.
Результаты этого действия могут быть позже отправлены по электронной почте в виде таблицы или диаграммы.

![альт текст](./Images/KustoTools-Flow/flow-runcontrolcommand.png "управление потоком")

В этом примере результаты команды управления отображаются как круговая диаграмма.

### <a name="azure-kusto---run-query-and-list-results"></a>Azure Kusto - Выполнить запрос и список результатов

> Примечание: В случае, если ваш запрос начинается с точки (имеется в виду, что это [команда управления),](../management/index.md)пожалуйста, используйте [команду управления Run и визуализировать результаты](./flow.md#azure-kusto---run-control-command-and-visualize-results)

Это действие отправляет запрос в кластер Kusto. Действия, которые добавляются после этого итерации по каждой строке результатов запроса.

Следующий пример запускает запрос каждую минуту и отправляет электронное письмо на основе результатов запроса. Запрос проверяет количество строк в базе данных, а затем отправляет электронное письмо только в том случае, если количество строк превышает 0. 

![альт текст](./Images/KustoTools-Flow/flow-runquerylistresults.png "поток-runquerylistresults")

Обратите внимание, что в случае, если столбец имеет несколько строк, следующий разъем будет работать для каждой строки в столбце.

## <a name="email-kusto-query-results"></a>Результаты запроса Kusto по электронной почте

Для отправки сообщений по электронной почте сделайте следующие шаги: 

![альт текст](./Images/KustoTools-Flow/flow-sendemail.png "поток-отправитьэлектронное письмо")

1. Нажмите кнопку «Новый шаг», а затем «Добавить действие».
2. В поле поиска введите 'Office 365 Outlook - Отправить электронное письмо'.
3. Установите 'To' на свой адрес электронной почты, 'Subject' к некоторому тексту, и добавьте 'Тело' от динамического содержания к поле 'Тела'.
4. Нажмите кнопку «Расширенные опции», добавляя «Имя присоединения» в поле «Имя присоединения», «Содержимое присоединения» к полю «Приложения содержимого» и убедитесь, что «HTML» настроен на «Да».
5. В верхней панели установите «Имя потока» для этого потока.
6. Нажмите кнопку "Создать поток", и вы сделали!

## <a name="how-to-make-sure-flow-succeeded"></a>Как убедиться, что поток удалось?

Перейдите на [домашнюю страницу Microsoft Flow,](https://flow.microsoft.com/)нажмите на [Мои потоки,](https://flow.microsoft.com/manage/flows) а затем нажмите на кнопку i.

![альт текст](./Images/KustoTools-Flow/flow-myflows.png "поток-мипоток")

Все запуски потока перечислены со статусом, временем и продолжительностью запуска.

![альт текст](./Images/KustoTools-Flow/flow-runs.png "потоковых запусков")

При открытии последнего запуска потока, если все шаги потока отмечены зеленым V, то поток закончился успешно.
В противном случае расширьте шаг, который был отмечен красным восклицательным знаком для просмотра деталей ошибки.

![альт текст](./Images/KustoTools-Flow/flow-failed.png "поток не удалось")

Некоторые ошибки можно легко решить самостоятельно, например ошибки синтаксиса запроса:

![альт текст](./Images/KustoTools-Flow/flow-syntaxerror.png "поток-синтаксис")



## <a name="having-a-timeout-exception"></a>Имея исключение тайм-аут?

Ваш поток может выйти из строя и вернуть исключение "RequestTimeout", если он работает более 7 минут.

Обратите внимание, что 7 минут — это максимальный запрос потока времени, который может быть запущен до того, как будет сделано исключение тайм-аута.

[Нажмите здесь,](#limitations) чтобы увидеть ограничения потока Майкрософт.

Тот же запрос может успешно работать в Kusto Explorer, где время не ограничено и может быть изменено.

Исключение "RequestTimeout" отображается на рисунке ниже:

![альт текст](./Images/KustoTools-Flow/flow-requesttimeout.png "flow-requesttimeout")

Чтобы устранить проблему, вы можете выполнить следующие действия:
1. Узнайте больше о [рекомендациях по запросу](../query/best-practices.md).
2. Попробуйте сделать запрос более эффективным, чтобы сделать его более быстрым, или разделить его на куски, каждый кусок может работать на другой части запроса.

## <a name="usage-examples"></a>Примеры использования

Этот раздел содержит несколько общих примеров использования разъема Azure Kusto Flow.

### <a name="example-1---azure-kusto-flow-and-sql"></a>Пример 1 - Поток Лазурного Кусто и СЗЛ

Для запроса данных можно использовать поток Azure Kusto, а затем аккумулировать их в DB. 
> Примечание: Вставка S'L делается строго в строке, пожалуйста, используйте это только для низких объемов выходных данных. 

![альт текст](./Images/KustoTools-Flow/flow-sqlexample.png "поток-кв-пример")

### <a name="example-2---push-data-to-power-bi-dataset"></a>Пример 2 - Нажмите данные на набор данных Power BI

Разъем Azure Kusto Flow можно использовать вместе с разъемом Power BI для передачи данных из запросов Kusto в наборы потоковых данных Power BI.

Для начала создайте новое действие "Kusto - Run query and list results".

![альт текст](./Images/KustoTools-Flow/flow-listresults.png "поток-списокрезультаты")

Нажмите на кнопку "Новый шаг", выберите "Добавить действие" и поиск "Power BI". Нажмите на кнопку "Power BI - Добавление строк в набор данных". 

![альт текст](./Images/KustoTools-Flow/flow-powerbiconnector.png "поток-силовойбиконнектор")

Заполните рабочее пространство, набор данных и таблицу, в которую будут пересытаны данные.
Добавьте полезную нагрузку, содержащую схему набора данных и соответствующие результаты запроса Kusto из окна динамического содержимого. 

![альт текст](./Images/KustoTools-Flow/flow-powerbifields.png "поток-powerbifields")

Обратите внимание, что Flow будет автоматически применять действие Power BI для каждой строки таблицы результатов запроса Kusto. 

![альт текст](./Images/KustoTools-Flow/flow-powerbiforeach.png "поток-powerbiforeach")

### <a name="example-3---conditional-queries"></a>Пример 3 - Условные запросы

Результаты запросов Kusto могут быть использованы в качестве ввода или условий для следующих действий Потока.

В следующем примере мы запросим Kusto для инцидентов, произошедших в последний день. Для каждого разрешенного инцидента мы публикуем сообщение о нем и создаем push-уведомление.
Для каждого инцидента, который все еще активен, мы запросим Kusto для получения дополнительной информации о подобных инцидентах, отправляем эту информацию по электронной почте и открываем связанную задачу TFS.

Следуйте этим инструкциям, чтобы создать аналогичный поток.

Создайте новое действие «Kusto - Run-запрос и список результатов».
Нажмите на кнопку "Новый шаг" и выберите "Добавить условие" 

![альт текст](./Images/KustoTools-Flow/flow-listresults.png "поток-списокрезультаты")

Выберите из окна динамического содержимого параметр, который вы хотите использовать в качестве условия для следующих действий.
Выберите тип отношения и значение, чтобы установить определенное условие по данному параметру.

![альт текст](./Images/KustoTools-Flow/flow-condition.png "условия потока")

Обратите внимание, что Flow будет применять это условие к каждой строке таблицы результатов запроса.

Добавляйте действия, когда условие верно и ложно.

![альт текст](./Images/KustoTools-Flow/flow-conditionactions.png "условия потока")

Значения результатов из запроса Kusto можно использовать в качестве ввода для следующих действий, выбрав их из окна динамического содержимого.
Ниже мы добавили действие "Slack - Post Message" и "Visual Studio - Создание нового элемента работы", содержащего данные из запроса Kusto.

![альт текст](./Images/KustoTools-Flow/flow-slack.png "поток-слабину")

![альт текст](./Images/KustoTools-Flow/flow-visualstudio.png "поток-визуалостудия")

В этом примере, если инцидент все еще активен, мы снова запросим Kusto, чтобы получить информацию о том, как инциденты из того же источника были решены в прошлом.

![альт текст](./Images/KustoTools-Flow/flow-conditionquery.png "поток-условие")

Мы визуализировать эту информацию как круговую диаграмму и отправим ее по электронной почте нашей команде.

![альт текст](./Images/KustoTools-Flow/flow-conditionemail.png "поток-условиеэлектронной")

### <a name="example-4---email-multiple-azure-kusto-flow-charts"></a>Пример 4 - Отправьте на электронную почту несколько диаграмм Azure Kusto Flow

Создайте новый поток с триггером "Повторение" и определите интервал потока и частоту. 

Добавьте новый шаг, с одним или большим количеством действий «Kusto - Run» и визуализировать результаты. 

![альт текст](./Images/KustoTools-Flow/flow-severalqueries.png "поток-несколькозапросов")

Для каждого "Kusto - Выполнить запрос и визуализировать результат" определить следующие поля:

Название кластера, название базы данных, запрос и тип диаграммы (Html Таблица/ Pie Chart/ Time Chart/ Bar Chart/ Enter Custom Value).

![альт текст](./Images/KustoTools-Flow/flow-visualizeresultsmultipleattachments.png "поток-визуализироватьрезультатыmultipleattachments")

После завершения действия "Kusto - Run- Run и визуализация результата" добавьте действие "Отправить электронное письмо". 

Убедитесь в том, чтобы вставить в поле "Тело" необходимого тела, для того, чтобы прикрепить визуализировать результат запроса к телу электронной почты.
Кроме того, чтобы добавить вложение в электронную почту, добавьте "Имя присоединения" и "Содержимое присоединения".

Убедитесь в том, чтобы выбрать "Да" под полем "html".

![альт текст](./Images/KustoTools-Flow/flow-emailmultipleattachments.png "поток-emailmultipleattachments")

Результат:

![альт текст](./Images/KustoTools-Flow/flow-resultsmultipleattachments.png "поток-результатымножественныепривязанности")

![альт текст](./Images/KustoTools-Flow/flow-resultsmultipleattachments2.png "поток-результатыmultipleattachments2")

### <a name="example-5---send-a-different-email-to-different-contacts"></a>Пример 5 - Отправить другое письмо различным контактам

Вы можете использовать Azure Kusto Flow для отправки различных индивидуальных писем различным контактам. Адреса электронной почты, а также содержимое электронной почты являются результатом запроса Kusto.

См. пример далее.

![альт текст](./Images/KustoTools-Flow/flow-dynamicemailkusto.png "поток-динамическийemailkusto")

![альт текст](./Images/KustoTools-Flow/flow-dynamicemail.png "поток-динамическийemail")

### <a name="example-6---create-custom-html-table"></a>Пример 6 - Создание пользовательской таблицы HTML

Для создания и использования пользовательских HTML-элементов, таких как пользовательская таблица HTML, можно использовать Azure Kusto Flow.

Ниже приводится следующий пример, как создать пользовательскую таблицу HTML. Таблица HTML будет иметь свои строки, окрашенные уровнем журнала (так же, как в Kusto Explorer).

Следуйте этим инструкциям, чтобы создать аналогичный поток:

Создайте новое действие «Kusto - Run-запрос и список результатов».

![альт текст](./Images/KustoTools-Flow/flow-listresultforhtmltable.png "поток-списокresultфорhtmltable")

Петля над результатами запроса и создание тела таблицы HTML. Во-первых, создайте переменную, которая будет удерживать строку HTML - нажмите на "Новый шаг", выберите "Добавить действие" и поиск "Переменные". Нажмите на кнопку "Переменные - инициализация переменной". Инициализируем переменную строки следующим образом:

![альт текст](./Images/KustoTools-Flow/flow-initializevariable.png "поток-инициализироватьпеременный")

Петля над результатами - нажмите на "Новый шаг" и выберите "Добавить действие". Поиск "Переменные". Выберите 'Переменные - Приложение к переменной строки'. Выберите имя переменной, которое вы инициализировали ранее, и создайте строки таблиц HTML с помощью результатов запроса. При выборе результатов запроса добавлена функция "Применить к каждому" automaitcally.

В приведенном ниже примере используется выражение для определения стиля каждой строки:

если (равные (элементы ('Apply_to_each')?» Уровень», «Предупреждение»), «желтый», если (равные (элементы («Apply_to_each»)?» Уровень»,, «Ошибка»,, «красный», «белый»))

![альт текст](./Images/KustoTools-Flow/flow-createhtmltableloopcontent.png "поток-createhtmltableloopcontent")

Наконец, создайте полный HTML-контент. Добавьте новое действие за пределами «Применить к каждому». В следующем примере используется действие "Отправить электронное письмо". Определите свою таблицу HTML, используя переменную от предыдущих шагов. Если вы отправляете электронное письмо, нажмите на кнопку «Показать расширенные варианты» и выберите «Да» в соответствии с «Is HTML»

![альт текст](./Images/KustoTools-Flow/flow-customhtmltablemail.png "поток-customhtmltablemail")

и вот результат:

![альт текст](./Images/KustoTools-Flow/flow-customhtmltableresult.png "поток-customhtmltableresult")







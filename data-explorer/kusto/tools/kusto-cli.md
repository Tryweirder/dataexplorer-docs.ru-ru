---
title: Kusto CLI в Azure обозреватель данных | Документация Майкрософт
description: В этой статье описывается Kusto CLI в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/24/2020
ms.openlocfilehash: ab82698054e4bcb851f9f05acdd62af569e0704b
ms.sourcegitcommit: 9fe6e34ef3321390ee4e366819ebc9b132b3e03f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2020
ms.locfileid: "84258119"
---
# <a name="kusto-cli"></a>Kusto CLI

Kusto. CLI — это служебная программа командной строки, которую можно использовать для отправки запросов в Kusto и вывода результатов. Kusto. CLI может работать в одном из нескольких режимов:

* *Режим REPL*: пользователь вводит в запросах и командах, выполняемых с Kusto, и отображает результаты, а затем ожидает следующий пользовательский запрос или команду.
  ("REPL" означает "чтение, вычисление, печать/цикл".)

* *Режим выполнения*. пользователь предоставляет один или несколько запросов и команд для выполнения в качестве аргументов командной строки для средства. Они выполняются в последовательности автоматически, а выходные данные результатов — в консоли. При необходимости, если выполнить все входные запросы и команды, средство переходит в режим REPL.

* *Режим сценария*: аналогичен режиму выполнения, но с запросами и командами, заданными с помощью файла («script»).

Kusto. CLI в основном предоставляется для автоматизации задач в службе Kusto, которая обычно требуется для написания кода (например, программы C# или сценария PowerShell).

## <a name="getting-the-tool"></a>Получение средства

Kusto. CLI является частью пакета NuGet `Microsoft.Azure.Kusto.Tools` , который можно скачать [здесь](https://www.nuget.org/packages/Microsoft.Azure.Kusto.Tools/).
После загрузки `tools` папка пакета может быть извлечена в целевую папку. дополнительная установка не требуется (т. е. она доступна для установки с помощью XCOPY).



## <a name="running-the-tool"></a>Запуск инструмента

Для выполнения Kusto. CLI требуется хотя бы один аргумент командной строки. Обычно этот аргумент представляет собой строку подключения к службе Kusto, к которой должно подключаться средство. см. раздел [строки подключения Kusto](../api/connection-strings/kusto.md). При запуске средства без аргументов командной строки или с неизвестным набором аргументов или с `/help` параметром, выдается сообщение справки в консоли.

Например, выполните следующую команду, чтобы запустить Kusto. CLI и подключиться к `help` службе Kusto и задать для базы данных контекст базы данных `Samples` :

```
Kusto.Cli.exe "https://help.kusto.windows.net/Samples;Fed=true"
```

> [!NOTE]
> Мы использовали кавычки в строке подключения для предотвращения интерпретации точки с запятой ( `;` ) и аналогичных символов в строке подключения для приложений оболочки, таких как PowerShell.

## <a name="command-line-arguments"></a>аргументов командной строки;

`Kusto.Cli.exe`*ConnectionString* [*Параметры*]

*ConnectionString*
* [Строка подключения Kusto](../api/connection-strings/kusto.md) , содержащая все сведения о соединении Kusto.
  По умолчанию имеет значение `net.tcp://localhost/NetDefaultDB`.

`-execute:`*куерйоркомманд*
* Запускает Kusto. CLI в режиме выполнения, если он указан. выполняется указанный запрос или команда. Этот параметр может повторяться, в этом случае запросы и команды выполняются последовательно в порядке их отображения.
  Этот параметр нельзя использовать вместе с `-script` или `-scriptml` .

`-keepRunning:`*енаблекипруннинг*
* Если указано значение ( `true` или `false` ), включает или отключает переключение в режим REPL после обработки всех `-script` `-execute` значений или.

`-script:`*ScriptFile*
* Запускает Kusto. CLI в режиме сценария, если он указан. загружается указанный файл скрипта, и запросы или команды в нем выполняются последовательно.
  Символы новой строки используются для разделения запросов и команд, за исключением случаев, когда строки заканчиваются на `&` `&&` сочетания или, как описано ниже.
  Этот параметр нельзя использовать вместе с `-execute` .

`-scriptml:`*ScriptFile*
* Запускает Kusto. CLI в режиме сценария, если он указан. загружается указанный файл скрипта, и запросы или команды в нем выполняются последовательно.
  Весь файл скрипта считается одним запросом или командой.
  Этот параметр нельзя использовать вместе с `-execute` .

`-echo:`*енабличомоде*
* Если указано значение ( `true` или `false` ), включает или отключает эхо-режим.
  Если включен режим Echo, каждый запрос или команда повторяется в выходных данных.

`-transcript:`*транскриптфиле*  
* Записывает выходные данные программы в *транскриптфиле*.

`-logToConsole:`*енаблелогтоконсоле*
* Если указано значение ( `true` или `false` ), включает или отключает запись выходных данных программы на консоль.

`-lineMode:`*енаблелинемоде*
* При указании переключается между режимом ввода строки (по умолчанию или, если задано значение `true` ) и блокируется режим ввода (если задано значение `false` ). Ниже приведено описание этих двух режимов, определяющих способ обработки новой строки.

**Пример**

```
Kusto.Cli.exe "https://kustolab.kusto.windows.net/;Fed=true" -script:"c:\mycommands.txt"
```

Обратите внимание, что между двоеточием и значением аргумента не должно быть пробелов.

## <a name="directives"></a>Директивы

Kusto. CLI поддерживает несколько директив, которые выполняются в средстве, а не отправляются в службу для обработки:

|Директива                      |Описание|
|-------------------------------|-----------|
|`?`<br>`#h`<br>`#help`         |Получите краткое справочное сообщение.|
|`q`<br>`#quit`<br>`#exit`      |Закройте средство.|
|`#a`<br>`#abort`               |Аварийное завершение работы средства.|
|`#clip`                        |Результаты следующего запроса или команды будут скопированы в буфер обмена.|
|`#cls`                         |Очистить экран консоли.|
|`#connect`*[ConnectionString*]|Подключается к другой службе Kusto (если *строка connectionString* не указана, будет отображена текущая).|
|`#crp`[*Имя* [ `=` *значение*]]   |Задает значение свойства клиентского запроса (или просто отображает его или отображает все значения).|
|`#crp`( `-list` \| `-doc` ) [*Префикс*]|Выводит список свойств клиентского запроса (по префиксу или всем).|
|`#dbcontext`[*DatabaseName*]  |Изменяет "контекстную" базу данных, используемую запросами и командами в *DatabaseName* (если она не указана, отображается текущий контекст).|
|`ke`*Текстовая надпись*                    |Отправляет указанный текст в выполняющийся процесс Kusto. Explorer.|
|`#loop`*Подсчет* *текста*         |Выполняет текст несколько раз.|
|`#qp`[*Имя* [ `=` *значение*]]   |Задает значение параметра запроса (или просто воспроизводит его или отображает все значения). Одинарные или двойные кавычки в начале и конце будут обрезаны.|
|`#save`*Имя файла*             |Результаты следующего запроса или команды будут сохранены в указанном CSV-файле.|
|`#script`*Имя файла*           |Выполняет указанный скрипт.|
|`#scriptml`*Имя файла*         |Выполняет указанный многострочный скрипт.|

## <a name="line-input-mode-and-block-input-mode"></a>Режим ввода строк и блокировать режим ввода

По умолчанию Kusto. CLI работает в **режиме линейного ввода**: каждый символ новой строки интерпретируется как разделитель между запросами и командами, а строка немедленно отправляется на выполнение.

В этом режиме длинный запрос или команда можно разбить на несколько строк. Внешний вид символа в `&` виде последнего символа строки (перед новой строкой) приводит к тому, что Kusto. CLI продолжит чтение следующей строки. Внешний вид символа в `&&` виде последнего символа строки (перед новой строкой) приводит к тому, что Kusto. CLI игнорирует строку и продолжает чтение следующей строки.

Кроме того, Kusto. CLI также поддерживает запуск в **режиме блокировки ввода**: с помощью параметра командной строки `-lineMode:false` или с помощью команды. `#blockmode` можно указать, что Kusto. CLI предполагает, что каждая строка является продолжением предыдущей строки, чтобы запросы и команды были разделены только пустой входной строкой.

## <a name="comments"></a>Комментарии

Kusto. CLI интерпретирует `//` строку, которая начинает новую строку, в качестве строки комментария. Он игнорирует оставшуюся часть строки и продолжит чтение следующей строки.

## <a name="tool-only-options"></a>Параметры только для инструментов

Команды                        | Действие                                                                            | Находится
--------------------------------|-----------------------------------------------------------------------------------|-----------
#timeon|#timeoff                | включить или отключить параметр "время": отображение запросов времени                    | TRUE
#tableon|#tableoff              | включить или отключить параметр "Таблевиев": форматирование результирующих наборов в виде таблиц                  | TRUE
#marson|#marsoff                | включить или отключить параметр "Марсвиев": отобразить 2-й результирующий набор             | FALSE
#resultson|#resultsoff          | включить или отключить параметр "Аутпутресултссет": отобразить результирующие наборы                 | TRUE
#prettyon|#prettyoff            | включить или отключить параметр "Преттеррорс": удалите ненужные ГУ из-за ошибок          | TRUE
#markdownon|#markdownoff        | включить или отключить параметр "Маркдовнвиев": форматирование таблиц как MarkDown                   | FALSE
#progressiveon|#progressiveoff  | включить или отключить параметр "Прогрессивевиев": запросить и отобразить прогрессивные результаты  | FALSE
#linemode|#blockmode            | включить или отключить параметр "Линемоде": однострочный входной режим                          | TRUE

Команды                              | Действие                                                                                                         | Значение по умолчанию
--------------------------------------|----------------------------------------------------------------------------------------------------------------|-----------
#cridon|#cridoff                      | (включить|отключить параметр "Крид": отобразить ClientRequestId перед отправкой запроса)                         | FALSE
#csvheaderson|#csvheadersoff          | (включить|отключить параметр "Ксвхеадерс": включить заголовки в выходные данные CSV-файла                                            | TRUE
#focuson|#focusoff                    | (включить|отключить параметр "Фокус": удалить все лишние проводимые самими и сосредоточиться на нужном элементе.                       | FALSE
#linemode|#blockmode                  | (включить|отключить параметр "Линемоде": однострочный входной режим)                                                     | TRUE
#markdownon|#markdownoff              | (включить|отключить параметр "Маркдовнвиев": форматирование таблиц как MarkDown)                                              | FALSE
#marson|#marsoff                      | (включить|Disable-параметр "Марсвиев": отображение результирующих наборов 2 – Last.                                        | FALSE
#prettyon|#prettyoff                  | (включить|отключить параметр "Преттеррорс": удалите ненужные ГУ из-за ошибок)                                     | TRUE
#querystreamingon|#querystreamingoff  | (включить|отключить параметр "Куеристреаминг": использовать конечную точку Куеристреаминг (только для команды Kusto))                    | FALSE
#resultson|#resultsoff                | (включить|отключить параметр "Аутпутресултссет": отобразить результирующие наборы.)                                            | TRUE
#tableon|#tableoff                    | (включить|отключить параметр "Таблевиев": форматирование результирующих наборов в виде таблиц.                                             | TRUE
#timeon|#timeoff                      | (включить|отключить параметр "время": отображение запросов времени.                                               | TRUE
#typeon|#typeoff                      | (включить|Disable-параметр "Типевиев": отображение типа каждого столбца в табличном представлении (принудительная потоковая передача = true))  | TRUE
#v2protocolon|#v2protocoloff          | (включить|отключить параметр "v2protocol": Используйте протокол запросов v2, а не v1.                                        | TRUE

## <a name="using-kustocli-to-export-results-as-csv"></a>Использование Kusto. CLI для экспорта результатов в CSV-файл

Kusto. CLI поддерживает специальную команду на стороне клиента, `#save` чтобы экспортировать результаты **следующего** запроса в локальный файл в формате CSV. Например, при следующем вызове Kusto. CLI будет экспортировано 10 записей из `StormEvents` таблицы в `help.kusto.windows.net` кластере ( `Samples` база данных):

```
Kusto.Cli.exe @help/Samples -execute:"#save c:\temp\test.log" -execute:"StormEvents | take 10"
```

## <a name="using-kustocli-to-control-a-running-instance-of-kustoexplorer"></a>Использование Kusto. CLI для управления работающим экземпляром Kusto. Explorer

Можно указать Kusto. CLI взаимодействовать с основным экземпляром Kusto. Explorer, работающим на компьютере, и отправить ему запросы на выполнение. Это может быть очень полезно для программ, которые хотят выполнять несколько Kusto запросов, но не нужно снова запускать процесс Kusto. Explorer. В следующем примере Kusto. CLI используется для повторного выполнения запроса в кластере справки:

```
#connect cluster('help').database('Samples')

#ke StormEvents | count
```

Синтаксис очень прост: `#ke` , за которым следует пробелы и запрос для выполнения.
Затем запрос отправляется на основной экземпляр Kusto. Explorer (если он существует) с текущим кластером или базой данных, установленным в Kusto. CLI.

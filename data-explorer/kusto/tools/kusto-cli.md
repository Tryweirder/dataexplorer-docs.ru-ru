---
title: Kusto CLI — Azure обозреватель данных
description: В этой статье описывается Kusto CLI в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/24/2020
ms.openlocfilehash: adc606c787ab20f228a9fbd132d1b82660aa57c6
ms.sourcegitcommit: 188f89553b9d0230a8e7152fa1fce56c09ebb6d6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2020
ms.locfileid: "84512492"
---
# <a name="kusto-cli"></a>Kusto CLI

Kusto. CLI — это программа командной строки, которая используется для отправки запросов в Kusto и вывода результатов. Он может работать в одном из нескольких режимов:

* *Режим REPL*: пользователь вводит запросы и команды, и средство отображает результаты, а затем ожидает следующего пользовательского запроса или команды.
  ("REPL" означает "чтение, вычисление, печать/цикл".)

* *Режим выполнения*. пользователь вводит один или несколько запросов и команд для выполнения в качестве аргументов командной строки. Аргументы автоматически выполняются последовательно, а выходные данные результатов — в консоли. При необходимости после выполнения всех входных запросов и команд средство переходит в режим REPL.

* *Режим скрипта*: аналогичен режиму выполнения, но с запросами и командами, заданными с помощью файла script.

Kusto. CLI в основном предоставляется для автоматизации задач в службе Kusto, которая обычно требует написания кода. Например, программа C# или сценарий PowerShell.

## <a name="get-the-tool"></a>Скачать средство упаковки

Kusto. CLI является частью пакета NuGet `Microsoft.Azure.Kusto.Tools` , который [можно скачать](https://www.nuget.org/packages/Microsoft.Azure.Kusto.Tools/).
После скачивания Извлеките `tools` папку пакета в целевую папку. Дополнительная установка не требуется, так как она доступна для установки с поддержкой xcopy.

## <a name="run-the-tool"></a>Запуск программы

Для выполнения Kusto. CLI требуется хотя бы один аргумент командной строки. Обычно этот аргумент представляет собой строку подключения к службе Kusto, к которой должно подключаться средство.
Дополнительные сведения см. в разделе [строки подключения Kusto](../api/connection-strings/kusto.md). При запуске средства без аргументов командной строки с неизвестным набором аргументов или с `/help` параметром на консоли отображается сообщение справки.

Например, используйте следующую команду для запуска Kusto. CLI. Команда будет подключаться к `help` службе Kusto и установить контекст базы данных в качестве контекста базы `Samples` данных:

```
Kusto.Cli.exe "https://help.kusto.windows.net/Samples;Fed=true"
```

> [!NOTE]
> Используйте двойные кавычки для строки подключения, чтобы предотвратить интерпретацию точки с запятой ( `;` ) и аналогичных символов в приложениях оболочки, таких как PowerShell.

## <a name="command-line-arguments"></a>аргументов командной строки;

`Kusto.Cli.exe`*ConnectionString* [*Параметры*]

*ConnectionString*
* [Строка подключения Kusto](../api/connection-strings/kusto.md) , содержащая все сведения о соединении Kusto.
  По умолчанию — `net.tcp://localhost/NetDefaultDB`.

`-execute:`*куерйоркомманд*
* Если этот параметр указан, запускает Kusto. CLI в режиме выполнения и выполняется указанный запрос или команда. Этот параметр может повторяться, а запросы и команды выполняются последовательно в порядке их отображения.
  Этот параметр нельзя использовать совместно с `-script` или `-scriptml` .

`-keepRunning:`*енаблекипруннинг*
* Если указано значение, `true` `false` то оно включает или отключает режим REPL после `-script` обработки всех или `-execute` значений.

`-script:`*ScriptFile*
* Если он указан, запускает Kusto. CLI в режиме сценария. Загружается указанный файл скрипта, и запросы или команды в нем выполняются последовательно.
  Символы новой строки используются для разделения запросов и команд, за исключением случаев, когда строки заканчиваются `&` `&&` сочетанием или, как описано ниже.
  Этот параметр нельзя использовать вместе с `-execute` .

`-scriptml:`*ScriptFile*
* Если он указан, запускает Kusto. CLI в режиме сценария. Загружается указанный файл скрипта, и запросы или команды в нем выполняются последовательно.
  Весь файл скрипта считается одним запросом или командой.
  Этот параметр нельзя использовать вместе с `-execute` .

`-echo:`*енабличомоде*
* Если указано значение, `true` `false` то оно включает или отключает режим Echo.
  Если включен режим Echo, каждый запрос или команда повторяется в выходных данных.

`-transcript:`*транскриптфиле*  
* Записывает выходные данные программы в *транскриптфиле*.

`-logToConsole:`*енаблелогтоконсоле*
* Если этот параметр указан, `true` `false` он включает или отключает отображение выходных данных программы на консоли.

`-lineMode:`*енаблелинемоде*
* Если параметр задан, переключается между режимом ввода строки по умолчанию, если задано значение `true` , и режим блокировки входных данных, если задано значение `false` . Описание этих двух режимов, определяющее, как обрабатываются строки, см. ниже.

**Пример**

```
Kusto.Cli.exe "https://kustolab.kusto.windows.net/;Fed=true" -script:"c:\mycommands.txt"
```

> [!NOTE] 
> Между двоеточием и значением аргумента не должно быть пробелов

## <a name="directives"></a>Директивы

Kusto. CLI запускает ряд директив в средстве, а не отправляет их в службу для обработки.

|Директива                      |Описание|
|-------------------------------|-----------|
|`?`<br>`#h`<br>`#help`         |Получить краткое справочное сообщение|
|`q`<br>`#quit`<br>`#exit`      |Завершение работы средства|
|`#a`<br>`#abort`               |Аварийное завершение работы средства|
|`#clip`                        |Результаты следующего запроса или команды будут скопированы в буфер обмена|
|`#cls`                         |Очистить экран консоли|
|`#connect`*[ConnectionString*]|Подключается к другой службе Kusto (если параметр *ConnectionString* не указан, будет отображен текущий)|
|`#crp`[*Имя* [ `=` *значение*]]   |Задает значение свойства клиентского запроса или просто отображает его или отображает все значения|
|`#crp`( `-list` \| `-doc` ) [*Префикс*]|Выводит список свойств запроса клиента по префиксу или всем|
|`#dbcontext`[*DatabaseName*]  |Изменяет "контекстную" базу данных, используемую запросами и командами в *DatabaseName*. Если этот параметр опущен, отображается текущий контекст|
|`ke` *Text*                    |Отправляет указанный текст в выполняющийся процесс Kusto. Explorer|
|`#loop`*Подсчет* *текста*         |Выполняет текст несколько раз|
|`#qp`[*Имя* [ `=` *значение*]]   |Задает значение параметра запроса или просто отображает его или отображает все значения. Одинарные/двойные кавычки в начале и конце будут обрезаны|
|`#save`*Имя файла*             |Результаты следующего запроса или команды будут сохранены в указанном CSV-файле|
|`#script`*Имя файла*           |Выполняет указанный скрипт|
|`#scriptml`*Имя файла*         |Выполняет указанный многострочный Скрипт|

## <a name="line-input-mode-and-block-input-mode"></a>Режим ввода строк и блокировать режим ввода

По умолчанию Kusto. CLI работает в **режиме линейного ввода**. Каждый символ новой строки интерпретируется как разделитель между запросами и командами, и строка немедленно отправляется для выполнения.

В этом режиме длинный запрос или команда можно разбить на несколько строк. `&`Символ в качестве последнего символа строки, перед новой строкой, приводит к тому, что Kusto. CLI продолжит чтение следующей строки. `&&`Символ в качестве последнего символа строки, перед новой строкой, приводит к тому, что Kusto. CLI игнорирует строку и продолжает чтение следующей строки.

Kusto. CLI также поддерживает запуск в **режиме блокировки ввода**. С помощью параметра командной строки `-lineMode:false` или директивы `#blockmode` можно указать, что Kusto. CLI предполагает, что каждая строка является продолжением предыдущей строки, так что запросы и команды разделяются только пустой входной строкой.

## <a name="comments"></a>Комментарии

Kusto. CLI интерпретирует `//` строку, которая начинает новую строку, в качестве строки комментария. Он игнорирует оставшуюся часть строки и продолжит чтение следующей строки.

## <a name="tool-only-options"></a>Параметры только для инструментов

Команды                        | Действие                                                                            | Находится
--------------------------------|-----------------------------------------------------------------------------------|-----------
#timeon|#timeoff                | параметр "включить/отключить" `timing` показывает, что заняли запросы времени                    | TRUE
#tableon|#tableoff              | Включение или отключение параметра `tableView` : форматирование результирующих наборов в виде таблиц                  | TRUE
#marson|#marsoff                | параметр "включить/отключить" `marsView` : отображение результирующих наборов "второй-к-последним"          | FALSE
#resultson|#resultsoff          | параметр включения или отключения `outputResultsSet` : отображение результирующих наборов                 | TRUE
#prettyon|#prettyoff            | параметр "включить/отключить" `prettyErrors` : Очистка ошибок                             | TRUE
#markdownon|#markdownoff        | параметр включения или отключения `markdownView` : форматирование таблиц как MarkDown                   | FALSE
#progressiveon|#progressiveoff  | параметр "включить/отключить" `progressiveView` : запрос и отображение прогрессивных результатов  | FALSE
#linemode|#blockmode            | параметр "включить/отключить" `lineMode` : однострочный входной режим                          | TRUE

Команды                              | Действие                                                                                                         | По умолчанию
--------------------------------------|----------------------------------------------------------------------------------------------------------------|-----------
#cridon|#cridoff                      | (включить|отключить параметр `crid` : отобразить ClientRequestId перед отправкой запроса)                          | FALSE
#csvheaderson|#csvheadersoff          | (включить|Disable `csvHeaders` -параметр: включить заголовки в выходных данных CSV.                                            | TRUE
#focuson|#focusoff                    | (включить|отключить параметр `focus` : удалить все лишние проводимые самими и сосредоточиться на нужном.                        | FALSE
#linemode|#blockmode                  | (включить|параметр отключения `lineMode` : однострочный входной режим                                                      | TRUE
#markdownon|#markdownoff              | (включить|Disable `markdownView` -параметр: форматирование таблиц как MarkDown)                                              | FALSE
#marson|#marsoff                      | (включить|Disable `marsView` -параметр: отображение результирующих наборов второго и последнего параметров.                                      | FALSE
#prettyon|#prettyoff                  | (включить|параметр отключения `prettyErrors` : Очистка ошибок)                                                        | TRUE
#querystreamingon|#querystreamingoff  | (включить|Disable `queryStreaming` -параметр: используйте конечную точку куеристреаминг (только для команды Kusto).                    | FALSE
#resultson|#resultsoff                | (включить|Disable `outputResultsSet` -параметр: отображение результирующих наборов.                                            | TRUE
#tableon|#tableoff                    | (включить|Disable `tableView` -параметр: форматирование результирующих наборов в виде таблиц.                                              | TRUE
#timeon|#timeoff                      | (включить|отключить параметр `timing` : отображение количества времени, затраченного на выполнение запросов.                               | TRUE
#typeon|#typeoff                      | (включить|отключить параметр `typeView` : отображение типа каждого столбца в табличном представлении. Принудительная потоковая передача = true)| TRUE
#v2protocolon|#v2protocoloff          | (включить|Disable `v2protocol` -параметр: Используйте протокол запросов v2, а не v1.                                        | TRUE

## <a name="use-kustocli-to-export-results-as-csv"></a>Использование Kusto. CLI для экспорта результатов в CSV-файл

Kusto. CLI имеет специальную команду на стороне клиента, `#save` которая экспортирует результаты **следующего** запроса в локальный файл в формате CSV. Например, следующая строка приведет к экспорту 10 записей из `StormEvents` таблицы в `help.kusto.windows.net` кластер, `Samples` база данных:

```
Kusto.Cli.exe @help/Samples -execute:"#save c:\temp\test.log" -execute:"StormEvents | take 10"
```

## <a name="use-kustocli-to-control-a-running-instance-of-kustoexplorer"></a>Использование Kusto. CLI для управления работающим экземпляром Kusto. Explorer

Вы можете указать Kusto. CLI взаимодействовать с основным экземпляром Kusto. Explorer, работающим на компьютере, и отправлять запросы. Этот механизм может быть полезен для программ, которые хотят выполнять несколько запросов, но не нужно запускать процесс Kusto. Explorer повторно. В следующем примере Kusto. CLI используется для выполнения запроса к кластеру справки:

```
#connect cluster('help').database('Samples')

#ke StormEvents | count
```

Синтаксис прост: `#ke` , за которым следует пробелы и запрос для выполнения.
Затем запрос отправляется на основной экземпляр Kusto. Explorer, если он существует, с текущим кластером или базой данных, установленным в Kusto. CLI.
 

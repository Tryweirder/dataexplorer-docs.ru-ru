---
title: Кусто CLI - Исследователь данных Azure (ru) Документы Майкрософт
description: В этой статье описывается Kusto CLI в Azure Data Explorer.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/24/2020
ms.openlocfilehash: 7443ad32b78a48f6b35be4f4b680ac6c728aedd2
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81524248"
---
# <a name="kusto-cli"></a>Кусто CLI

Kusto.Cli — это утилита командной строки, которая может использоваться для отправки запросов в Kusto и отображения их результатов. Kusto.Cli может работать в одном из нескольких режимов:

* *Режим REPL:* Пользователь вводит запросы и команды для выполнения против Kusto, и инструмент отображает результаты, а затем ждет следующего запроса/команды пользователя.
  ("REPL" означает "читать /eval/print/loop".)

* *Режим выполнения*: Пользователь предоставляет один или несколько запросов и команд для выполнения в качестве аргументов командной строки для инструмента. Они работают последовательно автоматически, и их результаты выходят на консоль. Дополнительно, запустив все входиные запросы и команды, инструмент переходит в режим REPL.

* *Режим скрипта*: Похожи на режим выполнения, но с запросами и командами, указанными через файл (так называемый "скрипт").

Kusto.Cli в первую очередь предназначен для автоматизации задач против службы Kusto, которая обычно требуется для написания кода (например, программа C- или скрипт PowerShell).

## <a name="getting-the-tool"></a>Получение инструмента

Kusto.Cli является частью пакета `Microsoft.Azure.Kusto.Tools`NuGet , который можно скачать [здесь](https://www.nuget.org/packages/Microsoft.Azure.Kusto.Tools/).
После загрузки `tools` папка пакета может быть извлечена в папку-мишень; дополнительная установка не требуется (т.е. она xcopy-installable).



## <a name="running-the-tool"></a>Запуск инструмента

Kusto.Cli требует, чтобы для запуска был по крайней мере один аргумент командной строки. Обычно этот аргумент является строкой соединения с службой Kusto, к которую должен подключиться инструмент; [см. строки соединения Kusto](../api/connection-strings/kusto.md). Запуск инструмента без аргументов командной строки, или с неизвестным `/help` набором аргументов, или с коммутатором, приводит к тому, что сообщение справки будет испущено на консоль.

Например, используйте следующую команду для запуска Kusto.Cli и подключения к `help` службе `Samples` Kusto и установки контекста базы данных в базу данных:

```
Kusto.Cli.exe "https://help.kusto.windows.net/Samples;Fed=true"
```

> [!NOTE]
> Мы использовали котировки вокруг строки соединения, чтобы предотвратить приложения оболочки,`;`такие как PowerShell, от интерпретации запятой () и аналогичных символов в строке соединения.

## <a name="command-line-arguments"></a>аргументов командной строки;

`Kusto.Cli.exe`*ConnectionString* -*переключатели*

*Connectionstring*
* [Строка соединения Kusto,](../api/connection-strings/kusto.md) которая содержит всю информацию о подключении Kusto.
  По умолчанию равен `net.tcp://localhost/NetDefaultDB`.

`-execute:`*ЗапросОркомандир*
* Если указано, работает Kusto.Cli в режиме выполнения; указанный запрос или команда запущена. Этот переключатель может повториться, и в этом случае запросы/команды запускаются последовательно в порядке внешнего вида.
  Этот переключатель не `-script` может `-scriptml`быть использован вместе с или .

`-keepRunning:`*EnableKeepRunning*
* Если указано `true` (как или `false`), позволяет или отключает переключение в режиме REPL после того, как все `-script` или `-execute` значения были обработаны.

`-script:`*СценарийФайл*
* Если указано, работает Kusto.Cli в режиме скрипта; указанный файл скрипта загружается, а запросы или команды в нем запускаются последовательно.
  Новые линии используются для разгранизания запросов/команд, за исключением случаев, когда строки заканчиваются `&` или `&&` комбинациями, как показано ниже.
  Этот переключатель не `-execute`может быть использован вместе с .

`-scriptml:`*СценарийФайл*
* Если указано, работает Kusto.Cli в режиме скрипта; указанный файл скрипта загружается, а запросы или команды в нем запускаются последовательно.
  Весь файл скрипта считается одним запросом или командой.
  Этот переключатель не `-execute`может быть использован вместе с .

`-echo:`*EnableEchoMode*
* Если указано `true` (как либо или `false`), позволяет или отскакивает эхо-режим.
  При включении режима эха каждый запрос или команда повторяются на выходе.

`-transcript:`*TranscriptFile*  
* Если указано, записывает выход программы в *TranscriptFile*.

`-logToConsole:`*EnableLogtoConsole*
* Если указано `true` (как либо или `false`), позволяет или отводит написания программы вывода на консоль.

`-lineMode:`*EnableLineMode*
* Если указано, переключается между режимом ввода `true`строки (по умолчанию, `false`или при установке на) и блокировать режим ввода (при установке на). Ниже приведено объяснение этих двух режимов, которые определяют, как обрабатываются новые линии.

**Пример**

```
Kusto.Cli.exe "https://kustolab.kusto.windows.net/;Fed=true" -script:"c:\mycommands.txt"
```

Пожалуйста, обратите внимание, не должно быть места между толстой кишки и аргумент значение.

## <a name="directives"></a>Директивы

Kusto.Cli поддерживает ряд директив, которые выполняются в инструменте, а не отправляются в службу для обработки:

|Директива                      |Описание|
|-------------------------------|-----------|
|`?`<br>`#h`<br>`#help`         |Получите короткое сообщение справки.|
|`q`<br>`#quit`<br>`#exit`      |Выйдите из инструмента.|
|`#a`<br>`#abort`               |Выйдите из инструмента неудачно.|
|`#clip`                        |Результаты следующего запроса или команды будут скопированы на буфер обмена.|
|`#cls`                         |Очистите экран консоли.|
|`#connect`*(СвязьСтнет)*|Подключается к другой службе Kusto (если *СоединениеСтонс* опущено, будет отображаться текущая).|
|`#crp`Имя*Name* и`=` *имя*(   |Устанавливает значение свойства запроса клиента (или просто отображает его, или отображает все значения).|
|`#crp` (`-list` | `-doc`Приставка -*префикс*|Списки свойств запроса клиента (по префиксу, или все).|
|`#dbcontext`-*База данныхИмя*  |Изменяет базу данных "контекста", используемую запросами и командами, в *DatabaseName* (если он опущен, текущий контекст будет отображаться).|
|`ke`*Текст*                    |Отправляет указанный текст в процесс выполнения Kusto.Explorer.|
|`#loop`*Граф* *Текст*         |Выполняет текст несколько раз.|
|`#qp`Имя*Name* и`=` *имя*(   |Устанавливает значение параметра запроса (или просто отображает его, или отображает все значения). Одноместные/двойные котировки от начала/конца будут обрезаны.|
|`#save` *имя_файла*             |Результаты следующего запроса или команды будут сохранены в указанном файле CSV.|
|`#script` *имя_файла*           |Выполняет указанный скрипт.|
|`#scriptml` *имя_файла*         |Выполняет указанный многолинейный скрипт.|

## <a name="line-input-mode-and-block-input-mode"></a>Режим ввода строки и режим ввода блока

По умолчанию Kusto.Cli работает в **режиме ввода строки:** каждый новый символ интерпретируется как делимитер между запросами/командами, и строка немедленно отправляется на выполнение.

В этом режиме можно разбить длинный запрос или команду на несколько строк. Появление `&` персонажа в качестве последнего персонажа строки (до новой строки) заставляет Kusto.Cli продолжить чтение следующей строки. Появление `&&` персонажа в качестве последнего персонажа строки (до новой строки) заставляет Kusto.Cli игнорировать новую строку и продолжать читать следующую строку.

Кроме того, Kusto.Cli также поддерживает запуск в **режиме ввода блока:** используя либо переключатель `-lineMode:false` командной строки, либо с помощью команды, `#blockmode`можно поручить Kusto.Cli предположить, что каждая строка является продолжением предыдущей строки, так что запросы и команды делимитированы только пустой входной строкой.

## <a name="comments"></a>Комментарии

Kusto.Cli интерпретирует строку, `//` которая начинает новую строку, как строку комментариев. Он игнорирует остальную часть линии и продолжает читать следующую строку.

## <a name="tool-only-options"></a>Параметры только для инструментов

Команды                        | Действие                                                                            | Настоящее время
--------------------------------|-----------------------------------------------------------------------------------|-----------
#timeon|#timeoff                | включить/отключить опцию 'timing': отображение времени запросов,                    | TRUE
#tableon|#tableoff              | включить/отключить опцию 'tableView': наборы результатов формата в виде таблиц                  | TRUE
#marson|#marsoff                | включить/отключить опцию 'marsView': отображение 2-го до последнего набора результатов             | FALSE
#resultson|#resultsoff          | включить/отключить опцию 'outputResultsSet': отображение наборов результатов                 | TRUE
#prettyon|#prettyoff            | включить/отключить опцию 'prettyErrors': удалить ненужную сгу из ошибок          | TRUE
#markdownon|#markdownoff        | включить/отключить опцию 'markdownView': таблицы форматов как MarkDown                   | FALSE
#progressiveon|#progressiveoff  | включить/отключить опцию 'progressiveView': запросите и отображение прогрессивных результатов  | FALSE
#linemode|#blockmode            | включить/отключить опцию 'lineMode': режим ввода одной строки                          | TRUE

Команды                              | Действие                                                                                                         | Значение по умолчанию
--------------------------------------|----------------------------------------------------------------------------------------------------------------|-----------
#cridon|#cridoff                      | (включить|отключить опцию 'crid': отобразить ClientRequestId перед отправкой запроса)                         | FALSE
#csvheaderson|#csvheadersoff          | (включить|отключить опцию 'csvHeaders': включить заголовки в выходе CSV)                                            | TRUE
#focuson|#focusoff                    | (включить|отключить опцию "фокус": удалить все дополнительные пух и сосредоточиться на правильный материал)                       | FALSE
#linemode|#blockmode                  | (включить|отключить опцию 'lineMode': режим ввода одной строки)                                                     | TRUE
#markdownon|#markdownoff              | (включить|отключить опцию 'markdownView': таблицы форматов как MarkDown)                                              | FALSE
#marson|#marsoff                      | (включить|отключить опцию 'marsView': отображение 2-го до последнего набора результатов)                                        | FALSE
#prettyon|#prettyoff                  | (включить|отключить опцию 'prettyErrors': удалить ненужную сгу от ошибок)                                     | TRUE
#querystreamingon|#querystreamingoff  | (включить|отключить опцию 'queryStreaming': используйте конечную точку queryStreaming (только команда Kusto))                    | FALSE
#resultson|#resultsoff                | (включить|отключить опцию 'outputResultsSet': отображение наборов результатов)                                            | TRUE
#tableon|#tableoff                    | (включить|отключить опцию 'tableView': наборы результатов формата в виде таблиц)                                             | TRUE
#timeon|#timeoff                      | (включить|отключить опцию 'timing': отображение времени запросов)                                               | TRUE
#typeon|#typeoff                      | (включить|отключить опцию 'typeView': отобразить тип каждого столбца в представлении таблицы (заставит Streaming'true))  | TRUE
#v2protocolon|#v2protocoloff          | (включить|отключить опцию 'v2protocol': используйте протокол запроса v2, а не v1)                                        | TRUE

## <a name="using-kustocli-to-export-results-as-csv"></a>Использование Kusto.Cli для экспорта результатов в качестве CSV

Kusto.Cli поддерживает специальную команду на `#save`стороне клиента, чтобы экспортировать **результаты следующего** запроса в локальный файл в формате CSV. Например, следующий призыв Kusto.Cli будет экспортировать 10 записей из `StormEvents` таблицы в кластере `help.kusto.windows.net` (база`Samples` данных):

```
Kusto.Cli.exe @help/Samples -execute:"#save c:\temp\test.log" -execute:"StormEvents | take 10"
```

## <a name="using-kustocli-to-control-a-running-instance-of-kustoexplorer"></a>Использование Kusto.Cli для управления запущенным экземпляром Kusto.Explorer

Можно поручить Kusto.Cli общаться с "первичным" экземпляром Kusto.Explorer, работающим на машине, и отправлять ему запросы для выполнения. Это может быть очень полезно для программ, которые хотят запустить ряд запросов Kusto, но не хотят запускать процесс Kusto.Explorer снова и снова. В следующем примере Kusto.Cli используется для выполнения запроса, опять кластера справки:

```
#connect cluster('help').database('Samples')

#ke StormEvents | count
```

Синтаксис очень прост: `#ke`, а затем whitespace и запрос для запуска.
Затем запрос отправляется в основной экземпляр Kusto.Explorer (если он существует) с текущим кластером/базой данных, установленным в Kusto.Cli.
---
title: "\"Песочницы\" — Azure обозреватель данных | Документация Майкрософт"
description: В этой статье описываются изолированные среды в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: 5dec95e8d4a73bcff4e8ad037577c51a20fcc64c
ms.sourcegitcommit: 4f68d6dbfa6463dbb284de0aa17fc193d529ce3a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2020
ms.locfileid: "82741960"
---
# <a name="sandboxes"></a>Песочницы

Служба ядра данных Kusto может выполнять изолированные среды для выполнения конкретных потоков, требующих безопасной изоляции.
Примерами этих потоков являются определяемые пользователем сценарии, которые выполняются с помощью [подключаемого модуля Python](../query/pythonplugin.md) или [подключаемого модуля R](../query/rplugin.md).

Для запуска этих изолированных программ Kusto использует развитие проекта Microsoft [drawbridge](https://www.microsoft.com/research/project/drawbridge/) . Это решение используется другими службами Майкрософт для выполнения определяемых пользователем объектов в среде с несколькими клиентами.

Потоки, выполняемые в песочницах, не только изолированы, но также являются локальными (близко к данным), что означает, что дополнительная задержка для удаленных вызовов не добавляется.

## <a name="prerequisites"></a>Предварительные условия

* В подсистеме обработки данных **не** должно быть включено [Шифрование дисков](https://docs.microsoft.com/azure/data-explorer/security#data-encryption) .
  * В будущем ожидается поддержка одновременного выполнения обеих функций.
* Необходимые пакеты (образы) для запуска изолированных программ развертываются на каждом узле механизма обработки данных и требуют выделенного пространства SSD для запуска.
  * Примерный размер — 20 ГБ, который, например, примерно 2,5% емкости SSD виртуальной машины D14_v2 или 0,7% емкости SSD виртуальной машины L16_v1.
  * Это влияет на емкость данных кластера и, таким образом, может повлиять на [стоимость](https://azure.microsoft.com/pricing/details/data-explorer) кластера.

## <a name="runtime"></a>Среда выполнения

* В изолированном операторе запроса для выполнения может использоваться одна или несколько изолированных программ.
  * Песочница используется только для одного запуска, не является общей для нескольких запусков и удаляется по завершении выполнения.
  * "Песочницы" направляются на узел с отложенной инициализацией в первый раз, когда запросу требуется Песочница для выполнения.
    * Это означает, что первое выполнение подключаемого модуля, использующего песочницы на узле, будет включать короткий период прогрева.
  * При перезапуске узла (например, при обновлении службы) все запущенные в ней изолированные "песочницы" уничтожаются.
* Каждый узел поддерживает заранее определенный объем "песочниц", готовых к выполнению входящих запросов.
  * После использования песочницы новая автоматически выделяется для ее замены.
* В случае отсутствия предварительно распределенных песочниц для обслуживания оператора запроса он будет регулироваться.
  (см. [ошибки](#errors), пока не будут выделены новые "песочницы" (это может занять до 10-15 секунд на каждую изолированную среду, в зависимости от номера SKU и доступных ресурсов на узле данных).

## <a name="limitations"></a>Ограничения

Некоторые из этих ограничений можно контролировать с помощью [политики песочницы](../management/sandboxpolicy.md)на уровне кластера для каждого вида песочницы.

* **Число песочниц на узел:** Количество "песочниц" на узел ограничено.
  * Запросы, которые сталкиваются с состоянием, когда нет доступной песочницы, будут регулироваться.
* **Сеть:** Песочница не может взаимодействовать с каким-либо ресурсом на виртуальной машине или за ее пределами.
  * Песочница не может взаимодействовать с другой песочницей.
* **ЦП:** Максимальная частота ЦП, с которой может потребляться "песочница" процессоров узла, ограничена (по `50%`умолчанию —).
  * При достижении этого предела использование ЦП в песочнице регулируется, но выполнение продолжится.
* **Память:** Максимальный объем ОЗУ, который может потребляться песочницей, ограничен (по умолчанию — `20GB`).
  * Достижение этого ограничения приведет к завершению "песочницы" (и ошибке выполнения запроса).
* **Диск:** С песочницей связан уникальный каталог, в котором нет доступа к файловой системе узла.
  * Эта папка предоставляет доступ к образу или пакету, который соответствует типу "песочницы" (например, не настраиваемому пакету Python или R).
* **Дочерние процессы:** "Песочница" блокирует порождение дочерних процессов.

> [!NOTE]
> Использование ресурсов песочницы зависит не только от размера данных, обрабатываемых как часть запроса, но также и от логики, которая выполняется в песочнице, и реализации библиотек, используемых этой средой.
> (например, для `python` подключаемых `r` модулей и второй означает предоставляемый пользователем сценарий и библиотеки Python или R, которые он использует во время выполнения).

## <a name="errors"></a>Ошибки

|Код                      |Сообщение                                                                                        |Потенциальная причина                                                                                                    |
|--------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
|E_SB_QUERY_THROTTLED_ERROR|Изолированный запрос был прерван из-за регулирования. Повторная попытка после некоторой задержки может быть выполнена   |На целевом узле нет доступных изолированных программ. Новые "песочницы" должны стать доступными через несколько секунд         |
|E_SB_QUERY_THROTTLED_ERROR|"Песочницы" типа "{Kind}" еще не инициализированы                                       |Политика "песочницы" недавно изменилась. Новые "песочницы", подчиняются новой политике, станут доступны через несколько секунд.|

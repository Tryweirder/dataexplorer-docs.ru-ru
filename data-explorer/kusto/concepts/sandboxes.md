---
title: "\"Песочницы\" — Azure обозреватель данных"
description: В этой статье описываются изолированные среды в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: 7dbbd4b94169e6b1e23547c7a6b9ed94cf5e70ca
ms.sourcegitcommit: be1bbd62040ef83c08e800215443ffee21cb4219
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/10/2020
ms.locfileid: "84664969"
---
# <a name="sandboxes"></a>Песочницы

Служба ядра данных Kusto может запускать песочницы для конкретных потоков, которым требуется безопасная изоляция.
Примерами таких потоков являются пользовательские скрипты, которые выполняются с помощью [подключаемого модуля Python](../query/pythonplugin.md) или [подключаемого модуля R](../query/rplugin.md).

Чтобы запустить эти песочницы, Kusto использует развитую версию проекта Microsoft [drawbridge](https://www.microsoft.com/research/project/drawbridge/) . Это решение используется другими службами Майкрософт для выполнения определяемых пользователем объектов в среде с несколькими клиентами.

Потоки, выполняемые в песочницах, не изолированы. Они также являются локальными (близко к данным). Это означает, что дополнительные задержки для удаленных вызовов не добавляются.

## <a name="prerequisites"></a>Предварительные требования

* В подсистеме обработки данных не должны включено [Шифрование дисков](../../security.md#data-encryption) .
  * В будущем ожидается поддержка обеих функций, работающих параллельно.
* Необходимые пакеты (образы) для запуска изолированных программ развертываются на каждом узле механизма обработки данных и требуют выделенного пространства SSD для запуска.
  * Предполагаемый размер — 20 ГБ, то есть примерно 2,5% емкости SSD D14_v2 виртуальной машины, например, или 0,7% емкости SSD виртуальной машины L16_v1.
  * Это влияет на емкость данных кластера и может повлиять на [стоимость](https://azure.microsoft.com/pricing/details/data-explorer) кластера.

## <a name="runtime"></a>Параметры выполнения

* Изолированный оператор запроса может использовать одну или несколько изолированных программ для выполнения.
  * Песочница используется только для одного запуска, не является общей для нескольких запусков и удаляется по завершении выполнения.
  * Изолированные среды настраиваются на узле в первый раз, когда для выполнения запроса требуется песочница.
    * Это означает, что первое выполнение подключаемого модуля, использующего песочницы на узле, будет включать короткий период прогрева.
  * При перезапуске узла, например в ходе обновления службы, все запущенные в ней изолированные "песочницы" уничтожаются.
* Каждый узел поддерживает стандартное количество песочниц, готовых к выполнению входящих запросов.
  * После использования песочницы новый автоматически становится доступным для замены.
* Если предварительно распределенные песочницы не доступны для обслуживания оператора запроса, они будут регулироваться до тех пор, пока не будут доступны новые "песочницы". Дополнительные сведения см. в разделе [ошибки](#errors). Создание выделения "песочницы" может занять до 10-15 секунд на каждую изолированную среду в зависимости от номера SKU и доступных ресурсов на узле данных.

## <a name="limitations"></a>Ограничения

Некоторые ограничения можно контролировать с помощью [политики песочницы](../management/sandboxpolicy.md)на уровне кластера для каждого вида песочницы.

* **Число песочниц на узел:** Количество "песочниц" на узел ограничено.
  * Запросы, выполняемые при отсутствии доступной песочницы, будут регулироваться.
* **Сеть:** Песочница не может взаимодействовать с каким-либо ресурсом на виртуальной машине (ВМ) или вне ее.
  * Песочница не может взаимодействовать с другой песочницей.
* **ЦП:** Максимальная частота ЦП, потребляемая песочницей для процессоров своего узла, ограничена (по умолчанию — `50%` ).
  * По достижении предела использование ЦП песочницы регулируется, но выполнение продолжится.
* **Память:** Максимальный объем ОЗУ, который может потребляться песочницей, ограничен (по умолчанию — `20GB` ).
  * Достижение ограничения приводит к завершению работы песочницы и ошибке выполнения запроса.
* **Диск:** С песочницей связан уникальный и независимый каталог. Он не может получить доступ к файловой системе узла.
  * Уникальная папка предоставляет доступ к образу или пакету, который соответствует типу "песочницы". Например, ненастраиваемый пакет Python или R.
* **Дочерние процессы:** "Песочница" блокирует порождение дочерних процессов.

> [!NOTE]
> Ресурсы, используемые с песочницей, зависят не только от размера данных, обрабатываемых как часть запроса, но также и от логики, которая выполняется в песочнице, и реализации библиотек, используемых этой средой.
> Например, для `python` `r` подключаемых модулей и второй означает предоставляемый пользователем сценарий и библиотеки Python или R, которые он использует во время выполнения.

## <a name="errors"></a>ошибки

|Код                      |Сообщение                                                                                        |Потенциальная причина                                                                                                    |
|--------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
|E_SB_QUERY_THROTTLED_ERROR|Изолированный запрос был прерван из-за регулирования. Повторная попытка после некоторой задержки может быть выполнена   |На целевом узле нет доступных изолированных программ. Новые "песочницы" должны стать доступными через несколько секунд     |
|E_SB_QUERY_THROTTLED_ERROR|"Песочницы" типа "{Kind}" еще не инициализированы                       |Политика "песочницы" недавно изменилась. Новые "песочницы", подчиняются новой политике, станут доступны через несколько секунд.           |

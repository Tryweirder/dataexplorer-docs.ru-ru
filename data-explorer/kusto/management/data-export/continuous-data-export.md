---
title: Непрерывная экспорт данных в Azure обозреватель данных | Документация Майкрософт
description: В этой статье описывается непрерывный экспорт данных в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: yifats
ms.service: data-explorer
ms.topic: reference
ms.date: 08/03/2020
ms.openlocfilehash: be16f33c649640ef92ed971665d4c7610c5501bf
ms.sourcegitcommit: c815c6ccf33864e21e1d3daff26a4f077dff88f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2020
ms.locfileid: "95012195"
---
# <a name="continuous-data-export-overview"></a>Общие сведения о непрерывном экспорте данных

В этой статье описывается непрерывный экспорт данных из Kusto во [внешнюю таблицу](../external-table-commands.md) с периодическим выполнением запроса. Результаты хранятся во внешней таблице, которая определяет назначение, например хранилище BLOB-объектов Azure, и схему экспортированных данных. Этот процесс гарантирует, что все записи экспортируются «ровно один раз» с некоторыми [исключениями](#exactly-once-export). 

Чтобы включить непрерывный экспорт данных, [Создайте внешнюю таблицу](../external-tables-azurestorage-azuredatalake.md#create-or-alter-external-table) , а затем [Создайте определение непрерывного экспорта](create-alter-continuous.md) , указывающее на внешнюю таблицу. 

> [!NOTE]
> Для всех команд непрерывного экспорта требуются [разрешения администратора базы данных](../access-control/role-based-authorization.md).

## <a name="continuous-export-guidelines"></a>Рекомендации по непрерывному экспорту

* **Схема вывода**:
  * Схема вывода запроса экспорта должна соответствовать схеме внешней таблицы, в которую экспортируется. 
* **Частота**:
  * Непрерывный экспорт выполняется в соответствии с периодом времени, настроенным для него в `intervalBetweenRuns` свойстве. Рекомендуемое значение для этого интервала составляет по крайней мере несколько минут в зависимости от задержек, которые вы хотите принять. Интервал времени может быть меньше одной минуты, если скорость приема высока.
* **Распространение**:
  * Распределение по умолчанию в непрерывном экспорте — это `per_node` , в котором все узлы экспортируются параллельно. 
  * Этот параметр можно переопределить в свойствах команды непрерывного экспорта. Используйте `per_shard` распространение для увеличения параллелизма.
    > [!NOTE]
    > Это распределение увеличивает нагрузку на учетные записи хранения и может вызывать ограничения регулирования. 
  * Используйте `single` (или `distributed` = `false` ), чтобы полностью отключить распространение. Этот параметр может значительно замедлить процесс непрерывного экспорта и повлиять на количество файлов, создаваемых в каждой итерации непрерывного экспорта. 
* **Число файлов**:
  * Количество файлов, экспортируемых в каждой итерации непрерывного экспорта, зависит от того, как была секционирована внешняя таблица. Дополнительные сведения см. [в разделе команда экспорта во внешнюю таблицу](export-data-to-an-external-table.md#number-of-files). Каждая итерация непрерывного экспорта всегда записывает данные в новые файлы и никогда не добавляет к существующим. В результате количество экспортируемых файлов также зависит от частоты выполнения непрерывного экспорта. Параметр frequency имеет значение `intervalBetweenRuns` .
* **Учетные записи хранения внешней таблицы**:
  * Для лучшей производительности кластер Azure обозреватель данных и учетные записи хранения должны находиться в одном регионе Azure.
  * Если экспортируемый объем данных большой, рекомендуется настроить несколько учетных записей хранения для внешней таблицы, чтобы избежать регулирования хранилища. Дополнительные сведения см. в статье об [ошибках хранилища в командах экспорта](export-data-to-storage.md#failures-during-export-commands) .

## <a name="exactly-once-export"></a>Точно после экспорта

Чтобы гарантировать Однократный экспорт, непрерывный экспорт использует [курсоры базы данных](../databasecursor.md). [Политика инжестионтиме](../ingestiontime-policy.md) должна быть включена во всех таблицах, на которые ссылается запрос, которые должны обрабатываться «ровно один раз» в процессе экспорта. Политика включена по умолчанию во всех вновь создаваемых таблицах.

Гарантия экспорта «только один раз» предназначена только для файлов, передаваемых в [команде «показывать экспортированные артефакты](show-continuous-artifacts.md)». Непрерывный экспорт не гарантирует, что каждая запись будет записываться только один раз во внешнюю таблицу. Если сбой происходит после начала экспорта и некоторые артефакты уже записаны во внешнюю таблицу, то внешняя таблица может содержать дубликаты. Если операция записи была прервана до завершения, внешняя таблица может содержать поврежденные файлы. В таких случаях артефакты не удаляются из внешней таблицы, но не будут отображаться в [команде показывать экспортированные артефакты](show-continuous-artifacts.md). Использование экспортированных файлов с помощью `show exported artifacts command` гарантирует отсутствие дублирований и отсутствие повреждений.

## <a name="export-from-fact-and-dimension-tables"></a>Экспорт из таблиц фактов и измерений

По умолчанию все таблицы, упоминаемые в запросе экспорта, считаются [таблицами фактов](../../concepts/fact-and-dimension-tables.md). Таким образом, они находятся в области курсора базы данных. Синтаксис явно объявляет, какие таблицы находятся в области (факт), а какие нет в области (измерение). Дополнительные сведения см. в описании параметра `over` в [команде Create](create-alter-continuous.md).

Запрос на экспорт включает только те записи, которые были соединены с момента предыдущего выполнения экспорта. Запрос на экспорт может содержать [таблицы измерений](../../concepts/fact-and-dimension-tables.md) , в которых все записи таблицы измерения включены во все запросы экспорта. При использовании соединений между таблицами фактов и измерений в непрерывном экспорте Помните, что записи в таблице фактов обрабатываются только один раз. Если экспорт выполняется, а записи в таблицах измерения отсутствуют для некоторых ключей, записи для соответствующих ключей будут либо пропущены, либо содержать значения NULL для столбцов измерений в экспортируемых файлах. Возврат пропущенных или пустых записей зависит от того, использует ли запрос внутреннее или внешнее соединение. `forcedLatency`Свойство в определении непрерывного экспорта может быть полезным в таких случаях, где таблицы фактов и измерений принимаются в одно и то же время для сопоставления записей.

> [!NOTE]
> Непрерывный экспорт только таблиц измерений не поддерживается. Запрос на экспорт должен включать по крайней мере одну таблицу фактов.

## <a name="exporting-historical-data"></a>Экспорт исторических данных

Непрерывный экспорт начинает экспорт данных только с момента создания. Записи, полученные до этого времени, следует экспортировать отдельно с помощью команды непостоянного [экспорта](export-data-to-an-external-table.md). 

Исторические данные могут быть слишком большими для экспорта в одной команде экспорта. При необходимости Разбейте запрос на несколько небольших пакетов. 

Чтобы избежать дублирования данных, экспортированных с помощью непрерывного экспорта, используйте `StartCursor` [команду «Показывать непрерывный экспорт](show-continuous-export.md) », а для экспорта — только записи `where cursor_before_or_at` значения курсора. Пример:

```kusto
.show continuous-export MyExport | project StartCursor
```

| старткурсор        |
|--------------------|
| 636751928823156645 |

За которым следует: 

```kusto
.export async to table ExternalBlob
<| T | where cursor_before_or_at("636751928823156645")
```

## <a name="resource-consumption"></a>Потребление ресурсов

* Влияние непрерывного экспорта на кластер зависит от запроса, в котором работает непрерывный экспорт. Большинство ресурсов, таких как ЦП и память, потребляются выполнением запроса. 
* Количество операций экспорта, которые могут выполняться одновременно, ограничено емкостью экспорта данных кластера. Дополнительные сведения см. в разделе [регулирование](../../management/capacitypolicy.md#throttling). Если у кластера недостаточно емкости для выполнения всех непрерывных операций экспорта, некоторые из них начнут задержкой.
* [Команду Показывать команды и запросы](../commands-and-queries.md) можно использовать для оценки потребления ресурсов. 
  * Фильтрация по `| where ClientActivityId startswith "RunContinuousExports"` для просмотра команд и запросов, связанных с непрерывным экспортом.

## <a name="limitations"></a>Ограничения

* Непрерывный экспорт не работает для данных, полученных с помощью приема потоковой передачи. 
* Непрерывный экспорт нельзя настроить для таблицы, в которой включена [политика безопасность на уровне строк](../../management/rowlevelsecuritypolicy.md) .
* Непрерывный экспорт не поддерживается для внешних таблиц с `impersonate` в [строках подключения](../../api/connection-strings/storage.md).
* Непрерывный экспорт не поддерживает вызовы между базами данных и между кластерами.
* Непрерывный экспорт не предназначен для непрерывной потоковой передачи данных из обозреватель данных Azure. Непрерывный экспорт выполняется в распределенном режиме, где все узлы экспортируются параллельно. Если диапазон данных, запрашиваемых каждым запуском, невелик, выходные данные непрерывного экспорта будут иметь множество мелких артефактов. Количество артефактов зависит от количества узлов в кластере.
* Если артефакты, используемые непрерывным экспортом, предназначены для активации уведомлений сетки событий, см. [раздел Известные проблемы в документации по сетке событий](../../../ingest-data-event-grid-overview.md#known-event-grid-issues).

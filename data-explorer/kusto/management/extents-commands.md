---
title: Управление экстентами (сегментами данных) в Azure обозреватель данных | Документация Майкрософт
description: В этой статье описывается управление экстентами (сегментами данных) в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/19/2020
ms.openlocfilehash: ca66beaad41796dff38a5bd5ce1fad2e0f41fc72
ms.sourcegitcommit: 974d5f2bccabe504583e387904851275567832e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/18/2020
ms.locfileid: "83550509"
---
# <a name="extents-data-shards-management"></a>Управление экстентами (сегментами данных)

Сегменты данных называются **экстентами** в Kusto, а все команды используют "экстент" или "экстенты" в качестве синонима.

## <a name="show-extents"></a>. Отображение экстентов

**Уровень кластера**

`.show` `cluster` `extents` [`hot`]

Отображает сведения о экстентах (сегментах данных), имеющихся в кластере.
Если `hot` указан параметр, отображаются только те экстенты, которые должны находиться в активном кэше.

**Уровень базы данных**

`.show``database` *DatabaseName* `extents` [ `(` *ExtentId1* `,` ... `,` *Екстентидн* `)` ] [ `hot` ] [ `where` `tags` ( `has` | `contains` | `!has` | `!contains` ) *Tag1* [ `and` `tags` ( `has` | `contains` | `!has` | `!contains` ) *Tag2*...]]

Отображает сведения об экстентах (сегментах данных), которые имеются в указанной базе данных.
Если `hot` указан параметр, отображаются только те экстенты, которые должны находиться в активном кэше.

**Уровень таблиц**

`.show``table` *TableName* `extents` [ `(` *ExtentId1* `,` ... `,` *Екстентидн* `)` ] [ `hot` ] [ `where` `tags` ( `has` | `contains` | `!has` | `!contains` ) *Tag1* [ `and` `tags` ( `has` | `contains` | `!has` | `!contains` ) *Tag2*...]]

`.show``tables` `(` *TableName1* `,` ... `,` *Табленамен* `)` `extents`[ `(` *ExtentId1* `,` ... `,` *Екстентидн* `)` ] [ `hot` ] [ `where` `tags` ( `has` | `contains` | `!has` | `!contains` ) *Tag1* [ `and` `tags` ( `has` | `contains` | `!has` | `!contains` ) *Tag2*...]]

Отображает сведения об экстентах (сегментах данных), которые находятся в указанных таблицах (база данных берется из контекста команды).
Если `hot` указан параметр, отображаются только те экстенты, которые должны находиться в активном кэше.

**ПРИМЕЧАНИЯ**

* Использование команд базы данных и/или уровня таблицы выполняется гораздо быстрее, чем фильтрация (добавление `| where DatabaseName == '...' and TableName == '...'` ) результатов команды уровня кластера.
* Если указан необязательный список идентификаторов экстентов, то возвращенный набор данных ограничен только этими экстентами.
    * Опять же, это происходит гораздо быстрее, чем фильтрация (добавление `| where ExtentId in(...)` в) результатов выполнения команд "UN".
* Фильтры Case `tags` указаны:
  * Возвращаемый список ограничен этими экстентами, Коллекция тегов которых подчиняется *всем* указанным фильтрам тегов.
    * Опять же, это происходит гораздо быстрее, чем фильтрация (добавление `| where Tags has '...' and Tags contains '...'` ) результатов выполнения команд "UN".
  * `has`Фильтры — это фильтры равенства: экстенты, которые не помечены ни одним из указанных тегов, будут отфильтрованы.
  * `!has`Фильтры являются отрицательными фильтрами: экстенты, помеченные любым из указанных тегов, будут отфильтрованы.
  * `contains`фильтры не учитывают регистр в фильтрах подстрок: экстенты, не имеющие указанных строк в качестве подстроки любого из их тегов, будут отфильтрованы. 
  * `!contains`фильтры содержат нечувствительные к регистру подстроку отрицательные фильтры: экстенты, которые содержат указанные строки в виде подстроки любого из их тегов, будут отфильтрованы. 
  
  * **Примеры**
    * Экстент `E` в таблице `T` помечен тегами `aaa` `BBB` и `ccc` .
    * Этот запрос возвратит `E` : 
    
    ```kusto 
    .show table T extents where tags has 'aaa' and tags contains 'bb' 
    ``` 
    
    * Этот запрос *не* будет возвращен `E` (так как он не помечен тегом, который равен `aa` ):
    
    ```kusto 
    .show table T extents where tags has 'aa' and tags contains 'bb' 
    ``` 
    
    * Этот запрос возвратит `E` : 
    
    ```kusto 
    .show table T extents where tags contains 'aaa' and tags contains 'bb' 
    ``` 

|Выходной параметр |Type |Описание 
|---|---|---
|екстентид |Guid |Идентификатор экстента 
|имя_базы_данных |Строка |База данных, к которой принадлежит этот экстент 
|TableName |Строка |Таблица, к которой принадлежат экстенты 
|макскреатедон |Дата и время |Дата и время создания экстента (для Объединенного экстента — максимальное время создания между экстентами источника). 
|оригиналсизе |Double |Исходный размер данных экстента в байтах 
|екстентсизе |Double |Размер экстента в памяти (сжатый и индексный) 
|CompressedSize |Double |Сжатый размер данных экстента в памяти 
|IndexSize |Double |Размер индекса данных экстента 
|Blocks |Long |Объем блоков данных в экстенте 
|Сегменты |Long |Объем сегмента данных в экстенте 
|ассигнеддатанодес |Строка | Не рекомендуется (пустая строка)
|лоадеддатанодес |Строка |Не рекомендуется (пустая строка)
|екстентконтаинерид |Строка | Идентификатор контейнера экстента, в котором находится экстент
|RowCount |Long |Количество строк в экстенте
|минкреатедон |Дата и время |Дата и время создания экстента (для Объединенного экстента — минимальное время создания в пределах исходных экстентов). 
|Теги|Строка|Теги (если имеются), определенные для экстента 
 
**Примеры**

```kusto 
// Show volume of extents being created per hour in a specific database
.show database MyDatabase extents | summarize count(ExtentId) by MaxCreatedOn bin=time(1h) | render timechart  

// Show volume of data arriving by table per hour 
.show database MyDatabase extents  
| summarize sum(OriginalSize) by TableName, MaxCreatedOn bin=time(1h)  
| render timechart

// Show data size distribution by table 
.show database MyDatabase extents | summarize sum(OriginalSize) by TableName

// Show all extents in the database named 'GamesDB' 
.show database GamesDB extents

// Show all extents in the table named 'Games' 
.show table Games extents

// Show all extents in the tables named 'TaggingGames1' and 'TaggingGames2', tagged with both 'tag1' and 'tag2' 
.show tables (TaggingGames1,TaggingGames2) extents where tags has 'tag1' and tags has 'tag2'
``` 
 
## <a name="merge-extents"></a>. объединение экстентов

**Синтаксис**

`.merge``[async | dryrun]` *TableName* `(` *GUID1* [ `,` *GUID2* ...] `)``[with(rebuild=true)]`

Эта команда выполняет слияние экстентов (см. [Обзор экстентов (сегментов данных)](extents-overview.md)), указанных идентификаторами в указанной таблице.

Существует 2 разновидности операций слияния: *Merge* (перестроение индексов) и *Перестроение* (которая полностью повторно принимает данные).

* `async`: Операция будет выполнена асинхронно. результатом будет идентификатор операции (GUID), который можно запустить `.show operations <operation ID>` с помощью, чтобы просмотреть состояние команды & состояние.
* `dryrun`: В операции будут перечислены только те экстенты, которые должны быть объединены, но фактически не будут объединены. 
* `with(rebuild=true)`: экстенты будут перестроены (данные будут повторно приняты) вместо слияния (индексы будут перестроены).

**Возврат выходных данных**

Выходной параметр |Type |Описание 
---|---|---
оригиналекстентид |строка |Уникальный идентификатор (GUID) для исходного экстента в исходной таблице, который был объединен с целевым экстентом. 
ресултекстентид |строка |Уникальный идентификатор (GUID) экстента результатов, который был создан из исходных экстентов. При сбое — "Failed" или "Покинутая".
Duration |Интервал времени |Период времени, затраченный на завершение операции слияния.

**Примеры**

Перестраивает два отдельных экстента в `MyTable` , выполняемые асинхронно
```kusto
.merge async MyTable (e133f050-a1e2-4dad-8552-1f5cf47cab69, 0d96ab2d-9dd2-4d2c-a45e-b24c65aa6687) with(rebuild=true)
```

Выполняет слияние двух конкретных экстентов в `MyTable` , синхронно
```kusto
.merge MyTable (12345050-a1e2-4dad-8552-1f5cf47cab69, 98765b2d-9dd2-4d2c-a45e-b24c65aa6687)
```

**Примечания**
- Как правило, `.merge` команды следует запускать редко вручную, и они выполняются автоматически в фоновом режиме кластера Kusto (в соответствии с [политиками слияния](mergepolicy.md) , определенными для таблиц и баз данных).  
  - Общие рекомендации относительно критериев объединения нескольких экстентов в один из них описаны в разделе [Политика слияния](mergepolicy.md).
- `.merge`операции имеют возможное конечное состояние `Abandoned` (которое можно увидеть при запуске `.show operations` с идентификатором операции). это состояние предполагает, что исходные экстенты не были объединены вместе, так как некоторые исходные экстенты больше не существуют в исходной таблице.
  - Такое состояние должно произойти в следующих случаях:
     - Исходные экстенты были удалены в процессе хранения таблицы.
     - Исходные экстенты были перемещены в другую таблицу.
     - Исходная таблица полностью удалена или переименована.

## <a name="move-extents"></a>. Перемещение экстентов

**Синтаксис**

`.move`[ `async` ] `extents` `all` `from` `table` *SourceTableName* `to` `table` *DestinationTableName*

`.move`[ `async` ] `extents` `(` *GUID1* [ `,` *GUID2* ...] `)` `from` `table` *SourceTableName* `to` `table` *DestinationTableName* 

`.move`[ `async` ] `extents` `to` `table` *DestinationTableName*  <|  *запрос*

Эта команда выполняется в контексте определенной базы данных и перемещает указанные экстенты из исходной таблицы в целевую таблицу в транзакционном виде.
Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) для исходной и целевой таблиц.

* `async`(необязательно) указывает, выполняется ли команда асинхронно (в этом случае возвращается идентификатор операции (GUID), а состояние операции можно отслеживать с помощью команды [. показывать операции](operations.md#show-operations) ).
    * В случае использования этого параметра результаты успешного выполнения могут быть получены командой [. отобразить сведения о операции](operations.md#show-operation-details) ).

Существует три способа указать экстенты для перемещения.
1. Все экстенты конкретной таблицы должны быть перемещены.
2. Путем явного указания идентификаторов экстентов в исходной таблице.
3. Путем предоставления запроса, результаты которого указывают идентификаторы экстентов в исходных таблицах.

**Ограничения**
- Исходная и целевая таблицы должны находиться в базе данных контекста. 
- Все столбцы исходной таблицы должны существовать в целевой таблице с тем же именем и типом данных.

**Указание экстентов с помощью запроса**

```kusto 
.move extents to table TableName <| ...query... 
```

Экстенты указываются с помощью запроса Kusto, возвращающего набор записей со столбцом «Екстентид». 

**Возвращаемые выходные данные** (для выполнения синхронизации)

Выходной параметр |Type |Описание 
---|---|---
оригиналекстентид |строка |Уникальный идентификатор (GUID) для исходного экстента в исходной таблице, перемещенный в целевую таблицу. 
ресултекстентид |строка |Уникальный идентификатор (GUID) экстента результата, который был перемещен из исходной таблицы в целевую таблицу. При сбое — "Failed".
Сведения |строка |Включает сведения об ошибке в случае сбоя операции.

**Примеры**

Перемещает все экстенты из таблицы `MyTable` в таблицу `MyOtherTable` .
```kusto
.move extents all from table MyTable to table MyOtherTable
```

Перемещает 2 отдельных экстентов (по их идентификаторам экстента) из таблицы `MyTable` в таблицу `MyOtherTable` .
```kusto
.move extents (AE6CD250-BE62-4978-90F2-5CB7A10D16D7,399F9254-4751-49E3-8192-C1CA78020706) from table MyTable to table MyOtherTable
```

Перемещает все экстенты из двух отдельных таблиц ( `MyTable1` , `MyTable2` ) в таблицу `MyOtherTable` .
```kusto
.move extents to table MyOtherTable <| .show tables (MyTable1,MyTable2) extents
```

**Пример выходных данных** 

|оригиналекстентид |ресултекстентид| Сведения
|---|---|---
|e133f050-a1e2-4dad-8552-1f5cf47cab69 |0d96ab2d-9dd2-4d2c-a45e-b24c65aa6687| 
|cdbeb35b-87ea-499f-b545-defbae091b57 |a90a303c-8a14-4207-8f35-d8ea94ca45be| 
|4fcb4598-9a31-4614-903c-0c67c286da8c |97aafea1-59ff-4312-B06B-08f42187872f| 
|2dfdef64-62a3-4950-a130-96b5b1083b5a |0fb7f3da-5e28-4f09-a000-e62eb41592df| 

## <a name="drop-extents"></a>. Перетащите экстенты

Удаляет экстенты из указанной базы данных или таблицы. Эта команда имеет несколько вариантов: в одном варианте удаляемые экстенты задаются запросом Kusto, тогда как в других вариантах экстенты указываются с помощью мини-языка, описанного ниже. 
 
### <a name="specifying-extents-with-a-query"></a>Указание экстентов с помощью запроса

Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) foreach для таблиц, которые имеют экстенты, возвращенные предоставленным запросом.

Удаляет экстенты (или просто сообщает их без удаления, если `whatif` используется):

**Синтаксис**

`.drop``extents`[ `whatif` ] <| *запрос*

Экстенты указываются с помощью запроса Kusto, возвращающего набор записей со столбцом «Екстентид». 
 
### <a name="dropping-a-specific-extent"></a>Удаление определенного экстента

Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) , если указано имя таблицы вариантов.

Требуется [разрешение администратора базы данных](../management/access-control/role-based-authorization.md) в случае, если не указано имя таблицы вариантов.

**Синтаксис**

`.drop``extent` *Екстентид* [ `from` *имя_таблицы*]

### <a name="dropping-specific-multiple-extents"></a>Удаление указанных нескольких экстентов

Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) , если указано имя таблицы вариантов.

Требуется [разрешение администратора базы данных](../management/access-control/role-based-authorization.md) в случае, если не указано имя таблицы вариантов.

**Синтаксис**

`.drop``extents` `(` *ExtentId1* `,` ... *Екстентидн* `)` [ `from` *TableName*]

### <a name="specifying-extents-by-properties"></a>Указание экстентов по свойствам

Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) , если указано имя таблицы вариантов.

Требуется [разрешение администратора базы данных](../management/access-control/role-based-authorization.md) в случае, если не указано имя таблицы вариантов.

`.drop``extents`[ `older` *N* ( `days`  |  `hours` )] `from` (*TableName*  |  `all` `tables` ) [ `trim` `by` ( `extentsize`  |  `datasize` ) *N* ( `MB`  |  `GB`  |  `bytes` )] [ `limit` *лимиткаунт*]

* `older`: Будут удалены только экстенты старше *N* дней/ч. 
* `trim`: Операция обрезает данные в базе данных до тех пор, пока сумма экстентов не будет соответствовать требуемому размеру (MaxSize) 
* `limit`: Операция будет применена к первым экстентам *лимиткаунт* 

Команда поддерживает режим эмуляции ( `.drop-pretend` а не `.drop` ), которая создает выходные данные, как если бы команда выполнялась, но без фактического выполнения.

**Примеры**

Удалить все экстенты, созданные более 10 дней назад, из всех таблиц в базе данных`MyDatabase`

```kusto
.drop extents <| .show database MyDatabase extents | where CreatedOn < now() - time(10d)
```

Удаляет все экстенты в таблицах `Table1` и `Table2` , время создания которых было более 10 дней назад:

```kusto
.drop extents older 10 days from tables (Table1, Table2)
```

Режим эмуляции: показывает, какие экстенты будут удалены командой (параметр идентификатора экстента неприменим для этой команды):

```kusto
.drop-pretend extents older 10 days from all tables
```

Удаляет все экстенты из "Тесттабле":

```kusto
.drop extents from TestTable
```
 
**Возврат выходных данных**

|Выходной параметр |Type |Описание 
|---|---|---
|екстентид |Строка |Екстентид, которые были удалены в результате выполнения команды 
|TableName |Строка |Имя таблицы, где экстент находится в долговременном виде  
|CreatedOn |Дата и время |Отметка времени, содержащая сведения об изначальном создании экстента 
 
**Пример выходных данных** 

|Идентификатор экстента |Имя таблицы |Создана 
|---|---|---
|43c6e03f-1713-4ca7-a52a-5db8a4e8b87d |TestTable |2015-01-12 12:48:49.4298178 

## <a name="replace-extents"></a>. Замена экстентов

**Синтаксис**

`.replace`[ `async` ] `extents` `in` `table` *DestinationTableName* `<| 
{` *запрос для удаляемых экстентов из* `},{` *запроса таблицы для перемещаемых экстентов в таблицу*`}`

Эта команда выполняется в контексте определенной базы данных, Перемещает указанные экстенты из исходных таблиц в целевую таблицу и удаляет указанные экстенты из целевой таблицы.
Все операции DROP и Move выполняются в одной транзакции.

Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) для исходной и целевой таблиц.

* `async`(необязательно) указывает, выполняется ли команда асинхронно (в этом случае возвращается идентификатор операции (GUID), а состояние операции можно отслеживать с помощью команды [. показывать операции](operations.md#show-operations) ).
    * В случае использования этого параметра результаты успешного выполнения могут быть получены командой [. отобразить сведения о операции](operations.md#show-operation-details) ).

Указание экстентов, которые следует удалить или переместить, осуществляется путем предоставления 2 запросов.
- *запрос к экстентам, удаляемым из таблицы* . Результаты этого запроса указывают идентификаторы экстентов  
, который должен быть удален из целевой таблицы.
- *запрос к экстентам, перемещаемым в таблицу* . Результаты этого запроса указывают идентификаторы экстентов в исходных таблицах, которые должны быть перемещены в целевую таблицу.

Оба запроса должны возвращать набор записей со столбцом с именем «Екстентид».

**Ограничения**
- Исходная и целевая таблицы должны находиться в базе данных контекста. 
- Все экстенты, заданные *запросом для экстентов* , удаляемых из таблицы, должны принадлежать целевой таблице.
- Все столбцы в исходных таблицах должны существовать в целевой таблице с тем же именем и типом данных.

**Возвращаемые выходные данные** (для выполнения синхронизации)

Выходной параметр |Type |Описание 
---|---|---
оригиналекстентид |строка |Уникальный идентификатор (GUID) для исходного экстента в исходной таблице, который был перемещен в целевую таблицу или — экстент в целевой таблице, который был удален.
ресултекстентид |строка |Уникальный идентификатор (GUID) для экстента результата, который был перемещен из исходной таблицы в целевую таблицу, или значение-Empty, если экстент был удален из целевой таблицы. При сбое — "Failed".
Сведения |строка |Включает сведения об ошибке в случае сбоя операции.

> [!NOTE]
> Команда завершится ошибкой, если экстенты, возвращенные *экстентами для удаления из запроса таблицы* , не существуют в целевой таблице. Это может произойти, если экстенты были объединены до выполнения команды replace. Чтобы команда завершилась с ошибками в отсутствующих экстентах, убедитесь, что запрос возвращает ожидаемый Екстентидс. Пример #1 ниже завершится ошибкой, если экстент, который нужно удалить, не существует в таблице Мйосертабле. В примере #2, однако, будет выполняться, даже если экстент, который нужно удалить, не существует, так как запрос для удаления не вернул идентификаторы экстентов. 

**Примеры**

Следующая команда перемещает все экстенты из двух отдельных таблиц ( `MyTable1` , `MyTable2` ) в таблицу `MyOtherTable` и удаляет все экстенты `MyOtherTable` , помеченные `drop-by:MyTag` :

```kusto
.replace extents in table MyOtherTable <|
    {
        .show table MyOtherTable extents where tags has 'drop-by:MyTag'
    },
    {
        .show tables (MyTable1,MyTable2) extents
    }
```

**Пример выходных данных** 

|оригиналекстентид |ресултекстентид |Сведения
|---|---|---
|e133f050-a1e2-4dad-8552-1f5cf47cab69 |0d96ab2d-9dd2-4d2c-a45e-b24c65aa6687| 
|cdbeb35b-87ea-499f-b545-defbae091b57 |a90a303c-8a14-4207-8f35-d8ea94ca45be| 
|4fcb4598-9a31-4614-903c-0c67c286da8c |97aafea1-59ff-4312-B06B-08f42187872f| 
|2dfdef64-62a3-4950-a130-96b5b1083b5a |0fb7f3da-5e28-4f09-a000-e62eb41592df| 


Следующие команды перемещают все экстенты из 1 конкретной таблицы ( `MyTable1` ) в таблицу `MyOtherTable` и удаляют конкретный экстент в `MyOtherTable` , по его идентификатору:


```kusto
.replace extents in table MyOtherTable <|
    {
        print ExtentId = "2cca5844-8f0d-454e-bdad-299e978be5df"
    },
    {
        .show table MyTable1 extents 
    }
```

```kusto
.replace extents in table MyOtherTable  <|
    {
        .show table MyOtherTable extents
        | where ExtentId == guid(2cca5844-8f0d-454e-bdad-299e978be5df) 
    },
    {
        .show table MyTable1 extents 
    }
```

Следующая команда реализует логику идемпотентными, чтобы удалить экстенты из таблицы `t_dest` только в случае, если есть экстенты для перемещения из таблицы `t_source` в таблицу `t_dest` :

```kusto
.replace async extents in table t_dest <|
{
    let any_extents_to_move = toscalar( 
        t_source
        | where extent_tags() has 'drop-by:blue'
        | summarize count() > 0
    );
    let extents_to_drop =
        t_dest
        | where any_extents_to_move and extent_tags() has 'drop-by:blue'
        | summarize by ExtentId = extent_id()
    ;
    extents_to_drop
},
{
    let extents_to_move = 
        t_source
        | where extent_tags() has 'drop-by:blue'
        | summarize by ExtentId = extent_id()
    ;
    extents_to_move
}
```

## <a name="drop-extent-tags"></a>. Перетаскивание тегов экстента

**Синтаксис**

`.drop`[ `async` ] `extent` `tags` `from` `table` *TableName* `(` '*Tag1*' [ `,` '*Tag2*' `,` ... `,` ' *Тагн*"]`)`

`.drop`[ `async` ] `extent` `tags`  <|  *запрос*

* `async`(необязательно) указывает, выполняется ли команда асинхронно (в этом случае возвращается идентификатор операции (GUID), а состояние операции можно отслеживать с помощью команды [. показывать операции](operations.md#show-operations) ).
    * В случае использования этого параметра результаты успешного выполнения могут быть получены командой [. отобразить сведения о операции](operations.md#show-operation-details) ).

Команда выполняется в контексте определенной базы данных и удаляет указанные [теги экстента](extents-overview.md#extent-tagging) из любого экстента в указанной базе данных и таблице, включая любой из тегов.  

Существует два способа указать, какие теги следует удалить, из каких экстентов:

1. Путем явного указания тегов, которые должны быть удалены из всех экстентов в указанной таблице.
2. Предоставляя запрос, результаты которого указывают идентификаторы экстентов в таблице и экстенте, то есть теги, которые следует удалить.

**Ограничения**
- Все экстенты должны находиться в базе данных контекста и должны принадлежать к одной и той же таблице. 

**Указание экстентов с помощью запроса**

Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) для всех используемых исходных и целевых таблиц.

```kusto 
.drop extent tags <| ...query... 
```

Экстенты и теги для удаления указываются с помощью запроса Kusto, возвращающего набор записей со столбцом «Екстентид» и столбцом «Tags». 

*Примечание*. при использовании [клиентской библиотеки Kusto .NET](../api/netfx/about-kusto-data.md)для создания нужной команды можно использовать следующие методы:
- `CslCommandGenerator.GenerateExtentTagsDropByRegexCommand(string tableName, string regex)`
- `CslCommandGenerator.GenerateExtentTagsDropBySubstringCommand(string tableName, string substring)`

**Возврат выходных данных**

Выходной параметр |Type |Описание 
---|---|---
оригиналекстентид |строка |Уникальный идентификатор (GUID) для исходного экстента, теги которого были изменены (и удаляются как часть операции). 
ресултекстентид |строка |Уникальный идентификатор (GUID) для экстента результата, который содержит измененные Теги (и создается и добавляется как часть операции). При сбое — "Failed".
ресултекстенттагс |строка |Коллекция тегов, с которыми помечается экстент результата (если они существуют) или NULL в случае сбоя операции.
Сведения |строка |Включает сведения об ошибке в случае сбоя операции.

**Примеры**

Удаляет `drop-by:Partition000` тег из любой области в таблице `MyOtherTable` , помеченной тегом.

```kusto
.drop extent tags from table MyOtherTable ('drop-by:Partition000')
```

Удаляет теги `drop-by:20160810104500` , `a random tag` и (или) `drop-by:20160810` из любой области таблицы, `My Table` помеченной любым из них.

```kusto
.drop extent tags from table [My Table] ('drop-by:20160810104500','a random tag','drop-by:20160810')
```

Удаляет все `drop-by` теги из экстентов в таблице `MyTable` .

```kusto
.drop extent tags <| 
  .show table MyTable extents 
  | where isnotempty(Tags)
  | extend Tags = split(Tags, '\r\n') 
  | mv-expand Tags to typeof(string)
  | where Tags startswith 'drop-by'
```

Удаляет все теги, соответствующие регулярному выражению `drop-by:StreamCreationTime_20160915(\d{6})` , из экстентов в таблице `MyTable` .

```kusto
.drop extent tags <| 
  .show table MyTable extents 
  | where isnotempty(Tags)
  | extend Tags = split(Tags, '\r\n')
  | mv-expand Tags to typeof(string)
  | where Tags matches regex @"drop-by:StreamCreationTime_20160915(\d{6})"
```

**Пример выходных данных** 

|оригиналекстентид |ресултекстентид | ресултекстенттагс | Сведения
|---|---|---|---
|e133f050-a1e2-4dad-8552-1f5cf47cab69 |0d96ab2d-9dd2-4d2c-a45e-b24c65aa6687 | Partition001 |
|cdbeb35b-87ea-499f-b545-defbae091b57 |a90a303c-8a14-4207-8f35-d8ea94ca45be | |
|4fcb4598-9a31-4614-903c-0c67c286da8c |97aafea1-59ff-4312-B06B-08f42187872f | Partition001 Partition002 |
|2dfdef64-62a3-4950-a130-96b5b1083b5a |0fb7f3da-5e28-4f09-a000-e62eb41592df | |

## <a name="alter-extent-tags"></a>. изменение тегов экстента

**Синтаксис**

`.alter`[ `async` ] `extent` `tags` `(` '*Tag1*' [ `,` '*Tag2*' `,` ... `,` ' *Тагн*"] `)`  <|  *запрос*

Команда выполняется в контексте определенной базы данных и изменяет [теги экстента](extents-overview.md#extent-tagging) всех экстентов, возвращенных указанным запросом, на указанный набор тегов.

Экстенты и теги для изменения указываются с помощью запроса Kusto, возвращающего набор записей со столбцом «Екстентид».

* `async`(необязательно) указывает, выполняется ли команда асинхронно (в этом случае возвращается идентификатор операции (GUID), а состояние операции можно отслеживать с помощью команды [. показывать операции](operations.md#show-operations) ).
    * В случае использования этого параметра результаты успешного выполнения могут быть получены командой [. отобразить сведения о операции](operations.md#show-operation-details) ).

Требуется [разрешение администратора таблицы](../management/access-control/role-based-authorization.md) для всех связанных таблиц.

**Ограничения**
- Все экстенты должны находиться в базе данных контекста и должны принадлежать к одной и той же таблице. 

**Возврат выходных данных**

Выходной параметр |Type |Описание 
---|---|---
оригиналекстентид |строка |Уникальный идентификатор (GUID) для исходного экстента, теги которого были изменены (и удаляются как часть операции). 
ресултекстентид |строка |Уникальный идентификатор (GUID) для экстента результата, который содержит измененные Теги (и создается и добавляется как часть операции). При сбое — "Failed".
ресултекстенттагс |строка |Коллекция тегов, с которыми помечается экстент результата, или значение NULL в случае сбоя операции.
Сведения |строка |Включает сведения об ошибке в случае сбоя операции.

**Примеры**

Изменяет Теги всех экстентов в таблице `MyTable` на `MyTag` .

```kusto
.alter extent tags ('MyTag') <| .show table MyTable extents
```

Изменяет Теги всех экстентов в таблице `MyTable` , с тегами `drop-by:MyTag` на `drop-by:MyNewTag` и `MyOtherNewTag` .

```kusto
.alter extent tags ('drop-by:MyNewTag','MyOtherNewTag') <| .show table MyTable extents where tags has 'drop-by:MyTag'
```

**Пример выходных данных** 

|оригиналекстентид |ресултекстентид | ресултекстенттагс | Сведения
|---|---|---|---
|e133f050-a1e2-4dad-8552-1f5cf47cab69 |0d96ab2d-9dd2-4d2c-a45e-b24c65aa6687 | Drop-By: Миневтаг Мйосерневтаг| 
|cdbeb35b-87ea-499f-b545-defbae091b57 |a90a303c-8a14-4207-8f35-d8ea94ca45be | Drop-By: Миневтаг Мйосерневтаг| 
|4fcb4598-9a31-4614-903c-0c67c286da8c |97aafea1-59ff-4312-B06B-08f42187872f | Drop-By: Миневтаг Мйосерневтаг| 
|2dfdef64-62a3-4950-a130-96b5b1083b5a |0fb7f3da-5e28-4f09-a000-e62eb41592df | Drop-By: Миневтаг Мйосерневтаг| 


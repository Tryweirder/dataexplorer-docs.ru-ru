---
title: Политика емкости — Azure обозреватель данных
description: В этой статье описывается политика емкости в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/12/2020
ms.openlocfilehash: 6d85b5cbf6752924bbaa03d2b81732cd69be6239
ms.sourcegitcommit: 80f0c8b410fa4ba5ccecd96ae3803ce25db4a442
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/30/2020
ms.locfileid: "96321630"
---
# <a name="capacity-policy"></a>Политика емкости 

Политика емкости используется для управления ресурсами вычислений операций управления данными в кластере.

## <a name="the-capacity-policy-object"></a>Объект политики емкости

Политика емкости состоит из следующих элементов:

* [инжестионкапаЦити](#ingestion-capacity)
* [екстентсмержекапаЦити](#extents-merge-capacity)
* [екстентспуржеребуилдкапаЦити](#extents-purge-rebuild-capacity)
* [експорткапаЦити](#export-capacity)
* [екстентспартитионкапаЦити](#extents-partition-capacity)

## <a name="ingestion-capacity"></a>Емкость приема

|Свойство       |Тип    |Описание    |
|-----------------------------------|--------|-----------------------------------------------------------------------------------------|
|клустермаксимумконкуррентоператионс |long    |Максимальное значение для числа одновременных операций приема в кластере.               |
|кореутилизатионкоеффиЦиент         |double  |Коэффициент для процента ядер, используемых при вычислении емкости приема. Результат вычисления всегда будет нормализован `ClusterMaximumConcurrentOperations` <br> Общая емкость приема кластера, как показано в [. Показать емкость](../management/diagnostics.md#show-capacity), вычисляется следующим образом: <br> Минимум ( `ClusterMaximumConcurrentOperations` , `Number of nodes in cluster` * максимум (1, `Core count per node`  *  `CoreUtilizationCoefficient` ))

> [!Note]
> В кластерах с тремя или более узлами узел Admin не участвует в операциях приема. Объект `Number of nodes in cluster` уменьшается на единицу.

## <a name="extents-merge-capacity"></a>Емкость слияния экстентов

|Свойство                           |Тип    |Описание                                                                                                |
|-----------------------------------|--------|-----------------------------------------------------------------------------------------------------------|
|минимумконкуррентоператионсперноде |long    |Минимальное значение для количества одновременных операций объединения и перестроения на одном узле. Значение по умолчанию — 1 |
|максимумконкуррентоператионсперноде |long    |Максимальное значение для количества одновременных операций слияния/перестроения на одном узле. Значение по умолчанию — 3 |

Общая емкость объединения экстентов кластера, как показано в [`.show capacity`](../management/diagnostics.md#show-capacity) , вычисляется следующим образом:

`Number of nodes in cluster` x `Concurrent operations per node`

Эффективное значение для `Concurrent operations per node` получается автоматически настраивается системой в диапазоне [ `MinimumConcurrentOperationsPerNode` , `MaximumConcurrentOperationsPerNode` ], если доля успешных операций слияния превышает 90%.

> [!Note]
> В кластерах с тремя или более узлами узел Admin не участвует в операциях слияния. Объект `Number of nodes in cluster` уменьшается на единицу.

## <a name="extents-purge-rebuild-capacity"></a>Емкость очистки при очистке экстентов

|Свойство                           |Тип    |Описание                                                                                                                           |
|-----------------------------------|--------|--------------------------------------------------------------------------------------------------------------------------------------|
|максимумконкуррентоператионсперноде |long    |Максимальное значение для числа параллельных перестроения экстентов для операций очистки на одном узле |

Полная степень перестроения (как показано на [`.show capacity`](../management/diagnostics.md#show-capacity) ) кластера вычисляется следующим образом:

`Number of nodes in cluster` x `MaximumConcurrentOperationsPerNode`

> [!Note]
> В кластерах с тремя или более узлами узел Admin не участвует в операциях слияния. Объект `Number of nodes in cluster` уменьшается на единицу.

## <a name="export-capacity"></a>Экспорт емкости

|Свойство                           |Тип    |Описание                                                                                                                                                                            |
|-----------------------------------|--------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|клустермаксимумконкуррентоператионс |long    |Максимальное значение для количества одновременных операций экспорта в кластере.                                           |
|кореутилизатионкоеффиЦиент         |double  |Коэффициент для процента ядер, используемых при вычислении емкости экспорта. Результат вычисления всегда будет нормализован `ClusterMaximumConcurrentOperations` . |

Общая емкость экспорта кластера, как показано на [`.show capacity`](../management/diagnostics.md#show-capacity) , вычисляется следующим образом:

Минимум ( `ClusterMaximumConcurrentOperations` , `Number of nodes in cluster` * максимум (1, `Core count per node`  *  `CoreUtilizationCoefficient` ))

> [!Note]
> В кластерах с тремя или более узлами узел Admin не участвует в операциях экспорта. Объект `Number of nodes in cluster` уменьшается на единицу.

## <a name="extents-partition-capacity"></a>Емкость раздела "экстенты"

|Свойство                           |Тип    |Описание                                                                                         |
|-----------------------------------|--------|----------------------------------------------------------------------------------------------------|
|клустерминимумконкуррентоператионс |long    |Минимальное значение для количества одновременных операций секционирования в кластере. Значение по умолчанию: 1.  |
|клустермаксимумконкуррентоператионс |long    |Максимальное значение для количества одновременных операций секционирования в кластере. По умолчанию: 16 |

Общая емкость раздела кластера (как показано на [`.show capacity`](../management/diagnostics.md#show-capacity) ).

Действующее значение для параметра `Concurrent operations` автоматически корректируется системой в диапазоне [ `ClusterMinimumConcurrentOperations` , `ClusterMaximumConcurrentOperations` ], если доля успешных операций секционирования превышает 90%.

## <a name="materialized-views-capacity-policy"></a>Политика емкости материализованных представлений

Измените политику емкости, используя параметр [изменение емкости политики кластера](capacity-policy.md#alter-cluster-policy-capacity). Для этого изменения требуются `AllDatabasesAdmin` разрешения.
Политику можно использовать для изменения параметров параллелизма материализованных представлений. Это изменение может потребоваться, если в кластере определено более одного материализованных представлений, и кластер не может поддерживать материализация всех представлений. По умолчанию параметры параллелизма относительно низкие, чтобы не влиять на производительность кластера.

> [!WARNING]
> Политика емкости материализованных представлений должна быть увеличена, только если ресурсы кластера хорошо загружены (низкая загрузка ЦП, доступная память). Увеличение этих значений при ограничении ресурсов может привести к нехватке ресурсов и негативно скажется на производительности кластера.

Политика емкости материализованных представлений является частью [политики емкости](#capacity-policy)кластера и имеет следующее представление JSON:

<!-- csl -->
``` 
{
   "MaterializedViewsCapacity": {
    "ClusterMaximumConcurrentOperations": 1,
    "ExtentsRebuildCapacity": {
      "ClusterMaximumConcurrentOperations": 50,
      "MaximumConcurrentOperationsPerNode": 5
    }
  }
}
```

### <a name="properties"></a>Свойства

Свойство | Описание
|---|---|
|`ClusterMaximumConcurrentOperations` | Максимальное количество материализованных представлений, которые кластер может одновременно материализовать. По умолчанию это значение равно 1, хотя при материализации (для отдельного отдельного представления) может выполняться множество параллельных операций. Если в кластере определено более одного материализованных представлений, и если ресурсы кластера находятся в хорошем состоянии, рекомендуется увеличить это значение. |
| `ExtentsRebuildCapacity`|  Определяет количество одновременных операций перестроения экстентов, выполняемых для всех материализованных представлений в процессе материализации. Если одновременно выполняется несколько представлений, так как `ClusterMaximumConcurrentOperation` значение больше 1, они будут совместно использовать квоту, определенную этим свойством. Максимальное количество одновременно выполняемых операций перестроения экстентов не будет превышать это значение. |

### <a name="extents-rebuild"></a>Перестроение экстентов

Дополнительные сведения об операциях перестроения экстентов см. в статье [Работа с материализованными представлениями](materialized-views/materialized-view-overview.md#how-materialized-views-work). Максимальное количество перестроений экстентов вычисляется следующим образом:
    
```kusto
Maximum(`ClusterMaximumConcurrentOperations`, `Number of nodes in cluster` * `MaximumConcurrentOperationsPerNode`)
```

* Значения по умолчанию: 50. Общее число перестроение параллелизма и максимум 5 на узел.
* `ExtentsRebuildCapacity`Политика выступает только в качестве верхнего предела. Фактически используемое значение динамически определяется системой на основе условий текущего кластера (память, ЦП) и оценки объема ресурсов, необходимых для операции перестроения. На практике параллелизм может быть значительно меньше значения, указанного в политике емкости.
    * `MaterializedViewExtentsRebuild`Метрика предоставляет сведения о том, сколько экстентов было перестроено в каждом цикле материализации. Дополнительные сведения см. в разделе [мониторинг материализованных представлений](materialized-views/materialized-view-overview.md#materialized-views-monitoring).

## <a name="defaults"></a>Умолчания;

Политика емкости по умолчанию имеет следующее представление JSON:

```json
{
  "IngestionCapacity": {
    "ClusterMaximumConcurrentOperations": 512,
    "CoreUtilizationCoefficient": 0.75
  },
  "ExtentsMergeCapacity": {
    "MinimumConcurrentOperationsPerNode": 1,
    "MaximumConcurrentOperationsPerNode": 3
  },
  "ExtentsPurgeRebuildCapacity": {
    "MaximumConcurrentOperationsPerNode": 1
  },
  "ExportCapacity": {
    "ClusterMaximumConcurrentOperations": 100,
    "CoreUtilizationCoefficient": 0.25
  },
  "ExtentsPartitionCapacity": {
    "ClusterMinimumConcurrentOperations": 1,
    "ClusterMaximumConcurrentOperations": 16
  }
}
```

## <a name="control-commands"></a>Управляющие команды

> [!WARNING]
> Перед изменением политики емкости обратитесь к группе Azure обозреватель данных.

* Используется [`.show cluster policy capacity`](capacity-policy.md#show-cluster-policy-capacity) для отображения текущей политики емкости кластера.

* Используйте [`.alter cluster policy capacity`](capacity-policy.md#alter-cluster-policy-capacity) для изменения политики емкости кластера.

## <a name="throttling"></a>Регулирование

Kusto ограничивает количество одновременных запросов для следующих инициированных пользователем команд:

* Приемы (включая все приведенные [здесь](../../ingest-data-overview.md)команды)
   * Ограничение определяется в [политике емкости](#capacity-policy).
* Очищает
   * В настоящее время глобальный характер фиксируется на одном кластере.
   * Емкость очистки при перестроении используется для внутренних целей, чтобы определить количество параллельных операций перестроения во время выполнения команд очистки. Команды очистки не будут заблокированы или регулируемы из-за этого процесса, но будут работать быстрее или медленнее в зависимости от объема очистки для перестроения.
* Экспортируемые элементы
   * Ограничение определяется в [политике емкости](#capacity-policy).

Когда кластер обнаруживает, что операция превысила разрешенную параллельную операцию, она будет отвечать на 429, "регулируемый" код HTTP.
Повторите операцию после некоторой задержки.

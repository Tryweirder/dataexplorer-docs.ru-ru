---
title: Политика кэша (горячий и холодный кэш) - Azure Data Explorer Документы Майкрософт
description: В этой статье описывается политика кэша (горячий и холодный кэш) в Azure Data Explorer.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/19/2020
ms.openlocfilehash: 591763ac5d94a8361a4b78c1b199bb05299cc004
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81522140"
---
# <a name="cache-policy-hot-and-cold-cache"></a>Политика кэша (горячий и холодный кэш)

Azure Data Explorer хранит свои данные в надежном хранилище (чаще всего хранилище Azure Blob Storage), вдали от фактических узлов обработки (например, Azure Compute). Для ускорения запросов на эти данные Azure Data Explorer кэширует эти данные (или их части) на своих обрабатывающих узлах, SSD или даже в оперативной памяти. Azure Data Explorer включает в себя сложный механизм кэша, предназначенный для разумного решения, какие объекты данных кэшировать. Кэш позволяет Azure Data Explorer описывать использовавшиеся артефакты данных (например, индексы столбцов и осколки данных столбцов), чтобы более "важные" данные могли иметь приоритет.

В то время как лучшая производительность запроса достигается при кэшировании всех просачившихся данных, часто определенные данные не оправдывают затраты на поддержание их "теплой" в локальном хранилище SSD.
Например, многие группы считают, что редко доступ к старым записям журналов имеет меньшее значение.
Они предпочли бы снизить производительность при запросе этих данных, а не платить, чтобы держать его в тепле все время.

Кэш Azure Data Explorer предоставляет детальную **политику кэша,** которую клиенты могут использовать для разграничения двух политик кэша данных: **горячего кэша данных** и **кэша холодных данных.** Кэш Azure Data Explorer пытается сохранить все данные, попадающие в кэш горячих данных в локальном SSD (или оперативной памяти), до определенного размера кэша горячих данных. Оставшееся локальное пространство SSD будет использоваться для хранения данных, которые не классифицируются как горячие. Одним из полезных последствий этой конструкции является то, что запросы, которые загружают много холодных данных из надежного хранилища, не будут высекивать данные из горячего кэша данных. Поэтому не будет существенного влияния на запросы, связанные с данными в горячем кэше данных.

Основными последствиями настройки политики горячего кэша являются:
* **Затраты** Стоимость надежного хранения может быть значительно ниже локального SSD (например, в Azure она в настоящее время примерно в 45 раз дешевле).
* **Производительность** Данные можно запрашивать быстрее, когда они в локальном SSD. Это особенно верно для запросов диапазона, т.е. запросов, которые сканируют большие объемы данных.  

[Команды управления](cache-policy.md) позволяют администраторам управлять политикой кэша.

## <a name="how-the-cache-policy-gets-applied"></a>Как применяется политика кэша

При поступления данных в Azure Data Explorer система отслеживает дату/время приема и размер ы и масштаба. Для оценки политики кэша используется значение даты/времени впредела стиха (или максимальное значение, если степень была построена из нескольких уже существующих объемов).

По умолчанию, эффективная `null`политика, что означает, что все данные считаются **горячими.**
Политика,`null` не являя на уровне таблицы, перекрывает политику уровня базы данных.

> [!Note] 
> Вы можете указать значение для даты приема/времени, используя `creationTime`свойство приема. 

## <a name="scoping-queries-to-hot-cache"></a>Отслеживание запросов на горячий кэш

Kusto поддерживает запросы, которые используются только для данных горячего кэша. Для этого можно использовать следующие способы.

- Добавить свойство `query_datascope` запроса клиента, называемое `default` `all`в `hotcache`запрос Возможные значения: , и .
- Используйте `set` выписку в тексте запроса: `set query_datascope='...'`возможные значения такие же, как и для свойства запроса клиента.
- Добавить `datascope=...` текст сразу после ссылки на таблицу в корпус запроса. Возможные значения: `all` и `hotcache`.

Значение `default` указывает на использование параметров по умолчанию кластера, которые определяют, что запрос должен охватывать все данные.



При наличии расхождения между различными `set` методами: приоритет над свойством запроса клиента, а определение значения для ссылки на таблицу имеет приоритет над обоими.

Например, в следующем запросе все ссылки таблицы будут использовать только данные hotcache, за исключением второй ссылки, на `T` которую ссылаются все данные:

```kusto
set query_datascope="hotcache";
T | union U | join (T datascope=all | where Timestamp < ago(365d) on X
```

## <a name="cache-policy-vs-retention-policy"></a>Политика кэша против удержания

Политика кэша не зависит от [политики удержания:](./retentionpolicy.md) 
- Политика кэша определяет, как расставить приоритеты ресурсов, чтобы запросы над важными данными были более быстрыми и устойчивыми к воздействию запросов на менее важные данные. 
- Политика удержания определяет степень запросных данных в таблице/базе `SoftDeletePeriod`данных (в частности, ).

Рекомендуется настроить эту политику для достижения оптимального баланса между затратами и производительностью на основе ожидаемого шаблона запросов.

Пример.
* `SoftDeletePeriod`No 56d
* `hot cache policy`28d

В этом примере последние 28 дней данные будут находиться на кластере SSD, а **дополнительные** 28 дней будут храниться в хранилище Azure blob. Вы можете запускать запросы на полные 56 дней данных. 

## <a name="cache-policy-does-not-make-kusto-a-cold-storage-technology"></a>Политика кэша не делает Kusto технологией холодного хранения

Azure Data Explorer предназначен для выполнения специальных запросов, с промежуточными наборами результатов, подходящими для общей оперативной памяти кластера. Для больших заданий, таких как map-reduce, где необходимо хранить промежуточные результаты при постоянном хранении (например, SSD), использовать функцию непрерывного экспорта. Это позволяет выполнять длительные пакетные запросы с помощью таких сервисов, как HDInsight или Azure Databricks.
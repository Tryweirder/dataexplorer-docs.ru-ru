---
title: Результаты сохраненного запроса (Предварительная версия) — Azure обозреватель данных
description: В этой статье описывается, как создавать и использовать результаты сохраненного запроса в обозреватель данных Azure.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: mispecto
ms.service: data-explorer
ms.topic: reference
ms.date: 12/3/2020
ms.openlocfilehash: 352f82bdb11847574807f81bc63236127900ae94
ms.sourcegitcommit: 202357f866801aafd92e3e29a84bb312e17aebc7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2020
ms.locfileid: "96933865"
---
# <a name="stored-query-results-preview"></a>Результаты сохраненного запроса (Предварительная версия)

Сохраняет результаты высокой плотности запросов и получает их быстро.
Результаты сохраненного запроса могут быть полезны в следующих сценариях:
* Реализация разбиения на страницы результатов. Результат сохраненного запроса создается на основе запроса, а на первой странице отображается предварительный просмотр. На каждой последующей странице показана следующая часть предварительно вычисленного результата без необходимости повторного выполнения исходного запроса.
* Временное сохранение результатов запроса во время просмотра данных.

> [!NOTE]
> Результаты сохраненного запроса находятся на этапе предварительной версии и не должны использоваться в рабочих сценариях. 

Результаты сохраненного запроса можно получить до 24 часов с момента создания. Обновления политик безопасности (например, доступ к базам данных, безопасность на уровне строк и т. д.) не распространяются на результаты сохраненного запроса. Используйте [. drop stored_query_results](#drop-stored_query_results) в случае отзыва разрешений пользователя. Результат хранимого запроса может быть получен только тем же идентификатором участника, который его создал. 

Результаты хранимых запросов ведут себя так же, как таблицы, в том, что порядок записей не сохраняется. Для разбивки результатов рекомендуется, чтобы запрос включал уникальные столбцы ИДЕНТИФИКАТОРов. Дополнительные сведения см. в статье [Подписанные URL-адреса. Часть 2: создание и использование подписанного URL-адреса в службе BLOB-объектов](#examples). Если запрос возвращает несколько результирующих наборов, будет сохранен только первый результирующий набор. 

Для использования результатов сохраненного запроса требуется `Database Viewer` или более высокая роль доступа.

## <a name="store-the-results-of-a-query"></a>Сохранение результатов запроса

**Синтаксис**

`.set``stored_query_result` *Сторедкуериресултнаме* [ `with` `(` *PropertyName* `=` *propertyvalue* `,` ... `)` ] <| *Запрос*

**Аргументы**

* *Сторедкуериресултнаме*: имя сохраненного результата запроса, которое соответствует правилам [имен сущностей](../query/schema-entities/entity-names.md) .
* *Запрос*: потенциально плотный запрос ККЛ, результаты которого будут сохранены.
* *PropertyName*: (все свойства являются необязательными)
    
    | Свойство       | Тип       | Описание       |
    |----------------|------------|-------------------------------------------------------------------------------------|
    | `expiresAfter` | `timespan` | Литерал TimeSpan, указывающий, когда истекает срок действия сохраненного запроса (максимум 24 часа). |
    | `previewCount` | `int`      | Число строк, возвращаемых в предварительной версии. Если задать для этого свойства значение `0` (по умолчанию), команда возвратит все строки результатов запроса. |
    | `distributed`  | `bool`     | Указывает, что команда сохраняет результаты запроса со всех узлов, которые выполняют запрос параллельно. Значение по умолчанию — *true*. Установка `distributed` флага в *значение false* полезно в том случае, если объем данных, создаваемых запросом, мал, или количество узлов кластера велико, чтобы предотвратить создание большого количества небольших сегментов данных. |

## <a name="retrieve-a-stored-query-result"></a>Получение результата сохраненного запроса

Чтобы получить сохраненный результат запроса, используйте `stored_query_result()` в запросе функцию:

`stored_query_result``(`"Сторедкуериресултнаме" `)` `|` ...

## <a name="examples"></a>Примеры

### <a name="simple-query"></a>Простой запрос

Сохранение простого результата запроса:

<!-- csl -->
```kusto
.set stored_query_result Numbers <| range X from 1 to 1000000 step 1
```

**Выходные данные:**

| X |
|---|
| 1 |
| 2 |
| 3 |
| ... |

Получить результат сохраненного запроса:

<!-- csl -->
```kusto
stored_query_result("Numbers")
```

**Выходные данные:**

| X |
|---|
| 1 |
| 2 |
| 3 |
| ... |

### <a name="pagination"></a>Разбиение на страницы

Получение щелчков по сети и дням Active Directory за последние семь дней:

<!-- csl -->
```kusto
.set stored_query_result DailyClicksByAdNetwork7Days with (previewCount = 100) <|
Events
| where Timestamp > ago(7d)
| where EventType == 'click'
| summarize Count=count() by Day=bin(Timestamp, 1d), AdNetwork
| order by Count desc
| project Num=row_number(), Day, AdNetwork, Count
```

**Выходные данные:**

| Num | День | аднетворк | Count |
|-----|-----|-----------|-------|
| 1 | 2020-01-01 00:00:00.0000000 | неоадс | 1002 |
| 2 | 2020-01-01 00:00:00.0000000 | хигххоризонс | 543 |
| 3 | 2020-01-01 00:00:00.0000000 | пиеадс | 379 |
| ... | ... | ... | ... |

Получить следующую страницу:

<!-- csl -->
```kusto
stored_query_result("DailyClicksByAdNetwork7Days")
| where Num between(100 .. 200)
```

**Выходные данные:**

| Num | День | аднетворк | Счетчик |
|-----|-----|-----------|-------|
| 100 | 2020-01-01 00:00:00.0000000 | куладс | 301 |
| 101 | 2020-01-01 00:00:00.0000000 | дреамадс | 254 |
| 102 | 2020-01-02 00:00:00.0000000 | суперадс | 123 |
| ... | ... | ... | ... |

## <a name="control-commands"></a>Управляющие команды

### <a name="show-stored_query_results"></a>. показывать stored_query_results

Отображает сведения о результатах активных сохраненных запросов.

>[!NOTE]
> * Пользователи с `DatabaseAdmin` `DatabaseMonitor` разрешениями или могут проверять наличие активных сохраненных результатов запроса в контексте базы данных.
> * Пользователи с `DatabaseUser` `DatabaseViewer` разрешениями или могут проверять наличие активных сохраненных результатов запроса, созданных их участниками.

#### <a name="syntax"></a>Синтаксис

`.show` `stored_query_results`

#### <a name="returns"></a>Возвращаемое значение

| сторедкуериресултид | Имя | имя_базы_данных | принЦипалидентити | сизеинбитес | RowCount | CreatedOn | ExpiresOn |
| ------------------- | ---- | ------------ | ----------------- | ----------- | -------- | --------- | --------- |
| c522ada3-e490-435a-a8b1-e10d00e7d5c2 | События | TestDB | аадапп = c28e9b80-2808-bed525fc0fbb | 104372 | 1000000 | 2020-10-07 14:26:49.6971487 | 2020-10-08 14:26:49.6971487 |

### <a name="drop-stored_query_result"></a>. Drop stored_query_result

Удаляет активный сохраненный результат запроса, созданный в текущей базе данных текущим участником.

#### <a name="syntax"></a>Синтаксис

`.drop``stored_query_result` *Сторедкуериресултнаме*

`Database Viewer` для вызова этой команды требуется разрешение.

#### <a name="returns"></a>Возвращаемое значение

Возвращает сведения об удаленных сохраненных результатах запроса, например:

| сторедкуериресултид | Имя | имя_базы_данных | принЦипалидентити | сизеинбитес | RowCount | CreatedOn | ExpiresOn |
| ------------------- | ---- | ------------ | ----------------- | ----------- | -------- | --------- | --------- |
| c522ada3-e490-435a-a8b1-e10d00e7d5c2 | События | TestDB | аадапп = c28e9b80-2808-bed525fc0fbb | 104372 | 1000000 | 2020-10-07 14:26:49.6971487 | 2020-10-08 14:26:49.6971487 |

### <a name="drop-stored_query_results"></a>. Drop stored_query_results

Удаляет результаты активных сохраненных запросов, созданные в текущей базе данных указанным участником.

`Database Admin` для вызова этой команды требуется разрешение.

#### <a name="syntax"></a>Синтаксис

`.drop``stored_query_results` `created-by` *PrincipalName*

#### <a name="returns"></a>Возвращаемое значение

Возвращает сведения об удаленных сохраненных результатах запроса.

Пример:

<!-- csl -->
```kusto
.drop stored_query_results by user 'aadapp=c28e9b80-2808-bed525fc0fbb'
```

| сторедкуериресултид | Имя | имя_базы_данных | принЦипалидентити | сизеинбитес | RowCount | CreatedOn | ExpiresOn |
| ------------------- | ---- | ------------ | ----------------- | ----------- | -------- | --------- | --------- |
| c522ada3-e490-435a-a8b1-e10d00e7d5c2 | События | TestDB | аадапп = c28e9b80-2808-bed525fc0fbb | 104372 | 1000000 | 2020-10-07 14:26:49.6971487 | 2020-10-08 14:26:49.6971487 |
| 571f1a76-f5a9-49d4-b339-ba7caac19b46 | Трассировки | TestDB | аадапп = c28e9b80-2808-bed525fc0fbb | 5212 | 100 000 | 2020-10-07 14:31:01.8271231| 2020-10-08 14:31:01.8271231 |

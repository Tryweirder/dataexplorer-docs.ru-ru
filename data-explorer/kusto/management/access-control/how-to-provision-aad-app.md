---
title: HowTo - Создание приложения AAD - Azure Data Explorer Документы Майкрософт
description: В этой статье описывается HowTo - Создание приложения AAD в Azure Data Explorer.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/18/2020
ms.openlocfilehash: 91d646d3bd0922f9daf9e8caec6fa6be5e32e2b7
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81522905"
---
# <a name="howto-creating-an-aad-application"></a>HowTo: Создание приложения AAD

Хотя аутентификация пользователей AAD очень проста (поскольку пользователи определяются в AAD админ-клиентом-арендатором, например MSIT), аутентификация приложения AAD несколько сложнее. Это происходит потому, что требуется создать и зарегистрировать приложение с Помощью AAD. Этот процесс описан ниже в некоторых деталях.

Аутентификация приложения AAD полезна для приложений, которым необходимо получить доступ к Kusto без входа пользователя в систему или его присутствия (например, служба без присмотра или запланированный поток).

Клиентские приложения и приложения среднего уровня, которые имеют интерактивный пользовательский контекст, должны избегать этой модели. Это связано с тем, что авторизация выполняется на основе итога приложения AAD вместо иноеудостоверения пользователя, поэтому вызывающей приложению необходимо будет реализовать свою собственную логику авторизации для предотвращения неправомерного использования.

## <a name="application-authentication-use-cases"></a>Случаи использования аутентификации приложений

Там два основных сценария, которые используют проверку подлинности приложения:
* Приложения, которые обращаются в службу Kusto напрямую и от своего имени
* Приложения, которые будут аутентифицировать своих пользователей в Kusto (делегированная аутентификация)

## <a name="1-provisioning-a-new-application"></a>1. Подготовка нового приложения

#### <a name="register-the-new-application"></a>Регистрация нового приложения

1. Войдите на [портал Azure](https://portal.azure.com) и откройте лезвие. `Azure Active Directory`

    ![альт текст](./images/Aad-create-app-step-0.png "Aad-создать-приложение-шаг-0")

1. Выберите `App registrations` и когда лезвие загружается, выберите `New application registration`.

    ![альт текст](./images/Aad-create-app-step-1.png "Aad-создать-приложение-шаг-1")

1. Заполните сведения о заявке:
    * Имя
    * Тип: настроен на`Web app/API`
    * URL-адрес регистрации: URL-адрес, используемый пользователями для доступа к приложению. AAD не проверяет URL-адрес,<br>
        но мандаты, которые вы предоставляете значение. Так что, если приложение не имеет какого-либо URL доступны для пользователей,<br>
        введите URL-адрес, принадлежащий приложению (например, https://<APP-CNAME> или https://<CLOUD-SERVICE-NAME>.cloudapp.net).<br>
        Вы даже можете предоставить значение и продолжить, если приложение еще не было написано.

    ![альт текст](./images/Aad-create-app-step-2.png "Aad-создать-приложение-шаг-2")

1. Как только приложение будет `Settings` готово, откройте его лезвие.

    ![альт текст](./images/Aad-create-app-step-3.png "Aad-создать-приложение-шаг-3")

1. На `Keys` лезвии нависнете аутентификация для нового приложения:
    * Если вы хотите использовать общий ключ, выберите продолжительность ключа из меню выпадения и скопируйте ключ при его сгенерировании.
        Вы не сможете восстановить этот ключ.
    * Кроме того, используйте сертификат X509 для проверки подлинности приложения.
        Для этого выберите `Upload Public Key` и следуйте инструкциям для загрузки публичной части сертификата.
    * Не забудьте выбрать, `Save` когда вы закончите.

    ![альт текст](./images/Aad-create-app-step-4.png "Aad-создать-приложение-шаг-4")

Ваше приложение настроено. Если все, что вам нужно, это доступ к Kusto с недавно созданным приложением, вы сделали.

#### <a name="set-up-delegated-permissions-for-kusto-service-application"></a>Настройка делегированных разрешений для приложения обслуживания Kusto

Если вам нужно, чтобы приложение могло выполнять проверку подлинности пользователя или приложения для доступа Kusto, необходимо настроить доверительное управление между вашим приложением и Kusto:

1. На `Required permissions` лезвии выберите `Add`.

    ![альт текст](./images/Aad-create-app-step-5.png "Aad-создать-приложение-шаг-5")

1. `Select an API`Выберите, `KustoService` введите в `KustoService (Kusto)`фильтр поле и выберите .
1. Если кластеры Kusto требуют MFA, `KustoMFA` введите `KustoServiceMFA (KustoMFA)`фильтровальную коробку и выберите.

    ![альт текст](./images/Aad-create-app-step-6.png "Aad-создать-приложение-шаг-6")

1. После подтверждения выбора выберите делегированные разрешения для `Access Kusto`.

    ![альт текст](./images/Aad-create-app-step-7.png "Aad-создать-приложение-шаг-7")

1. Выберите `Done` для завершения процесса.



### <a name="2-set-permissions-to-the-application-on-kusto-cluster"></a>2. Установить разрешения на применение на кластере Кусто

> Прежде чем использовать новое приложение, проверьте, что оно выяснит решение от Graph API.<br>
    Распространение изменений AAD может занять до нескольких часов.

1. Получите доступ к администрированию базы данных, чтобы предоставить разрешения новому приложению.
Опрокидянем [раздела «Управление принципами базы данных»](../security-roles.md) для получения подробной информации об настройке разрешений.<br>
Для настройки разрешений на [Ingestion Permissions](../../api/netfx/kusto-ingest-client-permissions.md)проглатку см.
1. Добавьте подключение к этой службе в вашем Kusto Explorer, если у вас его еще нет.

### <a name="3-application-can-now-access-kusto"></a>3. Приложение теперь может получить доступ к Kusto

При использовании нового подготовленного приложения для доступа к кластерам Kusto с помощью клиентских библиотек Kusto укажите следующую строку подключения (если вы решили проверить подлинность с помощью общего ключа):

`https://`*ClusterDnsName*`/;Federated Security=True;Application Client Id=`*ApplicationClientId*`;Application Key=`*ApplicationKey*


### <a name="appendix-a-aad-errors"></a>Приложение A: Ошибки AAD

#### <a name="aad-error-aadsts650057"></a>AAD Ошибка AADSTS650057

Если ваше приложение используется для проверки подлинности пользователей или приложений для доступа kusto, необходимо настроить делегированные разрешения для сервисного приложения Kusto, т.е. заявить, что ваше приложение может аутентифицировать пользователей или приложения для доступа Kusto.
Невыполнение этого решения приведет к ошибке, аналогичной следующему, когда предпринимается попытка проверки подлинности:

`AADSTS650057: Invalid resource. The client has requested access to a resource which is not listed in the requested permissions in the client's application registration...`

Вам нужно будет следовать инструкциям по [настройке делегированных разрешений для приложения обслуживания Kusto.](#set-up-delegated-permissions-for-kusto-service-application)

#### <a name="enable-user-consent-if-needed"></a>Включить согласие пользователя, если это необходимо

Администратор-арендатор AAD может ввести политику, которая не позволяет пользователям-арендаторам давать согласие на приложения. Это приведет к ошибке, аналогичной следующему, когда пользователь пытается войти в приложение:

`AADSTS65001: The user or administrator has not consented to use the application with ID '<App ID>' named 'App Name'`

Вам необходимо попросить администратора AAD дать согласие всем пользователям в арендаторе или предоставить согласие пользователя для вашего конкретного приложения.



### <a name="appendix-b-advanced-topics-and-troubleshooting"></a>Приложение B: Расширенные темы и устранение неполадок

* См. документацию строк [соединения Kusto](../../api/connection-strings/kusto.md) для полной ссылки на поддерживаемые строки соединения

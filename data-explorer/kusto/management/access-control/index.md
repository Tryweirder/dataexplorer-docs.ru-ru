---
title: Сведения о контроле доступа к Kusto в Azure Data Explorer | Документация Майкрософт
description: В этой статье представлены сведения о контроле доступа к Kusto в Azure Data Explorer.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 11/25/2019
ms.openlocfilehash: 9d72373e8fc5c55740fa3e53a8f850a887517e7b
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81490452"
---
# <a name="kusto-access-control-overview"></a>Сведения о контроле доступа к Kusto

Контроль доступа в Kusto основан на двух аспектах:
* [Аутентификация](#authentication). Проверка удостоверения субъекта безопасности, который выполняет запрос.
* [Авторизация.](#authorization) Проверка прав субъекта безопасности, который выполняет запрос, позволяющих ему выполнять такой запрос к целевому ресурсу.

Чтобы успешно выполнить запрос или управляющую команду в кластере, базе данных или таблице Kusto, субъект должен успешно пройти как проверку подлинности, так и авторизацию.

## <a name="authentication"></a>Аутентификация


**Azure Active Directory (AAD)**  — это предпочтительная для Azure мультитенатная облачная служба каталогов, которая позволяет выполнять проверку подлинности для субъектов безопасности или настраивать федерацию с другими поставщиками удостоверений, например Microsoft Active Directory.

В корпорации Майкрософт для проверки подлинности в Kusto предпочтение отдается именно AAD. Эта служба поддерживает несколько сценариев проверки подлинности:
* **Аутентификация пользователей** (интерактивный вход в систему). Используется для аутентификации субъектов, представляющих людей.
* **Проверка подлинности приложений** (неинтерактивный вход в систему). Используется для проверки подлинности служб и приложений, которые должны запускаться и (или) проходить проверку подлинности без участия пользователя. 

### <a name="user-authentication"></a>Аутентификация пользователей
Аутентификация пользователя выполняется, когда он передает учетные данные в AAD (или другому поставщику удостоверений, который работает с AAD, например ADFS) и получает маркер безопасности для предъявления службе Kusto. Служба Kusto не определяет, как был получен этот маркер безопасности, а проверяет лишь его действительность и информацию, размещенную в нем службой AAD (или федеративным поставщиком удостоверений).

На стороне клиента Kusto поддерживает, во-первых, интерактивную проверку подлинности, при которой клиентская библиотека ADAL из AAD или другой аналогичный код предлагает пользователю ввести учетные данные. Во-вторых, платформа поддерживает проверку подлинности на основе маркеров, при которой приложение, использующее Kusto, получает действительный маркер пользователя и представляет его. И в-третьих, Kusto поддерживает сценарий, в котором приложение, использующее эту платформу, получает действительный маркер пользователя для другой службы (не Kusto), если существует отношение доверия между этим ресурсом и Kusto.

Дополнительные сведения об использовании клиентских библиотек Kusto и проверке подлинности на этой платформе с помощью AAD см. в статье [о строках подключения Kusto](../../api/connection-strings/kusto.md).

### <a name="application-authentication"></a>Проверка подлинности приложения
Если запросы не связаны с конкретным пользователем или пользователь не может ввести учетные данные, можно использовать поток проверки подлинности приложения AAD. В этом потоке приложение выполняет проверку подлинности в AAD (или у федеративного поставщика удостоверений), предоставляя некоторую секретную информацию. Разные клиенты Kusto поддерживают следующие сценарии:

* проверка подлинности приложения с помощью локально установленного сертификата X.509v2;
* проверка подлинности приложения с помощью сертификата X.509v2, передаваемого в клиентскую библиотеку как поток байтов;
* проверка подлинности приложения с помощью идентификатора приложения AAD и ключа приложения AAD (эквиваленты имени пользователя и пароля для проверки подлинности приложений);
* проверка подлинности приложения с помощью полученного ранее действительного токена AAD (выпущенного для Kusto);
* проверка подлинности приложения с помощью полученного ранее действительного токена AAD, выданного другому ресурсу, при наличии отношения доверия между этим ресурсом и Kusto.


### <a name="microsoft-accounts-msas"></a>Учетные записи Майкрософт (MSA)
Термин "Учетные записи Майкрософт (MSA)" объединяет все управляемые корпорацией Майкрософт учетные записи пользователей, не принадлежащие конкретным организациям, например `hotmail.com`, `live.com` или `outlook.com`.
Kusto поддерживает проверку подлинности для пользователей по MSA (обратите внимание, что этом случае не используются группы безопасности), которые идентифицируются по универсальным именам участников-пользователей.
Если субъект MSA настроен в ресурсе Kusto, Kusto **не будет** пытаться разрешить предоставленное имя участника-пользователя.

### <a name="authenticated-sdk-or-rest-calls"></a>Вызовы к пакету SDK или интерфейсу REST с проверкой подлинности
* При использовании REST API проверка подлинности выполняется через стандартный заголовок HTTP `Authorization`.
* При использовании любой из библиотек Kusto .NET для проверки подлинности настраиваются метод и параметры проверки подлинности в [строке подключения Kusto](../../api/connection-strings/kusto.md) или задаются свойства в объекте [Client Request Properties](https://kusto.azurewebsites.net/docs/api/request-properties.html).

### <a name="kusto-client-sdk-as-an-aad-client-application"></a>Пакет SDK клиента Kusto в виде клиентского приложения AAD
Когда клиентские библиотеки Kusto вызывают ADAL (клиентскую библиотеку AAD), чтобы получить маркер для взаимодействия с Kusto, библиотека предоставляет следующие сведения:

1. ресурс (URI кластера, например, `https://Cluster-and-region.kusto.windows.net`);
2. Идентификатор клиентского приложения AAD
3. URI перенаправления клиентского приложения AAD
4. клиент AAD (влияет на выбор конечной точки AAD для проверки подлинности; например, для клиента AAD `microsoft.com` будет использоваться конечная точка AAD `https://login.microsoftonline.com/microsoft.com`).

ADAL возвращает в клиентскую библиотеку Kusto маркер, в котором правильный URL-адрес кластера Kusto указан в качестве аудитории, а разрешение доступа к Kusto — в качестве области.

**Пример. Получение токена пользователя AAD для кластера Kusto**
```csharp
// Create Auth Context for AAD (common or tenant-specific endpoint):
AuthenticationContext authContext = new AuthenticationContext("https://login.microsoftonline.com/{AAD TenantID or name}");

// Provide your Application ID and redirect URI
var clientAppID = "{your client app id}";
var redirectUri = new Uri("{your client app redirect uri}");

// acquireTokenTask will receive the bearer token for the authenticated user
var acquireTokenTask = authContext.AcquireTokenAsync(
    $"https://{clusterNameAndRegion}.kusto.windows.net",
    clientAppID,
    redirectUri,
    new PlatformParameters(PromptBehavior.Auto, null)).GetAwaiter().GetResult();
```


## <a name="authorization"></a>Авторизация

Все авторизованные субъекты, независимо от метода проверки подлинности, проходят также проверку авторизации перед любыми действиями с ресурсами Kusto.
Kusto использует [модель авторизации на основе ролей](role-based-authorization.md), в которой участникам присваивается одна или несколько **ролей безопасности**. Авторизация считается успешной, если нужные разрешения есть хотя бы у одной из ролей участника.

Например, **роль пользователя базы данных** предоставляет субъектам безопасности (пользователям и службам) право на чтение данных из определенной базы данных, создание таблиц и функций в этой базе данных.

Связь субъектов безопасности с ролями безопасности можно определить индивидуально или через группы безопасности (определенные в AAD). Конкретные команды для этого процесса описаны в статье [о настройке правил для авторизации на основе ролей](../security-roles.md).


---
title: подключаемый модуль sql_request — Azure обозреватель данных | Документация Майкрософт
description: В этой статье описывается подключаемый модуль sql_request в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/24/2020
zone_pivot_group_filename: data-explorer/zone-pivot-groups.json
zone_pivot_groups: kql-flavors
ms.openlocfilehash: 725021ad8089d7e9ad4f897bd5a1c68f6912bf7a
ms.sourcegitcommit: d885c0204212dd83ec73f45fad6184f580af6b7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2020
ms.locfileid: "82737289"
---
# <a name="sql_request-plugin"></a>модуль sql_request.

::: zone pivot="azuredataexplorer"

  `evaluate``sql_request` `,` *SqlQuery* `,` *Options* *ConnectionString* `,` ConnectionString SqlQuery [склпараметерс [параметры]] *SqlParameters* `(``)`

`sql_request` Подключаемый модуль отправляет SQL-запрос в SQL Serverную конечную точку сети и возвращает первый набор строк в результатах.

**Аргументы**

* *ConnectionString*: `string` литерал, указывающий строку подключения, которая указывает на конечную точку сети SQL Server. Ниже приведены допустимые методы проверки подлинности и указания конечной точки сети.

* *SqlQuery*: `string` литерал, указывающий запрос, который должен быть выполнен с конечной точкой SQL. Должен возвращать один или несколько наборов строк, но только первый из них становится доступным для остальной части запроса Kusto.

* *Склпараметерс*: постоянное значение типа `dynamic` , содержащее пары "ключ-значение" для передачи в качестве параметров вместе с запросом. Необязательный элемент.
  
* *Параметры*: постоянное значение типа `dynamic` , содержащее дополнительные параметры в виде пар "ключ-значение". В настоящее `token` время можно установить только для передачи маркера доступа AAD, предоставленного вызывающим объектом, который перенаправляется в конечную точку SQL для проверки подлинности. Необязательный элемент.

**Примеры**

Следующий пример отправляет SQL-запрос в базу данных SQL Azure, получая все записи из `[dbo].[Table]`, а затем обрабатывает результаты на стороне Kusto. При проверке подлинности используется маркер AAD вызывающего пользователя.

Примечание. Этот пример не следует рассматривать как рекомендацию для фильтрации и данных проекта таким образом. Обычно предпочтительнее создавать запросы SQL для возврата минимально возможного набора данных, так как в настоящее время оптимизатор Kusto не пытается оптимизировать запросы между Kusto и SQL.

```kusto
evaluate sql_request(
  'Server=tcp:contoso.database.windows.net,1433;'
    'Authentication="Active Directory Integrated";'
    'Initial Catalog=Fabrikam;',
  'select * from [dbo].[Table]')
| where Id > 0
| project Name
```

Следующий пример идентичен предыдущему, за исключением того, что проверка подлинности SQL выполняется по имени пользователя и паролю. Обратите внимание, что для обеспечения конфиденциальности мы используем маскированные строки здесь.

```kusto
evaluate sql_request(
  'Server=tcp:contoso.database.windows.net,1433;'
    'Initial Catalog=Fabrikam;'
    h'User ID=USERNAME;'
    h'Password=PASSWORD;',
  'select * from [dbo].[Table]')
| where Id > 0
| project Name
```

**Аутентификация**

Подключаемый модуль sql_request поддерживает три метода проверки подлинности для конечной точки SQL Server.

* **Встроенная проверка подлинности AAD** (`Authentication="Active Directory Integrated"`). это предпочтительный метод, при котором пользователь или приложение проходят проверку подлинности с помощью AAD в Kusto, и тот же токен используется для доступа к конечной точке сети SQL Server.

* **Проверка подлинности имени пользователя и пароля** (`User ID=...; Password=...;`): поддержка этого метода предоставляется, когда не удается выполнить интегрированную проверку подлинности AAD. По возможности избегайте использования этого метода, так как секретная информация отправляется через Kusto.

* **Маркер доступа AAD** (`dynamic({'token': h"eyJ0..."})`). при использовании этого метода проверки подлинности маркер доступа создается вызывающим объектом и пересылается Kusto в конечную точку SQL. Строка подключения не должна содержать такие сведения о проверке `Authentication`подлинности, как, `User ID`или `Password`. Вместо этого маркер доступа передается как `token` свойство в `Options` аргументе подключаемого модуля sql_request.
     
> [!WARNING]
> Строки подключения и запросы, содержащие конфиденциальную информацию или информацию, которая должна быть защищена, должны быть замаскированы, чтобы их можно было опустить из любой трассировки Kusto.
> Дополнительные сведения см. в разделе [немаскированные строковые литералы](scalar-data-types/string.md#obfuscated-string-literals) .

**Шифрование и проверка сервера**

Следующие свойства соединения принудительно применяются при подключении к SQL Server конечной точке сети по соображениям безопасности.

* `Encrypt`имеет значение `true` безусловно.
* `TrustServerCertificate`имеет значение `false` безусловно.

В результате SQL Server должен быть настроен с действительным сертификатом сервера SSL/TLS.

**Указание конечной точки сети**

Указание конечной точки сети SQL в качестве части строки подключения является обязательным.
Правильный синтаксис:

`Server``=` *FQDN* `,` *Port*Полное доменное имя [порт] `tcp:`

Где:

* *FQDN* — полное доменное имя конечной точки.

* *Порт* — это TCP-порт конечной точки. По умолчанию `1433` предполагается.

> [!NOTE]
> Другие формы указания конечной точки сети не поддерживаются.
> Нельзя опустить, например, префикс `tcp:` , даже если это возможно при использовании клиентских библиотек SQL программным способом.



::: zone-end

::: zone pivot="azuremonitor"

Эта возможность не поддерживается в Azure Monitor

::: zone-end

---
title: процентиль (), процентили () — Azure обозреватель данных
description: В этой статье описывается процентиль (), процентили () в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: 0322dd6a8ba900fa4d55bea6b3568a5c42f61b52
ms.sourcegitcommit: 7fa9d0eb3556c55475c95da1f96801e8a0aa6b0f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2020
ms.locfileid: "91942375"
---
# <a name="percentile-percentiles-aggregation-function"></a>процентиль (), процентили () (агрегатная функция)

Возвращает оценку по заданному [значению ближайшего ранга](#nearest-rank-percentile) Генеральной совокупности, определенной `*Expr*` .
Точность зависит от плотности заполнения области процентиля. Эта функция может использоваться только в контексте агрегирования внутри [сводки](summarizeoperator.md)

* `percentiles()` функция похожа `percentile()` на, но вычисляет количество значений процентиля, что выполняется быстрее, чем вычисление каждого процентиля по отдельности.
* `percentilesw()` функция похожа `percentilew()` на, но вычисляет количество значений взвешенного процентиля, что выполняется быстрее, чем вычисление каждого процентиля по отдельности.
* `percentilew()` и `percentilesw()` позволяют вычислить взвешенные процентили. Взвешенный процентили вычисляет заданный процентили в "взвешенном" виде, рассматривая каждое значение так, как если бы оно было повторяться `weight` во время ввода.

## <a name="syntax"></a>Синтаксис

суммировать `percentile(` *выражение* `,` *процентиля*`)`

суммировать `percentiles(` *выражение* `,` *Percentile1* [ `,` *Percentile2*]`)`

суммировать `percentiles_array(` *выражение* `,` *Percentile1* [ `,` *Percentile2*]`)`

суммирование `percentiles_array(` *Expr* `,` *динамического массива* expr`)`

суммировать `percentilew(` *выражение* `,` *веигхтекспр* `,` *процентиль*`)`

суммировать `percentilesw(` *выражение* `,` *веигхтекспр* `,` *Percentile1* [ `,` *Percentile2*]`)`

суммировать `percentilesw_array(` *выражение* `,` *веигхтекспр* `,` *Percentile1* [ `,` *Percentile2*]`)`

суммировать `percentilesw_array(` *Expr* `,` *WeightExpr* `,` *динамический массив* выражений веигхтекспр`)`

## <a name="arguments"></a>Аргументы

* `*Expr*`: Выражение, которое будет использоваться для вычисления статистической обработки.
* `*WeightExpr*`: Выражение, которое будет использоваться в качестве веса значений для вычисления статистической обработки.
* `*Percentile*`: Двойная константа, указывающая процентиль.
* `*Dynamic array*`: список процентили в динамическом массиве целочисленных значений или чисел с плавающей запятой.

## <a name="returns"></a>Возвращаемое значение

Возвращает оценку для `*Expr*` указанного процентили в группе. 

## <a name="examples"></a>Примеры

Значение этого параметра `Duration` больше 95% выборки и меньше 5% образца набора.

```kusto
CallDetailRecords | summarize percentile(Duration, 95) by continent
```

Одновременно вычислить 5, 50 (медиана) и 95.

```kusto
CallDetailRecords 
| summarize percentiles(Duration, 5, 50, 95) by continent
```

:::image type="content" source="images/percentiles-aggfunction/percentiles.png" alt-text="Таблица, в которой перечислены результаты со столбцами континента и для значений длительности в пятой, фифтиесной и девяност-пятой процентили.":::

Результаты показывают, что в Европе 5% вызовов короче 11.55 s, 50% вызовов короче 3 минут, 18,46 секунд, а 95% вызовов короче 40 минут 48 секунд.

```kusto
CallDetailRecords 
| summarize percentiles(Duration, 5, 50, 95), avg(Duration)
```

## <a name="weighted-percentiles"></a>Взвешенные процентили

Предположим, что вы повторно измеряете время (продолжительность), необходимое для выполнения действия. Вместо записи каждого значения измерения вы записываете каждое значение длительности, округленное до 100 мс, и сколько раз отображается округленное значение (Буккетсизе).

Используйте `summarize percentilesw(Duration, BucketSize, ...)` для вычисления заданного процентили в "взвешенном" виде. Обработайте каждое значение длительности так, как если бы оно было повторено Буккетсизе раз во входных данных, без фактического материализации этих записей.

## <a name="example"></a>Пример

Клиент имеет набор значений задержки в миллисекундах: `{ 1, 1, 2, 2, 2, 5, 7, 7, 12, 12, 15, 15, 15, 18, 21, 22, 26, 35 }` .

Чтобы сократить пропускную способность и хранилище, выполните предварительное агрегирование следующих контейнеров: `{ 10, 20, 30, 40, 50, 100 }` . Подсчитайте количество событий в каждом контейнере, чтобы получить следующую таблицу:

:::image type="content" source="images/percentiles-aggfunction/percentilesw-table.png" alt-text="Таблица, в которой перечислены результаты со столбцами континента и для значений длительности в пятой, фифтиесной и девяност-пятой процентили.":::

В таблице показано следующее:
 * Восемь событий в контейнере из 10 мс (соответствующих подмножеству `{ 1, 1, 2, 2, 2, 5, 7, 7 }` )
 * Шесть событий в контейнере 20 мс (соответствующий подмножеству `{ 12, 12, 15, 15, 15, 18 }` )
 * Три события в контейнере 30 мс (соответствующий подмножеству `{ 21, 22, 26 }` )
 * Одно событие в контейнере 40-MS (соответствующее подмножеству `{ 35 }` )

На этом этапе исходные данные больше не доступны. Только число событий в каждом контейнере. Чтобы вычислить процентили на основе этих данных, используйте `percentilesw()` функцию.
Например, для 50, 75 и 99,9 процентили используйте следующий запрос.

```kusto
datatable (ReqCount:long, LatencyBucket:long) 
[ 
    8, 10, 
    6, 20, 
    3, 30, 
    1, 40 
]
| summarize percentilesw(LatencyBucket, ReqCount, 50, 75, 99.9) 
```

Результат выполнения приведенного выше запроса:

:::image type="content" source="images/percentiles-aggfunction/percentilesw-result.png" alt-text="Таблица, в которой перечислены результаты со столбцами континента и для значений длительности в пятой, фифтиесной и девяност-пятой процентили." border="false":::


Приведенный выше запрос соответствует функции `percentiles(LatencyBucket, 50, 75, 99.9)` , если данные были расширены до следующего вида:

:::image type="content" source="images/percentiles-aggfunction/percentilesw-rawtable.png" alt-text="Таблица, в которой перечислены результаты со столбцами континента и для значений длительности в пятой, фифтиесной и девяност-пятой процентили.":::

## <a name="getting-multiple-percentiles-in-an-array"></a>Получение нескольких процентили в массиве

Несколько процентили можно получить в виде массива в одном динамическом столбце, а не в нескольких столбцах.

```kusto
CallDetailRecords 
| summarize percentiles_array(Duration, 5, 25, 50, 75, 95), avg(Duration)
```

:::image type="content" source="images/percentiles-aggfunction/percentiles-array-result.png" alt-text="Таблица, в которой перечислены результаты со столбцами континента и для значений длительности в пятой, фифтиесной и девяност-пятой процентили.":::

Аналогичным образом взвешенные процентили можно вернуть в виде динамического массива с помощью `percentilesw_array` .

Процентили для `percentiles_array` и `percentilesw_array` могут быть указаны в динамическом массиве целых чисел или числа с плавающей запятой. Массив должен быть константой, но его значение не должно быть литералом.

```kusto
CallDetailRecords 
| summarize percentiles_array(Duration, dynamic([5, 25, 50, 75, 95])), avg(Duration)
```

```kusto
CallDetailRecords 
| summarize percentiles_array(Duration, range(0, 100, 5)), avg(Duration)
```

## <a name="nearest-rank-percentile"></a>Ближайшее звание процентиль

*P*-й процентиль (0 < *P* <= 100) списка упорядоченных значений, отсортированных по крайней мере в самом возрастании, является наименьшим значением в списке. Значение *p* % данных меньше или равно значению *p*-го процентиля ([из статьи Википедии в процентили](https://en.wikipedia.org/wiki/Percentile#The_Nearest_Rank_method)).

Определите *0*-TH процентили, чтобы стать наименьшим элементом совокупности.

>[!NOTE]
> Учитывая приближенную природу вычисления, фактическое возвращаемое значение не может быть членом совокупности.
> Определение ближайшего ранга означает, что *P*= 50 не соответствует последовательному [определению медианы](https://en.wikipedia.org/wiki/Median). При оценке значимости этого несоответствия для конкретного приложения следует учитывать размер совокупности и [ошибки оценки](#estimation-error-in-percentiles) .

## <a name="estimation-error-in-percentiles"></a>Ошибка оценки в процентилях

Статистическая оценка процентилей предоставляет приблизительное значение с помощью [T-Digest](https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf).

>[!NOTE]
> * Границы ошибки оценки изменяются со значением запрошенного процентиля. Наилучшая точность — на обоих концах шкалы [0.. 100]. Процентили 0 и 100 — это точные минимальные и максимальные значения распределения. Точность постепенно снижается к середине шкалы. Он является наихудшим в медианы и ограничен 1%.
> * Границы ошибки наблюдаются на диапазоне, а не на значении. Предположим, что процентиль (X, 50) вернул значение XM. Оценка гарантирует, что по крайней мере 49% и не более 51% значений X будут меньше или равны XM. Нет теоретического ограничения на разницу между XM и фактическим значением медианы по оси X.
> * Иногда оценка может привести к неточным значениям, но нет надежных условий, которые можно определить, когда это будет так.

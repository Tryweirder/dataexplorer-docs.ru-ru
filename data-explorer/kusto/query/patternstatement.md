---
title: Инструкция Pattern — обозреватель данных Azure
description: В этой статье описывается инструкция Pattern в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/13/2020
zone_pivot_group_filename: data-explorer/zone-pivot-groups.json
zone_pivot_groups: kql-flavors
ms.openlocfilehash: a4aae88f6ad435469719f8444bae9123975ee618
ms.sourcegitcommit: 09da3f26b4235368297b8b9b604d4282228a443c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87346224"
---
# <a name="pattern-statement"></a>pattern, инструкция

::: zone pivot="azuredataexplorer"

**Шаблон** представляет собой именованную конструкцию, похожую на представление, которая сопоставляет предопределенные строковые кортежи с телом функций без параметров. Шаблоны уникальны в двух аспектах:

* Шаблоны вызываются с помощью синтаксиса, который напоминает ссылки на таблицу в области.
* Шаблоны имеют управляемый, близкий к себе набор значений аргументов, которые могут быть сопоставлены, а процесс сопоставления выполняется Kusto. Если шаблон объявлен, но не определен, Kusto идентифицирует и помечает все вызовы шаблона как ошибки. Такая идентификация позволяет «разрешать» эти шаблоны приложением среднего уровня.

## <a name="pattern-declaration"></a>Объявление шаблона

Оператор Pattern используется для объявления или определения шаблона.
Например, оператор pattern, объявляющий как `app` шаблон.

```kusto
declare pattern app;
```

Эта инструкция указывает Kusto, что `app` является шаблоном, но не указывает Kusto, как разрешить шаблон. В результате любая попытка вызвать этот шаблон в запросе приведет к возникновению определенной ошибки и отобразит список всех таких вызовов. Пример:

```kusto
declare pattern app;
app("ApplicationX").StartEvents
| join kind=inner app("ApplicationX").StopEvents on CorrelationId
| count
```

Этот запрос выдаст ошибку от Kusto, указывающую, что не удается разрешить следующие вызовы шаблона: `app("ApplicationX")["StartEvents"]` и `app("ApplicationX")["StopEvents"]` .

## <a name="syntax"></a>Синтаксис

`declare``pattern` *Паттерннаме*

## <a name="pattern-definition"></a>Определение шаблона

Для определения шаблона можно также использовать инструкцию pattern. В определении шаблона все возможные вызовы шаблона явным образом размещаются, а соответствующее табличное выражение задается. Когда Kusto выполняет запрос, он заменяет каждый вызов шаблона соответствующим телом шаблона. Пример:

```kusto
declare pattern app = (applicationId:string)[eventType:string]
{
    ("ApplicationX").["StopEvents"] = { database("AppX").Events | where EventType == "StopEvent" };
    ("ApplicationX").["StartEvents"] = { database(applicationId).Events | where EventType == eventType } ;
};
app("ApplicationX").StartEvents
| join kind=inner app("ApplicationX").StopEvents on CorrelationId
| count
```

Выражение, предоставляемое для каждого совпадающего шаблона, является либо именем таблицы, либо ссылкой на [инструкцию Let](letstatement.md).

## <a name="syntax"></a>Синтаксис

`declare``pattern` *PatternName*  =  Паттерннаме `(` *Аргнаме* `:` *Аргтипе* [ `,` ...] `)` [ `[` *PathName* `:` *пасаргтипе* `]` ]`{`
&nbsp;&nbsp;&nbsp;&nbsp;`(` *ArgValue1* [ `,` *ArgValue2* ...] `)` [ `.[` * пасвалуе `]` ] `=` `{` *выражение* `};` &nbsp; &nbsp; &nbsp; &nbsp; [ &nbsp; &nbsp; &nbsp; &nbsp; `(` *ArgValue1_2* [ `,` *ArgValue2_2* ...] `)` [ `.[` *PathValue_2* `]` ] `=` `{` *expression_2* `};` &nbsp; &nbsp; &nbsp; &nbsp; ... &nbsp; &nbsp; &nbsp; &nbsp; ]        `}`

* *Паттерннаме*: имя ключевого слова pattern. Синтаксис, определяющий ключевое слово only, допустим: для обнаружения всех ссылок на шаблоны с указанным ключевым словом.
* *Аргнаме*: имя аргумента шаблона. Шаблоны допускают одно или несколько имен аргументов.
* *Аргтипе*: тип аргумента шаблона (в настоящее время `string` допускается только)
* *PathName*: имя аргумента пути. Шаблоны допускают ноль или одно имя пути.
* *Пастипе*: тип аргумента пути (в настоящее время `string` допускается только)
* *ArgValue1*, *ArgValue2*,...-значения аргументов шаблона (в настоящее время `string` разрешены только литералы)
* *Пасвалуе* — значение пути к шаблону (в настоящее время `string` разрешены только литералы)
* *выражение*: *выражение* — табличное выражение (например, `Logs | where Timestamp > ago(1h)` ) или лямбда-выражение, которое ссылается на функцию.

## <a name="pattern-invocation"></a>Вызов шаблона

Синтаксис вызова шаблона аналогичен синтаксису ссылок на таблицу в области.

* *Паттерннаме* `(` *ArgValue1* [ `,` *ArgValue2* ...] `).` *Пасвалуе*
* *Паттерннаме* `(` *ArgValue1* [ `,` *ArgValue2* ...] `).["` *Пасвалуе*`"]`

## <a name="notes"></a>Примечания

**Сценарий**

Оператор Pattern предназначен для приложений среднего уровня, принимающих запросы пользователей, а затем отправляет эти запросы в Kusto. Такие приложения часто добавляют к этим запросам пользователей логическую модель схемы. Модель — это набор [инструкций Let](letstatement.md), которые, возможно, заканчиваются [оператором restrict](restrictstatement.md).

Некоторым приложениям нужен синтаксис, который может предоставить пользователям. Синтаксис используется для ссылки на сущности, определенные в логической схеме, создаваемой приложениями. Однако иногда сущности не известны заранее или количество потенциальных сущностей слишком велико, чтобы быть предварительно определенным в логической схеме.

Шаблон решает этот сценарий следующим образом. Приложение среднего уровня отправляет запрос в Kusto со всеми объявленными, но не определенными шаблонами. Затем Kusto анализирует запрос. Если существует один или несколько вызовов шаблона, Kusto возвращает ошибку в приложение среднего уровня со всеми такими вызовами, которые явно перечислены в списке. Затем приложение среднего уровня может разрешить каждую из этих ссылок и повторно выполнить запрос. На этот раз предваряйте его с помощью полностью усовершенствованного определения шаблона.

**Нормализации**

Kusto автоматически нормализует шаблон. Например, ниже приведены все вызовы одного и того же шаблона, и возвращается один из них.

```kusto
declare pattern app;
union
  app("ApplicationX").StartEvent,
  app('ApplicationX').StartEvent,
  app("ApplicationX").['StartEvent'],
  app("ApplicationX").["StartEvent"]
```

Это также означает, что их нельзя определить вместе, так как они считаются одинаковыми.

**подстановочные знаки;**

Kusto не обрабатывает подстановочные знаки в шаблоне каким-либо особым способом. Например, в следующем запросе.

```kusto
declare pattern app;
union app("ApplicationX").*
| count
```

Kusto будет сообщать об одном отсутствующем вызове шаблона: `app("ApplicationX").["*"]` .

## <a name="examples"></a>Примеры

Запрашивает больше одного вызова шаблона.

```kusto
declare pattern A
{
    // ...
};
union (A('a1').Text), (A('a2').Text)
```

|Приложение|сометекст|
|---|---|
|#1 приложений|Это бесплатный текст: 1|
|#1 приложений|Это бесплатный текст: 2|
|#1 приложений|Это бесплатный текст: 3|
|#1 приложений|Это бесплатный текст: 4|
|#1 приложений|Это бесплатный текст: 5|
|#2 приложений|Это бесплатный текст: 9|
|#2 приложений|Это бесплатный текст: 8|
|#2 приложений|Это бесплатный текст: 7|
|#2 приложений|Это бесплатный текст: 6|
|#2 приложений|Это бесплатный текст: 5|

```kusto
declare pattern App;
union (App('a1').Text), (App('a2').Text)
```

**Семантическая ошибка**:

     SEM0036: One or more pattern references weren't declared. Detected pattern references: ["App('a1').['Text']","App('a2').['Text']"].

```kusto
declare pattern App;
declare pattern App = (applicationId:string)[scope:string]  
{
    ('a1').['Data']    = { range x from 1 to 5 step 1 | project App = "App #1", Data    = x };
    ('a1').['Metrics'] = { range x from 1 to 5 step 1 | project App = "App #1", Metrics = rand() };
    ('a2').['Data']    = { range x from 1 to 5 step 1 | project App = "App #2", Data    = 10 - x };
    ('a3').['Metrics'] = { range x from 1 to 5 step 1 | project App = "App #3", Metrics = rand() };
};
union (App('a2').Metrics), (App('a3').Metrics) 
```

**Возвращена семантическая ошибка**:

    SEM0036: One or more pattern references weren't declared. Detected pattern references: ["App('a2').['Metrics']","App('a3').['Metrics']"].

::: zone-end

::: zone pivot="azuremonitor"

Эта возможность не поддерживается в Azure Monitor

::: zone-end

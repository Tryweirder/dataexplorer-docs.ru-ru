---
title: funnel_sequence плагин - Azure Data Explorer (ru) Документы Майкрософт
description: В этой статье описывается funnel_sequence плагин в Azure Data Explorer.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/13/2020
ms.openlocfilehash: a0543d0083fd90d5ee3e6e94cf1ee203f6cbd50d
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81514745"
---
# <a name="funnel_sequence-plugin"></a>Подключаемый модуль funnel_sequence

Вычисляет различные подсчеты пользователей, которые уже приняли последовательность состояний, и распределение предыдущих / следующих состояний, которые привели к / последовали последовательности. 

```kusto
T | evaluate funnel_sequence(id, datetime_column, startofday(ago(30d)), startofday(now()), 10m, 1d, state_column, dynamic(['S1', 'S2', 'S3']))
```

**Синтаксис**

*T* `| evaluate` `,` *Start* `,` *End* `,` *IdColumn* `,` *Sequence* *Step* *StateColumn* *TimelineColumn* *MaxSequenceStepWindow*IdColumn ХронологияКолонка Начало Конец MaxSequenceStepWindow , Шаг , StateColumn , Последовательность `funnel_sequence(``)`

**Аргументы**

* *T*: Входное табеляцивское выражение.
* *IdColum*: ссылка столбца, должна присутствовать в выражении источника
* *TimelineColumn*: ссылка столбца, представляющая временную шкалу, должна присутствовать в выражении источника
* *Начало*: скалирование постоянного значения периода начала анализа
* *Конец*: скалирование постоянного значения конечного периода анализа
* *MaxSequenceStepWindow:* скалирование постоянное значение максимальнодопустимого промежуток времени между 2 последовательными шагами в последовательности
* *Шаг*: скалирование постоянное значение периода шага анализа (бин)
* *StateColumn*: ссылка столбца, представляющая состояние, должна присутствовать в выражении источника
* *Последовательность*: постоянный динамический массив со значениями `StateColumn`последовательности (значения просматриваются в)

**Возвращает**

Возвращает 3 таблицы вывода, полезные для построения диаграммы санки для анализируемых последовательностей:

* Таблица #1 - prev-sequence-next dcount TimelineColumn: анализированное временное окно prev: prev состояние (может быть пустым, если были какие-либо пользователи, которые имели только события для последовательности поиска, но не какие-либо события до него). 
    далее: следующее состояние (может быть пустым, если есть какие-либо пользователи, которые только события для последовательности поиска, но не какие-либо события, которые последовали за ним). 
    подсчет: четкое <IdColumn> количество в окне времени, которое <Sequence> перешло »prev» --> --> .. 
    образцы: массив идентификаторов (от), <IdColumn>соответствующих последовательности строки (возвращается не более 128 идентификаторов). 

* Таблица #2 - prev-sequence dcount TimelineColumn: анализируемый прев-окно времени: состояние prev (может быть пустым, если были какие-либо пользователи, которые имели только события для последовательности поиска, но не какие-либо события до этого). 
    подсчет: четкое <IdColumn> количество в окне времени, которое <Sequence> перешло »prev» --> --> .. 
    образцы: массив идентификаторов (от), <IdColumn>соответствующих последовательности строки (возвращается не более 128 идентификаторов). 

* Таблица #3 - последовательность-следующая контора TimelineColumn: анализированное временное окно следующее: следующее состояние (может быть пустым, если есть какие-либо пользователи, которые только были события для последовательности поиска, но не любые события, которые последовали за ним). 
    подсчет: четкое <IdColumn> количество в окне времени, которое <Sequence> перешло »prev» --> --> .. 
    образцы: массив идентификаторов (от), <IdColumn>соответствующих последовательности строки (возвращается не более 128 идентификаторов). 


**Примеры**

### <a name="exploring-storm-events"></a>Изучение штормовых событий 

Следующий запрос смотрит на таблице StormEvents (статистика погоды за 2007 год) и показывает, что событие происходит до / после всех событий Торнадо произошло в 2007 году.

```kusto
// Looking on StormEvents statistics: 
// Q1: What happens before Tornado event?
// Q2: What happens after Tornado event?
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, dynamic(['Tornado']))
```

Результат включает в себя 3 таблицы:

* Таблица #1: Все возможные варианты того, что произошло до и после последовательности. Например, вторая строка говорит, что было 87 различных событий, которые имели следующую последовательность:`Hail` -> `Tornado` -> `Hail`


|StartTime|prev|Далее|dcount|
|---|---|---|---|
|2007-01-01 00:00:00.0000000|||293|
|2007-01-01 00:00:00.0000000|Град|Град|87|
|2007-01-01 00:00:00.0000000|Шквалистый ветер|Шквалистый ветер|77|
|2007-01-01 00:00:00.0000000|Град|Шквалистый ветер|28|
|2007-01-01 00:00:00.0000000|Град||28|
|2007-01-01 00:00:00.0000000||Град|27|
|2007-01-01 00:00:00.0000000||Шквалистый ветер|25|
|2007-01-01 00:00:00.0000000|Шквалистый ветер|Град|24|
|2007-01-01 00:00:00.0000000|Шквалистый ветер||24|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|Внезапное наводнение|12|
|2007-01-01 00:00:00.0000000|Шквалистый ветер|Внезапное наводнение|8|
|2007-01-01 00:00:00.0000000|Внезапное наводнение||8|
|2007-01-01 00:00:00.0000000|Облако воронки|Шквалистый ветер|6|
|2007-01-01 00:00:00.0000000||Облако воронки|6|
|2007-01-01 00:00:00.0000000||Внезапное наводнение|6|
|2007-01-01 00:00:00.0000000|Облако воронки|Облако воронки|6|
|2007-01-01 00:00:00.0000000|Град|Внезапное наводнение|4|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|Шквалистый ветер|4|
|2007-01-01 00:00:00.0000000|Град|Облако воронки|4|
|2007-01-01 00:00:00.0000000|Облако воронки|Град|4|
|2007-01-01 00:00:00.0000000|Облако воронки||4|
|2007-01-01 00:00:00.0000000|Шквалистый ветер|Облако воронки|3|
|2007-01-01 00:00:00.0000000|Сильный дождь|Шквалистый ветер|2|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|Облако воронки|2|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|Град|2|
|2007-01-01 00:00:00.0000000|Сильный ветер|Шквалистый ветер|1|
|2007-01-01 00:00:00.0000000|Сильный дождь|Внезапное наводнение|1|
|2007-01-01 00:00:00.0000000|Сильный дождь|Град|1|
|2007-01-01 00:00:00.0000000|Град|Наводнение|1|
|2007-01-01 00:00:00.0000000|Молнии|Град|1|
|2007-01-01 00:00:00.0000000|Сильный дождь|Молнии|1|
|2007-01-01 00:00:00.0000000|Облако воронки|Сильный дождь|1|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|Наводнение|1|
|2007-01-01 00:00:00.0000000|Наводнение|Внезапное наводнение|1|
|2007-01-01 00:00:00.0000000||Сильный дождь|1|
|2007-01-01 00:00:00.0000000|Облако воронки|Молнии|1|
|2007-01-01 00:00:00.0000000|Молнии|Шквалистый ветер|1|
|2007-01-01 00:00:00.0000000|Наводнение|Шквалистый ветер|1|
|2007-01-01 00:00:00.0000000|Град|Молнии|1|
|2007-01-01 00:00:00.0000000||Молнии|1|
|2007-01-01 00:00:00.0000000|Тропический шторм|Ураган (Тайфун)|1|
|2007-01-01 00:00:00.0000000|Прибрежный потоп||1|
|2007-01-01 00:00:00.0000000|Рип Ток||1|
|2007-01-01 00:00:00.0000000|Тяжелый снег||1|
|2007-01-01 00:00:00.0000000|Сильный ветер||1|

* Таблица #2: отображаются все различные события, сгруппированные предыдущим событием. Например, вторая строка показывает, что `Hail` было в общей сложности 150 событий, что произошло как раз перед`Tornado`

|StartTime|prev|Численность счета|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||331|
|2007-01-01 00:00:00.0000000|Град|150|
|2007-01-01 00:00:00.0000000|Шквалистый ветер|135|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|28|
|2007-01-01 00:00:00.0000000|Облако воронки|22|
|2007-01-01 00:00:00.0000000|Сильный дождь|5|
|2007-01-01 00:00:00.0000000|Наводнение|2|
|2007-01-01 00:00:00.0000000|Молнии|2|
|2007-01-01 00:00:00.0000000|Сильный ветер|2|
|2007-01-01 00:00:00.0000000|Тяжелый снег|1|
|2007-01-01 00:00:00.0000000|Рип Ток|1|
|2007-01-01 00:00:00.0000000|Прибрежный потоп|1|
|2007-01-01 00:00:00.0000000|Тропический шторм|1|

* Таблица #3: отображать все различные события, сгруппированные следующим событием. Например, вторая строка показывает, что `Hail` было в общей сложности 143 события, которые произошли после`Tornado`

|StartTime|Далее|Численность счета|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||332|
|2007-01-01 00:00:00.0000000|Град|145|
|2007-01-01 00:00:00.0000000|Шквалистый ветер|143|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|32|
|2007-01-01 00:00:00.0000000|Облако воронки|21|
|2007-01-01 00:00:00.0000000|Молнии|4|
|2007-01-01 00:00:00.0000000|Сильный дождь|2|
|2007-01-01 00:00:00.0000000|Наводнение|2|
|2007-01-01 00:00:00.0000000|Ураган (Тайфун)|1|

Теперь давайте попробуем выяснить, как продолжается следующая последовательность:  
`Hail` -> `Tornado` -> `Thunderstorm Wind`

```kusto
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, 
dynamic(['Hail', 'Tornado', 'Thunderstorm Wind']))
```

Пропуск `Table #1` и `Table #2`, и `Table #3` глядя на - `Hail`  ->  `Tornado`  ->  `Thunderstorm Wind` мы можем заключить, что последовательность в 92 событий закончился с этой последовательности, продолжал, как `Hail` в 41 событий, и вернулся в `Tornado` 14.

|StartTime|Далее|Численность счета|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||92|
|2007-01-01 00:00:00.0000000|Град|41|
|2007-01-01 00:00:00.0000000|Торнадо|14|
|2007-01-01 00:00:00.0000000|Внезапное наводнение|11|
|2007-01-01 00:00:00.0000000|Молнии|2|
|2007-01-01 00:00:00.0000000|Сильный дождь|1|
|2007-01-01 00:00:00.0000000|Наводнение|1|
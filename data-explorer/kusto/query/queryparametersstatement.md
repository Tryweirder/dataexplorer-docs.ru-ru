---
title: Оператор объявления параметров запроса — Azure обозреватель данных | Документация Майкрософт
description: В этой статье описывается инструкция объявления параметров запроса в обозреватель данных Azure.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/13/2020
zone_pivot_group_filename: data-explorer/zone-pivot-groups.json
zone_pivot_groups: kql-flavors
ms.openlocfilehash: a76755d04179b3d311e79798162c61db764455d7
ms.sourcegitcommit: d885c0204212dd83ec73f45fad6184f580af6b7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2020
ms.locfileid: "82737816"
---
# <a name="query-parameters-declaration-statement"></a>Оператор объявления параметров запроса

::: zone pivot="azuredataexplorer"

Запросы, отправляемые в Kusto, могут содержать в дополнение к самому тексту запроса набор пар "имя-значение", называемых **параметрами запроса**. Текст запроса может ссылаться на одно или несколько значений параметров запроса, указывая их имена и тип с помощью **инструкции объявления параметров запроса**.

Параметры запроса имеют два основных применения:

1. Как механизм защиты от **атак путем внедрения**.
2. Как способ параметризовать запросы.

В частности, клиентские приложения, сочетающие предоставленные пользователем входные данные в запросах, которые они затем отправляют в Kusto, должны использовать этот механизм для защиты от Kusto эквивалента атак [путем внедрения кода SQL](https://en.wikipedia.org/wiki/SQL_injection) .

## <a name="declaring-query-parameters"></a>Объявление параметров запроса

Чтобы иметь возможность ссылаться на параметры запроса, текст запроса (или используемые функции) должен сначала объявить используемый им параметр запроса. Для каждого параметра объявление предоставляет имя и скалярный тип. При необходимости параметр может также иметь значение по умолчанию, которое будет использоваться, если запрос не предоставляет конкретного значения для параметра. Затем Kusto анализирует значение параметра запроса в соответствии с обычными правилами анализа для этого типа.

**Синтаксис**

`declare``query_parameters` `:` *Type1* `,` *Name1* `=` Name1 тип1 [DefaultValue1] [...] *DefaultValue1* `(``);`

* *Name1*: имя параметра запроса, используемого в запросе.
* *Тип1*— соответствующий тип (например `string`, `datetime`, и т. д.). Значения, предоставленные пользователем, кодируются как строки, в Kusto будет применен соответствующий метод Parse к параметру запроса для получения строго типизированного значения.
* *DefaultValue1*: необязательное значение по умолчанию для параметра. Это должен быть литерал соответствующего скалярного типа.

> [!NOTE]
> Как и [определяемые пользователем функции](functions/user-defined-functions.md), параметры запроса `dynamic` типа не могут иметь значения по умолчанию.

**Примеры**

```kusto
declare query_parameters(UserName:string, Password:string);
print n=UserName, p=hash(Password)
```

```kusto
declare query_parameters(percentage:long = 90);
T | where Likelihood > percentage
```

## <a name="specifying-query-parameters-in-a-client-application"></a>Указание параметров запроса в клиентском приложении

Имена и значения параметров запроса предоставляются `string` приложением, которое делает запрос. Имя не может повторяться.

Интерпретация значений выполняется в соответствии с оператором объявления параметров запроса. Каждое значение анализируется так, как будто оно было литералом в тексте запроса в соответствии с типом, заданным в инструкции объявления параметров запроса.

### <a name="rest-api"></a>REST API

Параметры запроса предоставляются клиентскими приложениями через `properties` слот объекта JSON тела запроса во вложенном контейнере свойств с именем. `Parameters` Например, вот тело REST APIного вызова Kusto, которое вычисляет возраст некоторого пользователя (предположительно, если приложение запрашивает у пользователя свой день рождения):

``` json
{
    "ns": null,
    "db": "myDB",
    "csl": "declare query_parameters(birthday:datetime); print strcat(\"Your age is: \", tostring(now() - birthday))",
    "properties": "{\"Options\":{},\"Parameters\":{\"birthday\":\"datetime(1970-05-11)\",\"courses\":\"dynamic(['Java', 'C++'])\"}}"
}
```

### <a name="kusto-net-sdk"></a>Пакет SDK для Kusto .NET

Чтобы указать имена и значения параметров запроса при использовании клиентской библиотеки Kusto .NET, одна из них `ClientRequestProperties` создает новый экземпляр объекта, а затем использует методы `HasParameter`, `SetParameter`и `ClearParameter` для управления параметрами запроса. Обратите внимание, что этот класс предоставляет ряд строго типизированных перегрузок `SetParameter`для; на внутреннем уровне они создают соответствующий литерал языка запросов и отправляют его в виде с `string` помощью REST API, как описано выше. Сам текст запроса по-прежнему должен [объявлять примечанием запроса](#declaring-query-parameters).

### <a name="kustoexplorer"></a>Kusto.Explorer

Чтобы задать параметры запроса, отправляемые при выполнении запроса к службе, используйте значок "гаечного ключа" **параметров запроса** (`ALT` + `P`).

::: zone-end

::: zone pivot="azuremonitor"

Эта возможность не поддерживается в Azure Monitor

::: zone-end

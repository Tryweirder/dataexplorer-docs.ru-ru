---
title: Свойства запроса и Клиентрекуестпропертиес — Azure обозреватель данных
description: В этой статье описываются свойства запросов и Клиентрекуестпропертиес в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 09/23/2019
ms.openlocfilehash: b6e03370641d6801c4f74148a8fe7c20de15c3b7
ms.sourcegitcommit: 88923cfb2495dbf10b62774ab2370b59681578b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2020
ms.locfileid: "92175733"
---
# <a name="request-properties-and-clientrequestproperties"></a>Свойства запроса и Клиентрекуестпропертиес

При выполнении запроса из Kusto с помощью пакета SDK для .NET укажите:

* Строка подключения, указывающая конечную точку службы для подключения, параметры проверки подлинности и аналогичные сведения, связанные с подключением. В программном коде строка подключения представлена с помощью `KustoConnectionStringBuilder` класса.

* Имя базы данных, используемой для описания области запроса.

* Текст запроса (запроса или команды).

* Дополнительные свойства, предоставляемые клиентом службе и применяемые к запросу. Программно эти свойства удерживаются классом с именем `ClientRequestProperties` .

##   <a name="clientrequestproperties"></a>клиентрекуестпропертиес

Свойства клиентского запроса имеют много использования. 
* Упрощает отладку. Например, свойства могут предоставлять строки корреляции, которые используются для наблюдения за взаимодействием клиента и службы. 
* Влияет на ограничения и политики, применяемые к запросу. 
* [Параметры запроса](../../query/queryparametersstatement.md) позволяют клиентским приложениям параметризовать запросы Kusto на основе вводимых пользователем данных.
[список поддерживаемых свойств](#list-of-clientrequestproperties).

`Kusto.Data.Common.ClientRequestProperties`Класс содержит три типа данных.

* Именованные свойства.
* Параметры — сопоставление имени параметра со значением параметра.
* Параметры — сопоставление имени параметра запроса со значением параметра запроса.

> [!NOTE]
> Некоторые именованные свойства помечены как "не использовать". Такие свойства не должны задаваться клиентами и не влияют на службу.

## <a name="the-clientrequestid-x-ms-client-request-id-named-property"></a>Именованное свойство ClientRequestId (x-MS-Client-Request-ID)

Это именованное свойство имеет определяемое клиентом удостоверение запроса. Клиенты должны указать уникальное значение для каждого запроса с каждым отправляемым им запросом. Это значение упрощает отладку, а также требует некоторых сценариев, например для отмены запроса.

Программное имя свойства — `ClientRequestId` , а оно преобразуется в заголовок HTTP `x-ms-client-request-id` .

Если клиент не укажет значение, это свойство будет иметь значение (случайное) для пакета SDK.

Содержимое этого свойства может быть любой уникальной строкой для печати, например GUID.
Однако рекомендуется использовать клиенты: *applicationName* `.` *ActivityName* `;` *UniqueID* .

* *ApplicationName* определяет клиентское приложение, которое выполняет запрос.
* *ActivityName* определяет тип действия, для которого клиентское приложение выдает запрос клиента.
* *UniqueID* определяет конкретный запрос.

## <a name="the-application-x-ms-app-named-property"></a>Именованное свойство приложения (x-MS-App)

Именованное свойство приложения (x-MS-App) имеет имя клиентского приложения, выполняющего запрос, и используется для трассировки.

Программное имя этого свойства — `Application` , и оно преобразуется в заголовок HTTP `x-ms-app` . Его можно указать в строке подключения Kusto как `Application Name for Tracing` .

Для этого свойства будет задано имя процесса, в котором размещается пакет SDK, если клиент не укажет собственное значение.

## <a name="the-user-x-ms-user-named-property"></a>Именованное свойство пользователя (x-MS-User)

Пользователь (x-MS-пользователь) с именем свойства имеет удостоверение пользователя, выполняющего запрос, и используется для трассировки.

Программное имя этого свойства — `User` , и оно преобразуется в заголовок HTTP `x-ms-user` . Его можно указать в строке подключения Kusto как `User Name for Tracing` .

## <a name="controlling-request-properties-using-the-rest-api"></a>Управление свойствами запроса с помощью REST API

При выдаче HTTP-запроса службе Kusto используйте `properties` область в документе JSON, которая является телом запроса POST, чтобы предоставить свойства запроса. 

> [!NOTE]
> Некоторые свойства (например "идентификатор клиентского запроса", которые являются ИДЕНТИФИКАТОРом корреляции, предоставляемой клиентом службе для идентификации запроса), могут быть предоставлены в заголовке HTTP и также могут быть заданы при использовании HTTP GET.
Дополнительные сведения см. в описании [объекта запроса Kusto REST API](../rest/request.md).

## <a name="providing-values-for-query-parameterization-as-request-properties"></a>Предоставление значений для параметризации запросов в качестве свойств запроса

Запросы Kusto могут ссылаться на параметры запроса с помощью специализированной инструкции [Declare запроса-Parameters](../../query/queryparametersstatement.md) в тексте запроса. Эта инструкция позволяет клиентским приложениям параметризовать запросы Kusto на основе вводимых пользователем данных в безопасном режиме и без угрозы атак путем внедрения.

Программно, задайте значения свойств с помощью `ClearParameter` `SetParameter` методов, и `HasParameter` .

В REST API параметры запроса отображаются в той же строке в кодировке JSON, что и другие свойства запроса.

## <a name="sample-client-code-for-using-request-properties"></a>Пример клиентского кода для использования свойств запроса

```csharp
public static System.Data.IDataReader QueryKusto(
    Kusto.Data.Common.ICslQueryProvider queryProvider,
    string databaseName,
    string query)
{
    var queryParameters = new Dictionary<String, String>()
    {
        { "xIntValue", "111" },
        { "xStrValue", "abc" },
        { "xDoubleValue", "11.1" }
    };

    // Query parameters (and many other properties) are provided
    // by a ClientRequestProperties object handed alongside
    // the query:
    var clientRequestProperties = new Kusto.Data.Common.ClientRequestProperties(
        principalIdentity: null,
        options: null,
        parameters: queryParameters);

    // Having client code provide its own ClientRequestId is
    // highly recommended. It not only allows the caller to
    // cancel the query, but also makes it possible for the Kusto
    // team to investigate query failures end-to-end:
    clientRequestProperties.ClientRequestId
        = "MyApp.MyActivity;"
        + Guid.NewGuid().ToString();

    // This is an example for setting an option
    // ("notruncation", in this case). In most cases this is not
    // needed, but it's included here for completeness:
    clientRequestProperties.SetOption(
        Kusto.Data.Common.ClientRequestProperties.OptionNoTruncation,
        true);
 
    try
    {
        return queryProvider.ExecuteQuery(query, clientRequestProperties);
    }
    catch (Exception ex)
    {
        Console.WriteLine(
            "Failed invoking query '{0}' against Kusto."
            + " To have the Kusto team investigate this failure,"
            + " please open a ticket @ https://aka.ms/kustosupport,"
            + " and provide: ClientRequestId={1}",
            query, clientRequestProperties.ClientRequestId);
        return null;
    }
}
```

## <a name="list-of-clientrequestproperties"></a>Список Клиентрекуестпропертиес

<!-- The following is auto-generated by running  Kusto.Cli.exe -execute:"#crp -doc"           -->
<!-- The following text can be re-produced by running the Kusto.Cli.exe directive '#crp -doc' -->

* `debug_query_externaldata_projection_fusion_disabled` (*Оптиондебугкуеридисабликстерналдатапрожектионфусион*): Если задано, не следует запредохранительть проекцию в оператор ExternalData. Логическая
* `debug_query_fanout_threads_percent_external_data` (*Оптиондебугкуерифанаутсреадсперцентекстерналдата*): процент потоков для выполнения вентилятора для внешних узлов данных. Int
* `deferpartialqueryfailures` (*Оптиондеферпартиалкуерифаилурес*): Если значение равно true, отключает отчеты об ошибках частичных запросов в составе результирующего набора. Логическая
* `max_memory_consumption_per_query_per_node` (*Оптионмаксмемориконсумптионперкуериперноде*): переопределяет максимальный объем памяти по умолчанию, который может выделить весь запрос для каждого узла. UInt64
* `maxmemoryconsumptionperiterator` (*Оптионмаксмемориконсумптионперитератор*): переопределяет максимальный объем памяти по умолчанию, который может быть выделен оператором запроса. UInt64
* `maxoutputcolumns` (*Оптионмаксаутпутколумнс*): переопределяет максимальное число столбцов, которое может создавать запрос. Поддерживаем
* `norequesttimeout` (*Оптионнорекуесттимеаут*): позволяет задать максимальное значение времени ожидания запроса. Логическая
* `notruncation` (*Оптионнотрункатион*): включает подавление усечения результатов запроса, возвращаемого вызывающему объекту. Логическая
* `push_selection_through_aggregation` (*Оптионпушселектионсраугхаггрегатион*): Если значение true, принудительно отправляет простой выбор посредством статистической обработки [Boolean]
* `query_admin_super_slacker_mode` (*Оптионадминсуперслаккермоде*): Если значение true, делегирование выполнения запроса другому узлу [Boolean]
* `query_bin_auto_at` (*Куерибинаутоат*): при вычислении функции bin_auto () используется начальное значение. [Литералекспрессион]
* `query_bin_auto_size` (*Куерибинаутосизе*): при вычислении функции bin_auto () используется значение размера ячейки. [Литералекспрессион]
* `query_cursor_after_default` (*Оптионкуерикурсорафтердефаулт*): значение параметра по умолчанию функции cursor_after () при вызове без параметров. [string]
* `query_cursor_before_or_at_default` (*Оптионкуерикурсорбефореоратдефаулт*): значение параметра по умолчанию функции cursor_before_or_at () при вызове без параметров. [string]
* `query_cursor_current` (*Оптионкуерикурсоркуррент*): переопределяет значение курсора, возвращаемое функциями cursor_current () или current_cursor (). [string]
* `query_cursor_scoped_tables` (*Оптионкуерикурсорскопедтаблес*): список имен таблиц, область действия которых должна быть cursor_after_default.. cursor_before_or_at_default (верхняя граница является необязательной). платформе
* `query_datascope` (*Оптионкуеридатаскопе*): управляет областью данных запроса, сведения о том, применяется ли запрос ко всем данным или только к его части. ["default", "ALL" или "хоткаче"]
* `query_datetimescope_column` (*Оптионкуеридатетимескопеколумн*): управляет именем столбца для области DateTime запроса (query_datetimescope_to/query_datetimescope_from). Строка
* `query_datetimescope_from` (*Оптионкуеридатетимескопефром*): управляет областью DateTime запроса (самое раннее). Значение используется в качестве автоматического применяемого фильтра только для query_datetimescope_column (если он определен). [DateTime]
* `query_datetime\scope_to` (*Оптионкуеридатетимескопето*): управляет областью DateTime запроса (последняя). Значение используется в качестве автоматического применяемого фильтра только для query_datetimescope_column (если он определен). [DateTime]
* `query_distribution_nodes_span` (*Оптионкуеридистрибутионнодесспансизе*): Если задано, управляет способом объединения вложенных запросов: выполняемый узел будет содержать дополнительный уровень в иерархии запросов для каждой подгруппы узлов. Этот параметр задает размер подгруппы. Int
* `query_fanout_nodes_percent` (*Оптионкуерифанаутнодесперцент*): процент узлов, к которым выполняется вентилятор при выполнении. Int
* `query_fanout_threads_percent` (*Оптионкуерифанаутсреадсперцент*): процент потоков для выполнения вращения при развертывании. Int
* `query_language` (*Оптионкуерилангуаже*): управляет интерпретацией текста запроса. [' CSL ', ' ККЛ ' или ' SQL ']
* `query_max_entities_in_union` (*Оптионмаксентитиестаунион*): задает максимальное количество сущностей, которое оператору Union разрешено принимать. Поддерживаем
* `query_now` (*Оптионкуеринов*): переопределяет значение DateTime, возвращаемое функцией Now (число нулей). [DateTime]
* `query_python_debug` (*Оптиондебугписон*). Если задано, создает отладочный запрос Python для перечисленного узла Python (по умолчанию — First). [Boolean или int]
* `query_results_apply_getschema` (*Оптионкуериресултсапплижетсчема*). Если задано, получает схему всех табличных данных в результатах запроса, а не сами данные. Логическая
* `query_results_cache_max_age` (*Оптионкуериресултскачемаксаже*): Если положительный, контролирует максимальный возраст кэшированных результатов запроса, который Kusto может возвращать [TimeSpan]
* `query_results_progressive_row_count` (*Оптионпрогрессивекуериминровкаунтперупдате*): указывает Kusto количество записей для отправки в каждом обновлении. Значение вступает в силу, только если задан параметр Оптионресултспрогрессивинаблед
* `query_results_progressive_update_period` (*Оптионпрогрессивепрогрессрепортпериод*): указывает Kusto частоту отправки кадров хода выполнения. Значение вступает в силу, только если задан параметр Оптионресултспрогрессивинаблед
* `query_shuffle_broadcast_join` (*Шуффлеброадкастжоин*): включает перетасовывание по широковещательному соединению.
* `query_take_max_records` (*Оптионтакемаксрекордс*): позволяет ограничить результаты запроса этим числом записей. Поддерживаем
* `queryconsistency` (*Оптионкуериконсистенци*): управляет согласованностью запросов. [' стронгконсистенци ' или ' нормалконсистенци ' или ' веакконсистенци ']
* `request_callout_disabled` (*Оптионрекуесткаллаутдисаблед*): Если указано, указывает, что запрос не может обратиться к предоставляемой пользователем службе. Логическая
* `request_description` (*Оптионрекуестдескриптион*): произвольный текст, который автор запроса хочет включить в качестве описания запроса. Строка
* `request_external_table_disabled` (*Оптионрекуестекстерналтабледисаблед*): Если указано, указывает, что запрос не может вызвать код в екстерналтабле. Логическая
* `request_readonly` (*Оптионрекуестреадонли*): Если указано, указывает, что запрос не может ничего записывать. Логическая
* `request_remote_entities_disabled` (*Оптионрекуестремотинтитиесдисаблед*): Если указано, указывает, что запрос не может получить доступ к удаленным базам данных и кластерам. Логическая
* `request_sandboxed_execution_disabled` (*Оптионрекуестсандбокседексекутиондисаблед*): Если указано, указывает, что запрос не может вызвать код в песочнице. Логическая
* `results_progressive_enabled` (*Оптионресултспрогрессивинаблед*): Если задано, включается поток прогрессивных запросов.
* `servertimeout` (*Оптионсервертимеаут*): переопределяет время ожидания запроса по умолчанию. Временной
* `truncationmaxrecords` (*Оптионтрункатионмаксрекордс*): переопределяет максимальное число записей по умолчанию, которое запрос может вернуть вызывающему объекту (усечение). Поддерживаем
* `truncationmaxsize` (*Оптионтрункатионмакссизе*): переопределяет максимальный размер данных по умолчанию, который запрос может вернуть вызывающему объекту (усечение). Поддерживаем
* `validate_permissions` (*Оптионвалидатепермиссионс*): проверяет разрешения пользователя на выполнение запроса и не выполняет сам запрос. Логическая

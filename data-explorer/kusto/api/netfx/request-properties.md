---
title: Свойства запроса Kusto & Клиентрекуестпропертиес в Azure обозреватель данных
description: В этой статье описаны свойства запроса Клиентрекуестпропертиес в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 09/23/2019
ms.openlocfilehash: 52b1f73e539e57f82d3ec911a3ea69dcd6848e4a
ms.sourcegitcommit: fd3bf300811243fc6ae47a309e24027d50f67d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/13/2020
ms.locfileid: "83382171"
---
# <a name="request-properties-clientrequestproperties"></a>Свойства запроса, Клиентрекуестпропертиес

При выполнении запроса от Kusto с помощью пакета SDK для .NET один из них обычно предоставляет следующие значения:

1. Строка подключения, указывающая конечную точку службы для подключения, параметры проверки подлинности и аналогичные сведения, связанные с подключением. В программном коде строка подключения представлена с помощью `KustoConnectionStringBuilder` класса.

2. Имя базы данных, используемой для описания области запроса.

3. Текст запроса (запроса или команды).

4. Дополнительные свойства, предоставляемые клиентом для службы и применяемые к запросу. Программно эти свойства удерживаются классом с именем `ClientRequestProperties` .

Свойства клиентского запроса имеют много использования. Некоторые из них используются для упрощения отладки (например, для предоставления строк корреляции, которые можно использовать для наблюдения за взаимодействием между клиентом и службой), другие используются для изменения ограничений и политик, применяемых к запросу, а третья категория таких свойств — [Параметры запроса](../../query/queryparametersstatement.md). На этой странице отображается полный список поддерживаемых свойств.

`Kusto.Data.Common.ClientRequestProperties`Класс содержит три типа данных:

* Именованные свойства.

* Параметры (сопоставление имени параметра со значением параметра).

* Параметры (сопоставление имени параметра запроса со значением параметра запроса).

> [!NOTE]
> Некоторые именованные свойства помечены как "не использовать". Такие свойства не должны задаваться клиентами и не влияют на службу.

## <a name="the-clientrequestid-x-ms-client-request-id-named-property"></a>Именованное свойство ClientRequestId (x-MS-Client-Request-ID)

Это именованное свойство содержит идентификатор запроса, заданный клиентом. Настоятельно рекомендуется, чтобы уникальные значения для каждого запроса были указаны клиентами с каждым отправляемым им запросом, так как они упрощают отладку (и требуются в некоторых сценариях, таких как отмена запросов).

Программное имя этого свойства — `ClientRequestId` , и оно преобразуется в заголовок HTTP `x-ms-client-request-id` .

Если клиент не укажет собственное значение, это свойство будет иметь значение (случайное) для пакета SDK.

Содержимое этого свойства может быть любой уникальной строкой для печати, например GUID.
Однако рекомендуется, чтобы клиенты использовали следующий шаблон:

*ApplicationName* `.` *ActivityName* `;` *UniqueID*

Когда *имя_приложения* определяет клиентское приложение, выполняющее запрос, *ActivityName* определяет тип действия, которому клиентское приложение выдает запрос клиента, а *UniqueID* определяет конкретный запрос.

## <a name="the-application-x-ms-app-named-property"></a>Именованное свойство приложения (x-MS-App)

Это именованное свойство содержит имя клиентского приложения, выполняющего запрос, для целей трассировки.

Программное имя этого свойства — `Application` , и оно преобразуется в заголовок HTTP `x-ms-app` . Его можно указать в строке подключения Kusto как `Application Name for Tracing` .

Для этого свойства будет задано имя процесса, в котором размещается пакет SDK, если клиент не укажет собственное значение.

## <a name="the-user-x-ms-user-named-property"></a>Именованное свойство пользователя (x-MS-User)

Это именованное свойство содержит идентификатор пользователя, выполняющего запрос, для целей трассировки.

Программное имя этого свойства — `User` , и оно преобразуется в заголовок HTTP `x-ms-user` . Его можно указать в строке подключения Kusto как `User Name for Tracing` .

## <a name="controlling-request-properties-using-the-rest-api"></a>Управление свойствами запроса с помощью REST API

При выдаче HTTP-запроса к службе Kusto используйте `properties` область в документе JSON, которая является телом запроса POST для предоставления свойств запроса. Обратите внимание, что некоторые свойства (например "идентификатор клиентского запроса", которые являются ИДЕНТИФИКАТОРом корреляции, предоставляемой клиентом службе для идентификации запроса), могут быть предоставлены в заголовке HTTP, поэтому также можно задать значение, если используется HTTP GET.
Дополнительные сведения см. в описании [объекта запроса REST API Kusto](../rest/request.md) .

## <a name="providing-values-for-query-parameterization-as-request-properties"></a>Предоставление значений для параметризации запросов в качестве свойств запроса

Запросы Kusto могут ссылаться на параметры запроса с помощью специализированной инструкции [Declare запроса-Parameters](../../query/queryparametersstatement.md) в тексте запроса. Это позволяет клиентским приложениям параметризовать запросы Kusto на основе входных данных пользователя безопасным способом (не опасаясь атак путем внедрения).

Программным способом можно задать значения свойств с помощью `ClearParameter` методов, `SetParameter` и `HasParameter` .

В REST API параметры запроса отображаются в той же строке в кодировке JSON, что и другие свойства запроса.

## <a name="sample-code-for-using-request-properties"></a>Пример кода для использования свойств запроса

Ниже приведен пример для клиентского кода.

```csharp
public static System.Data.IDataReader QueryKusto(
    Kusto.Data.Common.ICslQueryProvider queryProvider,
    string databaseName,
    string query)
{
    var queryParameters = new Dictionary<String, String>()
    {
        { "xIntValue", "111" },
        { "xStrValue", "abc" },
        { "xDoubleValue", "11.1" }
    };

    // Query parameters (and many other properties) are provided
    // by a ClientRequestProperties object handed alongside
    // the query:
    var clientRequestProperties = new Kusto.Data.Common.ClientRequestProperties(
        principalIdentity: null,
        options: null,
        parameters: queryParameters);

    // Having client code provide its own ClientRequestId is
    // highly recommended. It not only allows the caller to
    // cancel the query, but also makes it possible for the Kusto
    // team to investigate query failures end-to-end:
    clientRequestProperties.ClientRequestId
        = "MyApp.MyActivity;"
        + Guid.NewGuid().ToString();

    // This is an example for setting an option
    // ("notruncation", in this case). In most cases this is not
    // needed, but it's included here for completeness:
    clientRequestProperties.SetOption(
        Kusto.Data.Common.ClientRequestProperties.OptionNoTruncation,
        true);
 
    try
    {
        return queryProvider.ExecuteQuery(query, clientRequestProperties);
    }
    catch (Exception ex)
    {
        Console.WriteLine(
            "Failed invoking query '{0}' against Kusto."
            + " To have the Kusto team investigate this failure,"
            + " please open a ticket @ https://aka.ms/kustosupport,"
            + " and provide: ClientRequestId={1}",
            query, clientRequestProperties.ClientRequestId);
        return null;
    }
}
```

## <a name="list-of-clientrequestproperties"></a>Список Клиентрекуестпропертиес

<!-- The following is auto-generated by running the following command: -->
<!-- Kusto.Cli.exe -execute:"#crp -doc"                                -->

<!-- The following text can be re-produced by running the Kusto.Cli.exe directive '#crp -doc' -->

<!-- The following text can be re-produced by running the Kusto.Cli.exe directive '#crp -doc' -->

* `debug_query_externaldata_projection_fusion_disabled`(*Оптиондебугкуеридисабликстерналдатапрожектионфусион*): Если задано, не следует запредохранительть проекцию в оператор ExternalData. Логическая
* `debug_query_fanout_threads_percent_external_data`(*Оптиондебугкуерифанаутсреадсперцентекстерналдата*): процент потоков, выполнение которых ветвление для внешних узлов данных. Int
* `deferpartialqueryfailures`(*Оптиондеферпартиалкуерифаилурес*): Если значение равно true, отключает создание отчетов об ошибках частичных запросов в составе результирующего набора. Логическая
* `max_memory_consumption_per_query_per_node`(*Оптионмаксмемориконсумптионперкуериперноде*): переопределяет максимальный объем памяти по умолчанию, который может выделить весь запрос для каждого узла. UInt64
* `maxmemoryconsumptionperiterator`(*Оптионмаксмемориконсумптионперитератор*): переопределяет максимальный объем памяти, выделяемый оператором запроса по умолчанию. UInt64
* `maxoutputcolumns`(*Оптионмаксаутпутколумнс*): переопределяет максимальное число столбцов, которое может быть выдаваться запросом по умолчанию. Поддерживаем
* `norequesttimeout`(*Оптионнорекуесттимеаут*): позволяет задать максимальное значение времени ожидания запроса. Логическая
* `notruncation`(*Оптионнотрункатион*): включает подавление усечения результатов запроса, возвращаемого вызывающему объекту. Логическая
* `push_selection_through_aggregation`(*Оптионпушселектионсраугхаггрегатион*): Если значение true, Отправка простого выделения через агрегат [Boolean]
* `query_admin_super_slacker_mode`(*Оптионадминсуперслаккермоде*): Если значение true, делегирование выполнения запроса другому узлу [Boolean]
* `query_bin_auto_at`(*Куерибинаутоат*): при вычислении функции bin_auto () используется начальное значение. [Литералекспрессион]
* `query_bin_auto_size`(*Куерибинаутосизе*): при вычислении функции bin_auto () используется значение размера ячейки. [Литералекспрессион]
* `query_cursor_after_default`(*Оптионкуерикурсорафтердефаулт*): значение параметра по умолчанию функции cursor_after () при вызове без параметров. [string]
* `query_cursor_before_or_at_default`(*Оптионкуерикурсорбефореоратдефаулт*): значение параметра по умолчанию функции cursor_before_or_at () при вызове без параметров. [string]
* `query_cursor_current`(*Оптионкуерикурсоркуррент*): переопределяет значение курсора, возвращаемое функциями cursor_current () или current_cursor (). [string]
* `query_cursor_scoped_tables`(*Оптионкуерикурсорскопедтаблес*): список имен таблиц, область действия которых должна быть cursor_after_default.. cursor_before_or_at_default (верхняя граница является необязательной). платформе
* `query_datascope`(*Оптионкуеридатаскопе*): управляет областью данных запроса — независимо от того, применяется ли запрос ко всем данным или только к его части. ["default", "ALL" или "хоткаче"]
* `query_datetimescope_column`(*Оптионкуеридатетимескопеколумн*): управляет именем столбца для области DateTime запроса (query_datetimescope_to/query_datetimescope_from). Строка
* `query_datetimescope_from`(*Оптионкуеридатетимескопефром*): управляет областью DateTime запроса (самое раннее), используемой в качестве автоматического применения фильтра только для query_datetimescope_column (если он определен). [DateTime]
* `query_datetimescope_to`(*Оптионкуеридатетимескопето*): управляет областью DateTime запроса (последняя), используемой в качестве автоматического применения фильтра только для query_datetimescope_column (если он определен). [DateTime]
* `query_distribution_nodes_span`(*Оптионкуеридистрибутионнодесспансизе*): Если задано, управляет способом слияния вложенных запросов: выполняемый узел будет содержать дополнительный уровень в иерархии запросов для каждой подгруппы узлов. размер подгруппы задается этим параметром. Int
* `query_fanout_nodes_percent`(*Оптионкуерифанаутнодесперцент*): процент узлов, до которых выполняется ветвление. Int
* `query_fanout_threads_percent`(*Оптионкуерифанаутсреадсперцент*): процент потоков для выполнения ветвление. Int
* `query_language`(*Оптионкуерилангуаже*): управляет интерпретацией текста запроса. [' CSL ', ' ККЛ ' или ' SQL ']
* `query_max_entities_in_union`(*Оптионмаксентитиестаунион*): переопределяет максимальное число столбцов, которое может быть выдаваться запросом по умолчанию. Поддерживаем
* `query_now`(*Оптионкуеринов*): переопределяет значение DateTime, возвращаемое функцией Now (число нулей). [DateTime]
* `query_python_debug`(*Оптиондебугписон*). Если задано, создайте отладочный запрос Python для перечисленного узла Python (по умолчанию — First). [Boolean или int]
* `query_results_apply_getschema`(*Оптионкуериресултсапплижетсчема*). Если задано, получает схему всех табличных данных в результатах запроса, а не сами данные. Логическая
* `query_results_cache_max_age`(*Оптионкуериресултскачемаксаже*): Если положительный, контролирует максимальный возраст кэшированных результатов запроса, который Kusto может возвращать [TimeSpan]
* `query_results_progressive_row_count`(*Оптионпрогрессивекуериминровкаунтперупдате*): указание для Kusto, сколько записей следует отправить в каждом обновлении (вступает в силу, только если задано оптионресултспрогрессивинаблед)
* `query_results_progressive_update_period`(*Оптионпрогрессивепрогрессрепортпериод*): указание Kusto в качестве частоты отправки кадров хода выполнения (вступает в силу, только если задано оптионресултспрогрессивинаблед)
* `query_shuffle_broadcast_join`(*Шуффлеброадкастжоин*): включает перетасовывание по широковещательному соединению.
* `query_take_max_records`(*Оптионтакемаксрекордс*): позволяет ограничить результаты запроса этим числом записей. Поддерживаем
* `queryconsistency`(*Оптионкуериконсистенци*): управляет согласованностью запросов. [' стронгконсистенци ' или ' нормалконсистенци ' или ' веакконсистенци ']
* `request_callout_disabled`(*Оптионрекуесткаллаутдисаблед*): Если указано, указывает, что запрос не может вызвать указанную пользователем службу. Логическая
* `request_description`(*Оптионрекуестдескриптион*): произвольный текст, который автор запроса хочет включить в качестве описания запроса. Строка
* `request_external_table_disabled`(*Оптионрекуестекстерналтабледисаблед*): Если указано, указывает, что запрос не может вызвать код в екстерналтабле. Логическая
* `request_readonly`(*Оптионрекуестреадонли*): Если указано, указывает, что запрос не должен иметь возможности записи. Логическая
* `request_remote_entities_disabled`(*Оптионрекуестремотинтитиесдисаблед*): Если указано, указывает, что запрос не может получить доступ к удаленным базам данных и кластерам. Логическая
* `request_sandboxed_execution_disabled`(*Оптионрекуестсандбокседексекутиондисаблед*): Если указано, указывает, что запрос не может вызвать код в песочнице. Логическая
* `results_progressive_enabled`(*Оптионресултспрогрессивинаблед*): Если задано, включается поток прогрессивных запросов.
* `servertimeout`(*Оптионсервертимеаут*): переопределяет время ожидания запроса по умолчанию. Временной
* `truncationmaxrecords`(*Оптионтрункатионмаксрекордс*): переопределяет максимальное число записей по умолчанию, которое запрос может вернуть вызывающему объекту (усечение). Поддерживаем
* `truncationmaxsize`(*Оптионтрункатионмакссизе*): переопределяет максимальный размер данных по умолчанию, который запрос может вернуть вызывающему объекту (усечение). Поддерживаем
* `validate_permissions`(*Оптионвалидатепермиссионс*): проверяет разрешения пользователя на выполнение запроса и не выполняет сам запрос. Логическая


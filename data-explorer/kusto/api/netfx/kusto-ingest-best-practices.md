---
title: Рекомендации по приему клиентской библиотеки Kusto — Azure обозреватель данных
description: В этой статье приводятся рекомендации по использованию клиентской библиотеки Kusto для приема.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 08/16/2019
ms.openlocfilehash: d02d030a6deb468a4804c68965466e1917858be9
ms.sourcegitcommit: fd3bf300811243fc6ae47a309e24027d50f67d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/13/2020
ms.locfileid: "83382341"
---
# <a name="kusto-ingest-client-library---best-practices"></a>Клиентская библиотека приема Kusto — рекомендации

## <a name="select-the-right-ingestclient-flavor"></a>Выберите правильную версию Инжестклиент

Используйте [кустокуеуединжестклиент](kusto-ingest-client-reference.md#interface-ikustoqueuedingestclient)— это рекомендуемый собственный режим приема данных. Далее описывается, почему это происходит:
* Прямой прием невозможен во время простоя ядра, например во время развертывания. В режиме поочередного приема запросы сохраняются в очереди Azure, а служба Управление данными повторит попытку по мере необходимости.
* Служба Управление данными предотвращает перегрузку обработчика с запросами приема. Например, переопределение этого элемента управления с помощью прямого приема может значительно повлиять на прием и производительность запросов.
* Управление данными объединяет несколько запросов для приема. Агрегатная функция оптимизирует размер первоначального сегмента (экстента), который должен быть создан.
* Получить отзыв о каждом приеме очень просто.

## <a name="avoid-tracking-ingest-operation-status"></a>Избегайте отслеживания состояния операции принятия

[Отслеживание состояния операции принятия приема](kusto-ingest-client-status.md#tracking-ingestion-status-kustoqueuedingestclient) полезно. Однако для потоков данных большого объема следует избегать включения положительных уведомлений для каждого запроса приема. Такое отслеживание помещает экстремальную нагрузку на базовые ресурсы xStore, которые могут привести к увеличению задержки приема и даже полному реагированию на кластер.

## <a name="optimizing-for-throughput"></a>Оптимизация для пропускной способности

Прием лучше работать, если он выполняется в больших блоках. 
* Он потребляет наименьшие ресурсы
* Он создает наиболее оптимизированные для COGS сегменты данных и дает лучшие транзакции с данными.

Мы рекомендуем клиентам, которые принимают данные с помощью библиотеки Kusto. принимающей программы или непосредственно в подсистему, для отправки данных пакетами из **100 МБ** в **1 ГБ (без сжатия)** .
* Верхний предел важен при работе непосредственно с ядром, что позволяет сократить объем памяти, используемый процессом приема. 

> [!NOTE]
> При использовании `KustoQueuedIngestClient` класса чрезмерно большие блоки данных будут разбиты на небольшие фрагменты, и эти небольшие фрагменты будут вычисляться в определенной степени до достижения механизма.

* Нижний предел размера принимаемых данных также важен, хотя и менее критичен. Прием данных в небольшие пакеты выполняется каждый раз, а затем вполне хорошо, хотя это немного менее эффективно, чем использование больших пакетов. `KustoQueuedIngestClient`Класс также решает проблему для клиентов, которым требуется принимать большие объемы данных, и не может пакетировать их в большие фрагменты, прежде чем отправлять их в механизм.

## <a name="other-factors-that-impact-ingestion-throughput"></a>Другие факторы, влияющие на пропускную способность приема

На пропускную способность приема может влиять несколько факторов. При планировании конвейера приема убедитесь, что вычисляются следующие моменты, которые могут иметь значительные последствия для COGs.

| Фактор для рассмотрения |  Описание                                                                                              |
|--------------------------|-----------------------------------------------------------------------------------------------------------|
| Формат данных              | CSV — это самый быстрый формат для приема. JSON, как правило, занимает 2x или 3 раза дольше для того же объема данных.|
| Ширина таблицы              | Убедитесь, что вы принимаете только те данные, которые действительно необходимы. Чем шире таблица, тем больше столбцов потребуется закодировать и индексировать, а затем уменьшить пропускную способность. Вы можете контролировать принимаемые поля, предоставляя сопоставление приема.       |
| Расположение исходных данных     | Избегайте операций чтения между регионами для ускорения приема.                                                       |
| Загрузка в кластере      | Когда в кластере выполняется высокая нагрузка запроса, приемы приема занимают больше времени, что снижает пропускную способность.|

## <a name="optimizing-for-cogs"></a>Оптимизация для COGS

Использование клиентских библиотек Kusto для приема данных в Azure обозреватель данных остается самым дешевым и наиболее надежным вариантом. Мы советуем нашим клиентам проверить свои методы приема и воспользоваться преимуществами цен на службу хранилища Azure, которые сделают транзакции больших двоичных объектов значительно экономичными.

* **Ограничьте количество фрагментов данных, принимающих данные**.
    Чтобы лучше контролировать затраты на прием данных в Azure обозреватель данных и сокращать месячный счет, ограничьте количество полученных блоков (файлов, больших двоичных объектов и потоков).
* Прием **больших блоков данных (до 1 ГБ несжатых данных)**. 
    Многие команды пытаются достичь низкой задержки, принимая десятки миллионов маленьких фрагментов данных, что не является эффективным и дорогостоящим. 
* **Пакетная обработка**. Любой объем пакетной обработки на стороне клиента улучшит оптимизацию. 
* **Предоставьте клиенту Kusto. принимающий точный, несжатый размер данных**.
    Это может привести к дополнительным транзакциям хранилища.
* **Избегайте** отправки данных для приема с `FlushImmediately` флагом, установленным в значение `true` . Кроме того, старайтесь не отправлять небольшие фрагменты с `ingest-by` / `drop-by` набором тегов. При использовании этих методов они будут:
     * предотвращение правильной статистической обработки данных службой во время приема
     * привести к ненужным транзакциям хранилища после приема
     * влияние на COGS
     * скорее всего, это приведет к снижению производительности при приеме или выполнении запросов кластера, если используется чрезмерно

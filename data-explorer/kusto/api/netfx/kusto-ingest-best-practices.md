---
title: Клиентская библиотека приема Kusto — рекомендации по Azure обозреватель данных | Документация Майкрософт
description: В этой статье описывается Kusto прием клиентской библиотеки — рекомендации в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 08/16/2019
ms.openlocfilehash: 2369d352e316f1d9b49de71fb197507280598754
ms.sourcegitcommit: 1faf502280ebda268cdfbeec2e8ef3d582dfc23e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/01/2020
ms.locfileid: "82617941"
---
# <a name="kusto-ingest-client-library---best-practices"></a>Клиентская библиотека приема Kusto — рекомендации

## <a name="choosing-the-right-ingestclient-flavor"></a>Выбор правильной Инжестклиент

Использование [кустокуеуединжестклиент](kusto-ingest-client-reference.md#interface-ikustoqueuedingestclient) является рекомендуемым режимом приема данных в машинном виде. Далее описывается, почему это происходит:
* Прямой прием невозможен во время простоя ядра (например, во время развертывания), в то время как в режиме приема в очереди запросы сохраняются в очереди Azure, а служба Управление данными повторит попытку по мере необходимости.
* Служба Управление данными отвечает за отсутствие перегрузки подсистемы с запросами приема. Переопределение этого элемента управления (например, использование прямого приема) может значительно повлиять на производительность ядра, прием и запрос.
* Управление данными объединяет несколько запросов приема, чтобы оптимизировать размер создаваемого исходного сегмента (экстента).
* Получить отзыв о каждом приеме легко.

## <a name="tracking-ingest-operation-status"></a>Отслеживание состояния операции принятия

[Отслеживание состояния операции принятия приема](kusto-ingest-client-status.md#tracking-ingestion-status-kustoqueuedingestclient) является полезной функцией. Тем не менее, включение этого режима для отчетов об успешном выполнении может быть легко обработано в той степени, в которой она будет криппле вашу службу.

> [!WARNING]
> Следует избегать принятия положительных уведомлений для каждого запроса на прием больших объемов потоков данных большого объема, поскольку это повлечет за собой экстремальную нагрузку на базовые ресурсы xStore. Такая нагрузка может привести к увеличению задержки приема и даже полному реагированию на кластер.

## <a name="optimizing-for-throughput"></a>Оптимизация для пропускной способности

* Прием лучше работать, если он выполняется в больших блоках. Он потребляет наименьшие ресурсы, создает наиболее оптимизированные для COGS сегменты данных и в результате предоставляет лучшие артефакты данных. Как правило, рекомендуется, чтобы клиенты, принимающие данные с помощью библиотеки Kusto. приема или непосредственно в подсистему, отправляли данные в пакетах размером от **100 МБ до 1 ГБ (без сжатия)** .
* Верхний предел важен при работе непосредственно с ядром, что позволяет сократить объем памяти, используемый процессом приема. 

> [!NOTE]
> При использовании `KustoQueuedIngestClient` класса чрезмерно большие блоки данных будут разбиты на небольшие фрагменты, и эти небольшие фрагменты будут вычисляться в определенной степени до достижения механизма.

* Нижний предел размера принимаемых данных также важен, хотя и менее критичен. Прием данных в небольшие пакеты выполняется каждый раз, а затем вполне хорошо, хотя это немного менее эффективно, чем использование больших пакетов. `KustoQueuedIngestClient` Класс также решает проблему для клиентов, которым требуется принимать большие объемы данных, и не может пакетировать их в большие фрагменты, прежде чем отправлять их в механизм.

## <a name="factors-impacting-ingestion-throughput"></a>Факторы, влияющие на пропускную способность приема

На пропускную способность приема может влиять несколько факторов. При планировании конвейера приема убедитесь, что вычисляются следующие моменты, которые могут иметь значительные последствия для COGs.

| Фактор для рассмотрения |  Decription                                                                                               |
|--------------------------|-----------------------------------------------------------------------------------------------------------|
| Формат данных              | CSV — это самый быстрый формат для приема, JSON обычно занимает 2x или 3 раза дольше для того же объема данных.|
| Ширина таблицы              | Убедитесь, что вы принимаете только те данные, которые действительно необходимы. Чем шире таблица, тем больше столбцов потребуется закодировать и индексировать, и, следовательно, уменьшить пропускную способность. Вы можете контролировать принимаемые поля, предоставляя сопоставление приема.|
| Расположение исходных данных     | Избегайте операций чтения между регионами для ускорения приема.                                                       |
| Загрузка в кластере      | Когда в кластере выполняется высокая нагрузка запроса, приемы приема занимают больше времени, что снижает пропускную способность.|
| Шаблон приема        | Прием считается оптимальным, когда кластер обслуживается с пакетами до 1 ГБ (обрабатывается с помощью `KustoQueuedIngestClient`). |

## <a name="optimizing-for-cogs"></a>Оптимизация для COGS

Использование клиентских библиотек Kusto для приема данных в Kusto остается самым дешевым и наиболее надежным вариантом. Мы советуем нашим клиентам проверить свои методы приема и воспользоваться преимуществами цен на службу хранилища Azure, которые сделают транзакции больших двоичных объектов значительно экономичными.

Чтобы лучше контролировать затраты на прием данных в Azure обозреватель данных и сокращать месячный счет, ограничьте количество полученных блоков (файлов, больших двоичных объектов и потоков).

* **Предпочитать получение больших фрагментов данных (до 1 ГБ несжатых данных)**. 
    Многие команды пытаются достичь низкой задержки, принимая десятки миллионов маленьких фрагментов данных, что очень неэффективно и очень дорого. Может помочь любой объем пакетной обработки на стороне клиента. 
* **Убедитесь, что вы предоставляете клиенту Kusto. принимающий точный, несжатый размер данных**.
    Это может привести к дополнительным транзакциям хранилища.
* **Избегайте** отправки данных `FlushImmediately` для приема с флагом, установленным `true`в, или отправкой небольших `ingest-by` / `drop-by` фрагментов с набором тегов.
    Использование этих методов не позволяет службе правильно выполнять статистическую обработку данных во время приема и приводит к ненужным транзакциям хранилища после приема, тем самым влияя на COGS.
    
    Кроме того, чрезмерное использование этих элементов может привести к снижению производительности и (или) скорости запросов кластера.
    

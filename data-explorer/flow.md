---
title: Соединитель потока обозреватель данных Microsoft Azure (Предварительная версия)
description: Сведения об использовании соединителя Microsoft Flow для создания потоков автоматически запланированных или активированных задач.
author: orspod
ms.author: orspodek
ms.reviewer: dorcohen
ms.service: data-explorer
ms.topic: conceptual
ms.date: 03/25/2020
ms.openlocfilehash: 95b5e60c0993d3e364dc54ca7c06e06eaae876cb
ms.sourcegitcommit: e1e35431374f2e8b515bbe2a50cd916462741f49
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "82108292"
---
# <a name="microsoft-flow-connector-preview"></a>Соединитель Microsoft Flow (Предварительная версия)

Соединитель потока обозреватель данных Azure позволяет обозреватель данных Azure использовать [возможности потока автоматизации Microsoft Power Автоматизация](https://flow.microsoft.com/) для автоматического выполнения запросов и команд Kusto в рамках запланированной или активируемой задачи.

Ниже перечислены распространенные сценарии использования.

* Отправка ежедневных отчетов, содержащих таблицы и диаграммы
* Настройка уведомлений на основе результатов запроса
* Планирование команд управления в кластерах
* Экспорт и импорт данных между Azure обозреватель данных и другими базами данных 

Дополнительные сведения см. в статье [примеры использования соединителя Microsoft Flow](flow-usage.md).

##  <a name="log-in"></a>Вход в систему 

1. Войдите в [Microsoft Power автоматизиру](https://flow.microsoft.com/).

1. При первом подключении вам будет предложено выполнить вход.

1. Выберите **Вход** и введите свои учетные данные.

![Диалоговое окно входа](./media/flow/flow-signin.png)

## <a name="authentication"></a>Аутентификация

Проверку подлинности можно выполнять с помощью учетных данных пользователя или приложения AAD.

> [!Note]
> Убедитесь, что приложение является [приложением AAD](kusto/management/access-control/how-to-provision-aad-app.md) и имеет разрешение на выполнение запросов в кластере.

1. Выберите три точки в правом верхнем углу соединитель Microsoft Flow: Добавить подключение. ![](./media/flow/flow-addconnection.png)

1. Выберите **Добавить новое подключение** , а затем выберите **подключиться с помощью субъекта-службы**.
![Диалоговое окно входа](./media/flow/flow-signin.png)

1. Введите необходимые сведения:
    * Имя подключения: описательное и понятное имя для нового подключения.
    * Идентификатор клиента: идентификатор приложения
    * Секрет клиента: ключ приложения
    * Клиент — идентификатор каталога AAD, в котором было создано приложение. Например, идентификатор клиента Microsoft: 72f988bf-86f1-41af-91ab-2d7cd011db47

![Проверка подлинности приложения](./media/flow/flow-appauth.png)

После завершения проверки подлинности вы увидите, что в последовательности используется только что добавленное подключение.

![Проверка подлинности приложения завершена](./media/flow/flow-appauthcomplete.png)

С этого момента этот поток будет выполняться с использованием этих учетных данных приложения.

## <a name="find-the-azure-kusto-connector"></a>Поиск соединителя Azure Kusto

Чтобы использовать соединитель Microsoft Flow, необходимо сначала добавить триггер. Триггер может быть определен на основе повторяющегося периода времени или в качестве ответа на предыдущее действие потока.

1. [Создайте новый поток](https://flow.microsoft.com/manage/flows/new) или на домашней странице выберите действие **мои потоки** и щелкните **+ создать**.

    ![Создание потока](./media/flow/flow-newflow.png)

1. Добавить по расписанию — с пустого.

    ![Новый запланированный поток](./media/flow/flow-scheduled-from-blank.png)

1. Введите необходимые сведения на странице Создание запланированного потока.
    ![Создание запланированного потока](./media/flow/flow-build-scheduled-flow.png)
1. Щелкните **Создать**.
1. Выберите **+ новый шаг**.
1. В поле поиска введите "Kusto".

    ![Выбор действий потока](./media/flow/flow-actions.png)

1. Выберите **Azure обозреватель данных**.

## <a name="flow-actions"></a>Действия потока

При открытии соединителя Azure обозреватель данных существует три возможных действия, которые можно добавить в последовательность.

В этом разделе описываются возможности и параметры для каждого Microsoft Flow действия.

![Действия обозреватель данных Azure Flow](./media/flow/flow-adx-actions.png)

### <a name="run-control-command-and-visualize-results"></a>Выполнение команды управления и визуализация результатов

Используйте команду выполнить элемент управления и действие визуализации результатов, чтобы выполнить [команду управления](kusto/management/index.md).

1. Укажите URL-адрес кластера. Например `https://clusterName.eastus.kusto.windows.net`.
1. Введите имя базы данных.
1. Укажите команду управления:
    * Выберите динамическое содержимое из приложений и соединителей, используемых в потоке.
    * Добавление выражения для доступа к значениям, их преобразования и сравнения
1. Чтобы отправить результаты этого действия по электронной почте в виде таблицы или диаграммы, укажите тип диаграммы, который может быть следующим:
    * HTML-таблица
    * Круговая диаграмма
    * Диаграмма времени
    * Линейчатая диаграмма

![Выполнение команды управления потоком](./media/flow/flow-runcontrolcommand.png)

> [!IMPORTANT]
> В поле *имя кластера* введите URL-адрес кластера.

### <a name="run-query-and-list-results"></a>Выполнение запроса и вывод списка результатов

> [!Note]
> Если запрос начинается с точки (то есть [команды управления](kusto/management/index.md)), используйте [команду Run Control и визуализируйте результаты](#run-control-command-and-visualize-results).

Это действие отправляет запрос в кластер Kusto. Действия, которые добавляются после выполнения итерации по каждой строке результатов запроса.

В следующем примере запрос запускается каждую минуту и отправляется сообщение электронной почты на основе результатов запроса. Запрос проверяет количество строк в базе данных, а затем отправляет сообщение, только если число строк больше 0. 

![Выполнение результатов списка запросов](./media/flow/flow-runquerylistresults-2.png)

> [!Note]
> Если столбец содержит несколько строк, соединитель будет выполняться для каждой строки в столбце.

### <a name="run-query-and-visualize-results"></a>Выполнение запроса и визуализация результатов
        
> [!Note]
> Если запрос начинается с точки (то есть [команды управления](kusto/management/index.md)), используйте [команду Run Control и визуализируйте результаты](#run-control-command-and-visualize-results).
        
Используйте действие выполнить запрос и визуализировать результаты, чтобы визуализировать результат запроса Kusto в виде таблицы или диаграммы. Например, используйте этот поток для получения ежедневных отчетов ICM по электронной почте. 
    
В этом примере результаты запроса возвращаются в виде таблицы HTML.
            
![Выполнение запроса и визуализация результатов](./media/flow/flow-runquery.png)

> [!IMPORTANT]
> В поле *имя кластера* введите URL-адрес кластера.

## <a name="email-kusto-query-results"></a>Отправка результатов запроса Kusto по электронной почте

Можно включить шаг в любой поток для отправки отчетов по электронной почте на любой адрес электронной почты. 

1. Выберите **+ новый шаг** , чтобы добавить в последовательность новый шаг.
1. В поле поиска введите Office 365 и выберите **office 365 Outlook**.
1. Выберите **Отправить сообщение электронной почты (v2)**.
1. Введите адрес электронной почты, по которому должен отправляться отчет по электронной почте.
1. Введите тему сообщения электронной почты.
1. Выберите **представление кода**.
1. Поместите курсор в поле *Body* и выберите **добавить динамическое содержимое**.
1. Выберите **бодихтмл**.
    ![Отправка электронной почты](./media/flow/flow-send-email.png)
1. Выберите **Показать расширенные параметры**.
1. В поле *имя вложения-1* выберите **имя вложения**.
1. В поле *содержимое вложений* выберите **содержимое вложения**.
1. При необходимости добавьте вложения. 
1. При необходимости задайте уровень важности.
1. Щелкните **Сохранить**.

![Отправка электронной почты](./media/flow/flow-add-attachments.png)

## <a name="check-if-your-flow-succeeded"></a>Проверьте, успешно ли работает последовательность

Чтобы проверить, успешно ли выполнена последовательность, см. журнал выполнения потока:
1. Перейдите на [домашнюю страницу Microsoft Flow](https://flow.microsoft.com/).
1. В главном меню выберите [мои потоки](https://flow.microsoft.com/manage/flows).
    ![Страница «мои потоки»](./media/flow/flow-myflows.png)
1. В строке последовательности, которую необходимо исследовать, выберите значок больше команд и **запустите журнал**.

    ![Меню журнала выполнения](./media/flow//flow-runhistory.png)

    Все выполняемые последовательности отображаются со временем начала, длительностью и состоянием.
    ![Страница результатов журнала выполнения](./media/flow/flow-runhistoryresults.png)

    Чтобы получить полные сведения о последовательности, на странице [мои потоки](https://flow.microsoft.com/manage/flows) выберите последовательность, которую нужно исследовать.

    ![Страница "полные результаты журнала выполнения"](./media/flow/flow-fulldetails.png) 

Чтобы увидеть причину сбоя выполнения, выберите время начала выполнения. Поток отображается, а шаг последовательности, в которой произошел сбой, обозначается красным восклицательным знаком. Разверните шаг сбой, чтобы просмотреть сведения о нем. На правой панели содержатся сведения об ошибке, которые можно устранить.

![Ошибка потока](./media/flow/flow-error.png)

## <a name="timeout-exceptions"></a>Исключения времени ожидания

Поток может завершиться ошибкой и вернуть исключение "RequestTimeout", если оно выполняется более семи минут.

Дополнительные сведения об [ограничениях Microsoft Flow](#limitations).
    
Один и тот же запрос может успешно выполняться в обозреватель данных Azure, где время не ограничено, и его можно изменить.
            
Исключение "RequestTimeout" показано на рисунке ниже:
    
![Ошибка при истечении времени ожидания запроса потока](./media/flow/flow-requesttimeout.png)
    
Чтобы устранить проблему с временем ожидания, попробуйте сделать запрос более эффективным, чтобы он выполнялся быстрее или разделить его на фрагменты. Каждый блок может выполняться в другой части запроса.

Дополнительные сведения см. в статье рекомендации по [запросам](kusto/query/best-practices.md).

## <a name="limitations"></a>Ограничения

* Результаты, возвращаемые клиенту, ограничены 500 000 записями. Общая память для этих записей не может превышать 64 МБ и время выполнения в семь минут.
* Соединитель не поддерживает операторы [ветвления](kusto/query/forkoperator.md) и [аспекта](kusto/query/facetoperator.md) .
* Приложение Flow работает лучше в Microsoft ребре и Chrome.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [соединителе приложения логики проводника Microsoft Azure](kusto/tools/logicapps.md) . это еще один способ автоматического выполнения запросов и команд Kusto в рамках запланированной или активируемой задачи.

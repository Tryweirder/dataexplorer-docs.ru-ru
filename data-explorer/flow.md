---
title: Соединитель Azure обозреватель данных для автоматического управления питанием (Предварительная версия)
description: Узнайте об использовании соединителя Azure обозреватель данных для автоматизации создания потоков автоматически запланированных или активированных задач.
author: orspod
ms.author: orspodek
ms.reviewer: dorcohen
ms.service: data-explorer
ms.topic: conceptual
ms.date: 03/25/2020
ms.openlocfilehash: 57f3ae587f449739f7e3aaaa0aa817530447097e
ms.sourcegitcommit: 98eabf249b3f2cc7423dade0f386417fb8e36ce7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2020
ms.locfileid: "82868739"
---
# <a name="azure-data-explorer-connector-to-power-automate-preview"></a>Соединитель Azure обозреватель данных для автоматического управления питанием (Предварительная версия)

Соединитель потока обозреватель данных Azure позволяет обозреватель данных Azure использовать возможности потока [Microsoft Power автоматизиру](https://flow.microsoft.com/). Запросы и команды Kusto можно выполнять автоматически в рамках запланированной или активируемой задачи.

Можно сделать следующее:

* Отправка ежедневных отчетов, содержащих таблицы и диаграммы.
* Настройте уведомления на основе результатов запроса.
* Планирование команд управления в кластерах.
* Экспорт и импорт данных между Azure обозреватель данных и другими базами данных. 

Дополнительные сведения см. в статье [примеры использования соединителя потока обозреватель данных Azure](flow-usage.md).

##  <a name="sign-in"></a>Вход 

1. При первом подключении вам будет предложено выполнить вход.

1. Выберите **Вход**и введите свои учетные данные.

![Снимок экрана запроса на вход обозреватель данных Azure](./media/flow/flow-signin.png)

## <a name="authentication"></a>Аутентификация

Вы можете пройти проверку подлинности с помощью учетных данных пользователя или приложения Azure Active Directory (Azure AD).

> [!Note]
> Убедитесь, что приложение является [приложением Azure AD](kusto/management/access-control/how-to-provision-aad-app.md)и имеет разрешение на выполнение запросов в кластере.

1. В окне **выполнение команды управления и визуализация результатов**выберите три точки в правом верхнем углу соединителя потока.

   ![Снимок экрана команды управления запуском и визуализации результатов](./media/flow/flow-addconnection.png)

1. Выберите **Добавить новое подключение** > **подключиться к субъекту-службе**.

   ![Снимок экрана запроса на вход в Azure обозреватель данных с параметром Connect с субъектом-службой](./media/flow/flow-signin.png)

1. Введите необходимые сведения:
   - Имя соединения: описательное и понятное имя для нового соединения.
   - Идентификатор клиента: идентификатор приложения.
   - Секрет клиента: ключ приложения.
   - Клиент: идентификатор каталога Azure AD, в котором было создано приложение.

   ![Снимок экрана: диалоговое окно "Проверка подлинности приложения обозреватель данных Azure"](./media/flow/flow-appauth.png)

После завершения проверки подлинности вы увидите, что в последовательности используется только что добавленное подключение.

![Снимок экрана завершенной проверки подлинности приложения](./media/flow/flow-appauthcomplete.png)

С этого момента этот поток будет выполняться с использованием этих учетных данных приложения.

## <a name="find-the-azure-kusto-connector"></a>Поиск соединителя Azure Kusto

Чтобы использовать соединитель Flow, необходимо сначала добавить триггер. Можно определить триггер на основе повторяющегося периода времени или как ответ на предыдущее действие потока.

1. [Создайте новый поток](https://flow.microsoft.com/manage/flows/new), или на домашней странице Microsoft Power автоматизиру выберите пункт **мои потоки** > **+ создать**.

    ![Снимок экрана: Домашняя страница Microsoft Power автоматизиру с выделенными потоками и новыми](./media/flow/flow-newflow.png)

1. Выберите **по расписанию — с пустое**.

    ![Снимок экрана: диалоговое окно "создать" с выделенным полем "запланировано от"](./media/flow/flow-scheduled-from-blank.png)

1. В поле **Build a Scheduled Flow (создание запланированного потока**) введите необходимые сведения.
    
    ![Снимок экрана: Создание страницы запланированного потока с выделенными параметрами имени потока](./media/flow/flow-build-scheduled-flow.png)

1. Выберите **создать** > **и новый шаг**.
1. В поле поиска введите *Kusto*и выберите **Azure обозреватель данных**.

    ![Снимок экрана: выбор параметров действия с помощью поля поиска и выделенного обозреватель данных Azure](./media/flow/flow-actions.png)

## <a name="flow-actions"></a>Действия потока

При открытии соединителя Azure обозреватель данных существует три возможных действия, которые можно добавить в последовательность. В этом разделе описываются возможности и параметры для каждого действия.

![Снимок экрана действий соединителя Azure обозреватель данных](./media/flow/flow-adx-actions.png)

### <a name="run-control-command-and-visualize-results"></a>Выполнение команды управления и визуализация результатов

Это действие используется для выполнения [команды управления](kusto/management/index.md).

1. Укажите URL-адрес кластера. Например, `https://clusterName.eastus.kusto.windows.net`.
1. Введите имя базы данных.
1. Укажите команду управления:
   - Выберите динамическое содержимое из приложений и соединителей, используемых в потоке.
   - Добавьте выражение для доступа к значениям, их преобразования и сравнения.
1. Чтобы отправить результаты этого действия по электронной почте в виде таблицы или диаграммы, укажите тип диаграммы. Это может быть:
   - HTML-таблица.
   - Круговая диаграмма.
   - Диаграмма времени.
   - Линейчатая диаграмма.

![Снимок экрана команды управления запуском и визуализации результатов](./media/flow/flow-runcontrolcommand.png)

> [!IMPORTANT]
> В поле **имя кластера** введите URL-адрес кластера.

### <a name="run-query-and-list-results"></a>Выполнение запроса и вывод списка результатов

> [!Note]
> Если запрос начинается с точки (то есть [команды управления](kusto/management/index.md)), используйте [команду Run Control и визуализируйте результаты](#run-control-command-and-visualize-results).

Это действие отправляет запрос в кластер Kusto. Действия, которые добавляются после выполнения итерации по каждой строке результатов запроса.

В следующем примере запрос запускается каждую минуту и отправляется сообщение электронной почты на основе результатов запроса. Запрос проверяет количество строк в базе данных, а затем отправляет сообщение, только если число строк больше 0. 

![Снимок экрана: запуск запроса и вывод списка результатов](./media/flow/flow-runquerylistresults-2.png)

> [!Note]
> Если столбец содержит несколько строк, соединитель будет выполняться для каждой строки в столбце.

### <a name="run-query-and-visualize-results"></a>Выполнение запроса и визуализация результатов
        
> [!Note]
> Если запрос начинается с точки (то есть [команды управления](kusto/management/index.md)), используйте [команду Run Control и визуализируйте результаты](#run-control-command-and-visualize-results).
        
Это действие используется для визуализации результата запроса Kusto в виде таблицы или диаграммы. Например, используйте этот поток для получения ежедневных отчетов по электронной почте. 
    
В этом примере результаты запроса возвращаются в виде таблицы HTML.
            
![Снимок экрана: выполнение запроса и визуализация результатов](./media/flow/flow-runquery.png)

> [!IMPORTANT]
> В поле **имя кластера** введите URL-адрес кластера.

## <a name="email-kusto-query-results"></a>Отправка результатов запроса Kusto по электронной почте

Можно включить шаг в любой поток для отправки отчетов по электронной почте на любой адрес электронной почты. 

1. Выберите **+ новый шаг** , чтобы добавить в последовательность новый шаг.
1. В поле поиска введите *office 365* и выберите **Office 365 Outlook**.
1. Выберите **Отправить сообщение электронной почты (v2)**.
1. Введите адрес электронной почты, по которому будет отправлен отчет по электронной почте.
1. Введите тему сообщения электронной почты.
1. Выберите **представление кода**.
1. Поместите курсор в поле **Body** и выберите **добавить динамическое содержимое**.
1. Выберите **бодихтмл**.
    ![Снимок экрана: диалоговое окно "Отправка сообщения" с выделенным полем текста и Бодихтмл](./media/flow/flow-send-email.png)
1. Выберите **Показать расширенные параметры**.
1. В поле **имя вложения — 1**выберите **имя вложения**.
1. В разделе **содержимое вложений**выберите **содержимое вложения**.
1. При необходимости добавьте вложения. 
1. При необходимости задайте уровень важности.
1. Щелкните **Сохранить**.

![Снимок экрана: диалоговое окно "Отправка сообщения" с именем вложения, содержимым вложений и выделенным сохранением](./media/flow/flow-add-attachments.png)

## <a name="check-if-your-flow-succeeded"></a>Проверьте, успешно ли работает последовательность

Чтобы проверить, успешно ли выполнена последовательность, см. журнал выполнения потока:
1. Перейдите на [домашнюю страницу Microsoft Power автоматизиру](https://flow.microsoft.com/).
1. В главном меню выберите [мои потоки](https://flow.microsoft.com/manage/flows).
   
   ![Снимок экрана главного меню Microsoft Power автоматизиру с выделенным пунктом "мои потоки"](./media/flow/flow-myflows.png)

1. В строке последовательности, которую необходимо исследовать, щелкните значок дополнительные команды, а затем выберите пункт **Журнал выполнения**.

    ![Снимок экрана вкладки "мои потоки" с выделенным журналом выполнения](./media/flow//flow-runhistory.png)

    В списке отображаются все выполнения последовательности со сведениями о времени начала, длительности и состоянии.
    ![Снимок экрана со страницей результатов журнала выполнения](./media/flow/flow-runhistoryresults.png)

    Для получения подробных сведений о потоке в **[моем](https://flow.microsoft.com/manage/flows)** потоке выберите последовательность, которую нужно исследовать.

    ![Снимок экрана со страницей "полные результаты журнала выполнения"](./media/flow/flow-fulldetails.png) 

Чтобы увидеть причину сбоя выполнения, выберите время начала выполнения. Поток отображается, а этап последовательности, на которой произошел сбой, обозначается красным восклицательным знаком. Разверните шаг сбой, чтобы просмотреть сведения о нем. Область **сведений** справа содержит сведения о сбое, чтобы можно было устранить неполадки.

![Снимок экрана страницы ошибок потока](./media/flow/flow-error.png)

## <a name="timeout-exceptions"></a>Исключения времени ожидания

Поток может завершиться ошибкой и вернуть исключение "RequestTimeout", если оно выполняется более семи минут.
    
![Снимок экрана: ошибка исключения "время ожидания запроса потока"](./media/flow/flow-requesttimeout.png)

Чтобы устранить проблему с временем ожидания, сделайте запрос более эффективным, чтобы он выполнялся быстрее, или разделите его на фрагменты. Каждый блок может выполняться в другой части запроса. Дополнительные сведения см. в разделе рекомендации по [запросам](kusto/query/best-practices.md).

Один и тот же запрос может успешно выполняться в обозреватель данных Azure, где время не ограничено и может быть изменено.

## <a name="limitations"></a>Ограничения

* Результаты, возвращаемые клиенту, ограничены 500 000 записями. Общая память для этих записей не может превышать 64 МБ и время выполнения семь минут.
* Соединитель не поддерживает операторы [ветвления](kusto/query/forkoperator.md) и [аспекта](kusto/query/facetoperator.md) .
* Этот процесс лучше подходит для Microsoft ребра и Google Chrome.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [соединителе приложения логики Azure Kusto](kusto/tools/logicapps.md). это еще один способ автоматического запуска запросов и команд Kusto в рамках запланированной или активируемой задачи.

---
title: Использование частной конечной точки в кластере Azure обозреватель данных в виртуальной сети
description: Использование частной конечной точки в кластере Azure обозреватель данных в виртуальной сети
author: orspod
ms.author: orspodek
ms.reviewer: elbirnbo
ms.service: data-explorer
ms.topic: conceptual
ms.date: 08/09/2020
ms.openlocfilehash: 0d37a1105dfa5f2d4cac64af7ba52faf27f0edf9
ms.sourcegitcommit: 684d57e2ff0f5b3aecc7675bf909a310cc699a49
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97636081"
---
# <a name="create-a-private-endpoint-in-your-azure-data-explorer-cluster-in-your-virtual-network-preview"></a>Создание частной конечной точки в кластере Azure обозреватель данных в виртуальной сети (Предварительная версия)

Используйте частную ссылку с частной конечной точкой для безопасного доступа к кластеру Azure обозреватель данных в виртуальной сети. 

Чтобы настроить [службу частной связи](/azure/private-link/private-link-service-overview), используйте закрытую конечную точку с IP-адресом из адресного пространства виртуальной сети Azure. [Частная конечная точка Azure](/azure/private-link/private-endpoint-overview) использует частный IP-адрес из виртуальной сети для безопасного подключения к Azure обозреватель данных в частном порядке. Кроме того, потребуется перенастроить [конфигурацию DNS](/azure/private-link/private-endpoint-dns) в кластере для подключения с помощью частной конечной точки. При такой настройке сетевой трафик между клиентом в частной сети и кластером Azure обозреватель данных передается по виртуальной сети и [частной ссылке](/azure/private-link/) на магистральную сеть Майкрософт, отключив раскрытие из общедоступного Интернета. В этой статье показано, как создать и настроить частную конечную точку в кластере для запроса (механизма) и приема (Управление данными).


## <a name="prerequisites"></a>Предварительные требования

* Создание [кластера Azure обозреватель данных в виртуальной сети](./vnet-create-cluster-portal.md)
* Отключить политики сети:
* В виртуальной сети Azure обозреватель данных Cluster отключите [политику службы частной связи](/azure/private-link/disable-private-link-service-network-policy).
* В виртуальной сети с частной конечной точкой, которая может совпадать с виртуальной сетью кластера Azure обозреватель данных, отключите [политику частной конечной точки](/azure/private-link/disable-private-endpoint-network-policy).

## <a name="create-private-link-service"></a>Создание службы частной связи

Для безопасной связи со всеми службами в кластере необходимо дважды создать [службу Private Link](/azure/private-link/private-link-service-overview) : один раз для запроса (Engine) и один раз для приема (управления данными).

1. Нажмите кнопку **+ Создать ресурс** в левом верхнем углу окна портала.
1. Найдите *службу частной связи*.
1. В разделе **Служба частной связи** выберите **создать**.

    :::image type="content" source="media/vnet-create-private-endpoint/create-service.gif" alt-text="GIF, показывающий первые три шага создания службы частной связи на портале Azure обозреватель данных":::

1. В области **служба создания частной ссылки** заполните следующие поля:

    :::image type="content" source="media/vnet-create-private-endpoint/private-link-basics.png" alt-text="Вкладка 1 в службе создания частной связи — основные сведения":::

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Подписка | Ваша подписка | Выберите подписку Azure, в которой находится кластер виртуальной сети.|
    | Группа ресурсов | Ваша группа ресурсов | Выберите группу ресурсов, в которой хранится кластер виртуальной сети. |
    | Имя | азуредатаексплорерплс | Выберите имя, идентифицирующее службу частной связи в группе ресурсов. |
    | Регион | То же, что и виртуальная сеть | Выберите регион, соответствующий региону виртуальной сети. |

1. В области **параметры исходящего трафика** заполните следующие поля:

    :::image type="content" source="media/vnet-create-private-endpoint/private-link-outbound.png" alt-text="Вкладка &quot;Закрытая ссылка&quot; 2 — параметры исходящего трафика":::

    |**Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Load Balancer | Load Balancer модуля или *управления данными* | Выберите подсистему балансировки нагрузки, созданную для подсистемы кластеров, можно использовать внешнюю или внутреннюю подсистему балансировки нагрузки.  Имена подсистемы балансировки нагрузки будут иметь следующий формат: <br> *кукомпуте-{имя_кластера}-Elb* для внешней подсистемы балансировки нагрузки <br> *кукомпуте-{имя_кластера} — ilB* для внутренней подсистемы балансировки нагрузки<br> *Имена управления данными подсистем балансировки нагрузки будут иметь следующий формат: <br> кудатамгмт-{имя_кластера}-Elb <br> кудатамгмт-{имя_кластера}-ilB*|
    | Интерфейсный IP-адрес балансировщика нагрузки | Общедоступный IP-адрес или модуль управления данными. | Выберите Load Balancer общедоступный IP-адрес. |
    | Исходная подсеть NAT | Подсеть кластера | Подсеть, в которой развернут кластер.
    
1. В области **Безопасность доступа** выберите пользователей, которые могут запрашивать доступ к службе частной связи.
1. Выберите **проверить и создать** , чтобы проверить конфигурацию службы частной связи. Выберите **создать** , чтобы создать службу частной связи.
1. После создания службы частной связи Откройте ресурс и сохраните псевдоним закрытой ссылки для следующего шага, **создав закрытую конечную точку**. В качестве псевдонима примера используется: *азуредатаексплорерплс. 111-222 -333. westus. Azure. привателинксервице*

## <a name="create-private-endpoint"></a>Создание частной конечной точки

Для безопасной связи со всеми службами в кластере необходимо создать [частную конечную точку](/azure/private-link/private-endpoint-overview) дважды: один для запроса (подсистема) и один раз для приема (Управление данными).

1. Нажмите кнопку **+ Создать ресурс** в левом верхнем углу окна портала.
1. Найдите *закрытую конечную точку*.
1. В разделе **Частная конечная точка** выберите **создать**.
1. В области **Создание частной конечной точки** заполните следующие поля:

    :::image type="content" source="media/vnet-create-private-endpoint/step-one-basics.png" alt-text="Создание частной конечной точки. шаг 1 — Основные сведения":::

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Подписка | Ваша подписка | Выберите подписку Azure, которую вы хотите использовать для частной конечной точки.|
    | Группа ресурсов | Ваша группа ресурсов | Воспользуйтесь существующей группой ресурсов или создайте новую. |
    | Имя | азуредатаексплорерпе | Выберите имя, идентифицирующее виртуальную сеть в группе ресурсов.
    | Регион | *западная часть США* | Выберите регион в соответствии со своими потребностями.
    
1. В области **ресурсов** заполните следующие поля:

    :::image type="content" source="media/vnet-create-private-endpoint/step-two-resource.png" alt-text="Создание виртуальной сети — шаг 2 — ресурс":::

    **Параметр** | **Значение**
    |---|---|
    | Метод подключения | Псевдоним службы частной связи |
    | Идентификатор или псевдоним ресурса | Псевдоним службы частной ссылки на модуль. В качестве псевдонима примера используется: *азуредатаексплорерплс. 111-222 -333. westus. Azure. привателинксервице*  |
    
1. Выберите **Проверка + создать** , чтобы проверить конфигурацию частной конечной точки и **создать** закрытую службу конечной точки.
1. Чтобы создать закрытую конечную точку для приема (Управление данными), выполните те же инструкции со следующим изменением:
    1. В области **ресурсов** выберите псевдоним службы приема (Управление данными).

> [!NOTE]
> Вы можете подключиться к службе частной связи из нескольких частных конечных точек.

## <a name="approve-your-private-endpoint"></a>Утверждение частной конечной точки

> [!NOTE]
> Если вы выбрали параметр *автоматического утверждения* в области **безопасности доступа** при создании службы частной связи, этот шаг не является обязательным.

1. В службе частной связи выберите подключения к **частным конечным точкам** в разделе Параметры.
1. Выберите свою частную конечную точку из списка подключения и нажмите кнопку **утвердить**.

:::image type="content" source="media/vnet-create-private-endpoint/private-link-approve.png" alt-text="Шаг утверждения для создания частной конечной точки"::: 

## <a name="set-dns-configuration"></a>Настройка конфигурации DNS

При развертывании кластера Azure обозреватель данных в виртуальной сети мы обновляем [запись DNS](/azure/private-link/private-endpoint-dns) , чтобы она указывала на каноническое имя с *привателинк* между именем записи и именем узла зоны. Эта запись обновляется как для механизма, так и для приема (Управление данными). 

Например, если DNS-имя модуля — myadx.westus.kusto.windows.net, то разрешение имен будет следующим:

* **имя**: myadx.westus.kusto.Windows.NET   <br> **тип**: CNAME   <br> **значение**: myadx.privatelink.westus.kusto.Windows.NET
* **имя**: myadx.privatelink.westus.kusto.Windows.NET   <br> **тип**: A   <br> **значение**: 40.122.110.154
    > [!NOTE]
    > Это значение представляет собой общедоступный IP-адрес вашего запроса (Engine), который был предоставлен при создании кластера.

Настройка частного DNS-сервера или частной зоны DNS Azure. Для тестов можно изменить запись узла для тестового компьютера.

Создайте следующую зону DNS: **privatelink.Region.kusto.Windows.NET**. Зона DNS в примере: *privatelink.westus.kusto.Windows.NET*. Зарегистрируйте запись для модуля, используя запись A и IP-адрес частной конечной точки.

Например, разрешение имен будет следующим:

* **имя**: myadx.westus.kusto.Windows.NET   <br>**тип** : CNAME   <br>**значение**: myadx.privatelink.westus.kusto.Windows.NET
* **имя**: myadx.privatelink.westus.kusto.Windows.NET   <br>**тип**: A   <br>**значение**: 10.3.0.9
    > [!NOTE]
    > Это значение является IP-адресом частной конечной точки. Вы уже подключили IP-адрес к службе закрытой ссылки на запрос (механизм).

После настройки этой конфигурации DNS можно получить доступ к запросу (механизму) внутри виртуальной сети в частном порядке со следующим URL-адресом: myadx.region.kusto.windows.net.

Чтобы получить доступ к приему (Управление данными) в частном порядке, зарегистрируйте запись для приема (Управление данными) с записью A и IP-адресом частной конечной точки приема.

## <a name="next-steps"></a>Дальнейшие действия

* [Развертывание кластера Azure обозреватель данных в виртуальной сети](vnet-deployment.md)
* [Устранение неполадок доступа, приема и работы кластера Azure обозреватель данных в виртуальной сети](vnet-deploy-troubleshoot.md)

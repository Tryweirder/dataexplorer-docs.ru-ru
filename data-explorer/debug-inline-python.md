---
title: Отладка Kusto языка запросов во встроенном коде Python с помощью VS Code — Azure обозреватель данных
description: Узнайте, как выполнить отладку встроенного кода Python на языке Kusto запросов (ККЛ) с помощью VS Code.
author: orspod
ms.author: orspodek
ms.reviewer: adieldar
ms.service: data-explorer
ms.topic: how-to
ms.date: 12/04/2019
ms.openlocfilehash: 21e3da862931219a338d2364117b8990280118d9
ms.sourcegitcommit: f354accde64317b731f21e558c52427ba1dd4830
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88874296"
---
# <a name="debug-kusto-query-language-inline-python-using-vs-code"></a>Отладка Kusto языка запросов во встроенном коде Python с помощью VS Code

Azure обозреватель данных поддерживает выполнение кода Python, встроенного на языке запросов Kusto, с помощью [подключаемого модуля Python ()](kusto/query/pythonplugin.md). Среда выполнения подключаемого модуля размещается в песочнице, изолированной и безопасной среде Python. Возможность подключаемого модуля Python () расширяет функциональные возможности языка запросов Kusto с помощью огромного архива пакетов OSS Python. Это расширение позволяет выполнять сложные алгоритмы, такие как машинное обучение, искусственный интеллект, статистический анализ и временные ряды в рамках запроса.

Средства языка запросов Kusto не удобно использовать для разработки и отладки алгоритмов Python. Поэтому Разрабатывайте алгоритм в вашей любимой интегрированной среде разработки Python, такой как Jupyter, PyCharm, VS или VS Code. После завершения алгоритма скопируйте и вставьте в ККЛ. Для улучшения и упрощения этого рабочего процесса Azure обозреватель данных поддерживает интеграцию между клиентами обозревателя Kusto или веб-интерфейсом пользовательского интерфейса и VS Code для создания и отладки ККЛ встраиваемого кода Python. 

> [!NOTE]
> Этот рабочий процесс можно использовать только для отладки относительно маленьких входных таблиц (до нескольких МБ). Поэтому может потребоваться ограничить входные данные для отладки.  Если необходимо обработать большую таблицу, ограничьте ее для отладки с помощью `| take` , `| sample` или `where rand() < 0.x` .

## <a name="prerequisites"></a>Предварительные условия

1. Установите [Anaconda дистрибутив](https://www.anaconda.com/distribution/#download-section)Python. В окне **Дополнительные параметры**выберите **Добавить Anaconda в переменную окружения PATH**.
2. Установка [Visual Studio Code](https://code.visualstudio.com/Download)
3. Установите [расширение Python для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=ms-python.python).

## <a name="run-your-query-in-your-client-application"></a>Выполнение запроса в клиентском приложении

1. В клиентском приложении добавьте префикс запроса, содержащего встроенный Python, с `set query_python_debug;`
1. Выполнение запроса.
    * Kusto Explorer: VS Code автоматически запускается с скриптом *debug_python. корректировки* .
    * Веб-интерфейс Kusto: 
        1. Скачайте и сохраните *debug_python. копировать*, *df.txt*и *kargs.txt*. В окне выберите **Разрешить**. **Сохранить** файлы в выбранном каталоге. 

            ![Веб-интерфейс скачивает встроенные файлы Python](media/debug-inline-python/webui-inline-python.png)

        1. Щелкните правой кнопкой мыши *debug_python. Корректировка* и откройте VS Code. 
        Скрипт *debug_python. корр* . содержит встроенный код Python из запроса ККЛ с префиксом кода шаблона для инициализации входной рамки данных из *df.txt* и словаря параметров из *kargs.txt*.    
            
1. В VS Code запустите отладчик VS Code: **Отладка**  >  **начать отладку (F5)**, выберите пункт Конфигурация **Python** . Отладчик запустится и автоматически откроет точку останова для отладки встроенного кода.

### <a name="how-does-inline-python-debugging-in-vs-code-work"></a>Как работает Встроенная отладка Python в VS Code?

1. Запрос анализируется и выполняется на сервере до тех пор, пока `| evaluate python()` не будет достигнуто требуемое предложение.
1. Вызывается Песочница Python, но вместо выполнения кода она сериализует входную таблицу, словарь параметров и код и отправляет их обратно клиенту.
1. Эти три объекта сохраняются в трех файлах: *df.txt*, *kargs.txt*и *debug_python. Корректировка* в выбранном каталоге (веб-интерфейс) или в каталоге клиента% Temp% (обозреватель Kusto).
1. VS Code запускается, предварительно загружается с помощью файла *debug_python. корректировки* , который содержит код префикса для инициализации DF и КАРГС из соответствующих файлов, за которым следует скрипт Python, внедренный в запрос ККЛ.

## <a name="query-example"></a>Пример запроса

1. Выполните следующий запрос ККЛ в клиентском приложении:

    ```kusto
    range x from 1 to 4 step 1
    | evaluate python(typeof(*, x4:int), 
    'exp = kargs["exp"]\n'
    'result = df\n'
    'result["x4"] = df["x"].pow(exp)\n'
    , pack('exp', 4))
    ```

    См. результирующую таблицу:

    | x  | X4  |
    |---------|---------|
    | 1     |   1      |
    | 2     |   16      |
    | 3     |   81      |
    | 4     |    256     |
    
1. Выполните тот же запрос ККЛ в клиентском приложении, используя `set query_python_debug;` :

    ```kusto
    set query_python_debug;
    range x from 1 to 4 step 1
    | evaluate python(typeof(*, x4:int), 
    'exp = kargs["exp"]\n'
    'result = df\n'
    'result["x4"] = df["x"].pow(exp)\n'
    , pack('exp', 4))
    ```

1. VS Code запускается:

    ![Запуск VS Code](media/debug-inline-python/launch-vs-code.png)

1. VS Code деошибок и выводить кадр данных Result в консоли отладки:

    ![Отладка VS Code](media/debug-inline-python/debug-vs-code.png)

> [!NOTE]
> Между образом изолированной среды Python и локальной установкой могут возникнуть различия. [Проверьте образ "песочницы" для конкретных пакетов, выполнив запрос к подключаемому модулю](https://github.com/Azure/azure-kusto-analytics-lib/blob/master/Utils/functions/get_modules_version.csl).

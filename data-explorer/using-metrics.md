---
title: Мониторинг производительности обозреватель данных Azure, использование & работоспособности с помощью метрик
description: Узнайте, как использовать метрики обозреватель данных Azure для наблюдения за производительностью, работоспособностью и использованием кластера.
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: how-to
ms.date: 09/19/2020
ms.custom: contperfq1
ms.openlocfilehash: a91eca7232cb2583312ea54cab92aec014f4dcbd
ms.sourcegitcommit: 898f67b83ae8cf55e93ce172a6fd3473b7c1c094
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/21/2020
ms.locfileid: "92343391"
---
# <a name="monitor-azure-data-explorer-performance-health-and-usage-with-metrics"></a>Мониторинг производительности, работоспособности и использования Azure обозреватель данных с помощью метрик

Метрики обозреватель данных Azure предоставляют ключевые индикаторы работоспособности и производительности ресурсов кластера Azure обозреватель данных. Используйте метрики, описанные в этой статье, чтобы отслеживать использование, работоспособность и производительность кластера Azure обозреватель данных в конкретном сценарии в качестве отдельных метрик. Вы также можете использовать метрики в качестве базиса для рабочих [панелей мониторинга Azure](/azure/azure-portal/azure-portal-dashboards) и [оповещений Azure](/azure/azure-monitor/platform/alerts-metric-overview).

Дополнительные сведения об Azure обозреватель метрик см. в разделе [Обозреватель метрик](/azure/azure-monitor/platform/metrics-getting-started).

## <a name="prerequisites"></a>Обязательные условия

* Подписка Azure. Если у вас ее нет, можно создать [бесплатную учетную запись Azure](https://azure.microsoft.com/free/).
* [Кластер и база данных](create-cluster-database-portal.md).

## <a name="use-metrics-to-monitor-your-azure-data-explorer-resources"></a>Использование метрик для мониторинга ресурсов Azure обозреватель данных

1. Войдите на [портал Azure](https://portal.azure.com/).
1. В левой области кластера Azure обозреватель данных выполните поиск *метрик*.
1. Выберите **метрики** , чтобы открыть панель метрики и начать анализ кластера.
    :::image type="content" source="media/using-metrics/select-metrics.gif" alt-text="Поиск и выбор метрик в портал Azure":::

## <a name="work-in-the-metrics-pane"></a>Работа на панели «метрики»

В области метрики выберите конкретные метрики для трассировки, выберите способ агрегирования данных и создайте диаграммы метрик для просмотра на панели мониторинга.

Для кластера Azure обозреватель данных предварительно выбраны выбранные для **ресурса** и **метрики выборки пространства имен** . Числа на следующем рисунке соответствуют нумерованному списку ниже. Они посвящены различным параметрам настройки и просмотра метрик.

![Панель "метрики"](media/using-metrics/metrics-pane.png)

1. Чтобы создать диаграмму метрики, выберите имя **метрики** и соответствующую **статистическую** функцию для каждой метрики. Дополнительные сведения о различных метриках см. в статье [Поддерживаемые метрики обозреватель данных Azure](#supported-azure-data-explorer-metrics).
1. Выберите **Добавить метрику** , чтобы увидеть несколько метрик, построенных на одной диаграмме.
1. Выберите **+ создать диаграмму** , чтобы увидеть несколько диаграмм в одном представлении.
1. Для изменения диапазона времени используйте средство выбора времени (по умолчанию — последние 24 часа).
1. Используйте [ **Добавление фильтра** и **Примените разбиение** ](/azure/azure-monitor/platform/metrics-getting-started#apply-dimension-filters-and-splitting) для метрик, имеющих измерения.
1. Выберите **закрепить на панели мониторинга** , чтобы добавить конфигурацию диаграммы на панели мониторинга, чтобы ее можно было просмотреть снова.
1. Задайте **новое правило генерации оповещений** , чтобы визуализировать метрики с помощью набора критериев. В новом правиле генерации оповещений будет указан целевой ресурс, метрика, разделение и измерения фильтров из диаграммы. Измените эти параметры на [панели создания правила генерации оповещений](/azure/azure-monitor/platform/metrics-charts#create-alert-rules).

## <a name="supported-azure-data-explorer-metrics"></a>Поддерживаемые метрики обозреватель данных Azure

Метрики обозреватель данных Azure дают представление об общей производительности и использовании ресурсов, а также сведения о конкретных действиях, таких как прием или запрос. Метрики в этой статье были сгруппированы по типу использования. 

Ниже приведены типы метрик. 
* [Метрики кластера](#cluster-metrics) 
* [Экспорт метрик](#export-metrics) 
* [Метрики приема](#ingestion-metrics) 
* [Потоковая передача метрик](#streaming-ingest-metrics)
* [Метрики запросов](#query-metrics) 
* [Метрики материализованных представлений](#materialized-view-metrics)

Список метрик Azure Monitor в алфавитном порядке для обозревателей данных Azure см. в разделе [Поддерживаемые метрики кластера azure обозреватель данных](/azure/azure-monitor/platform/metrics-supported#microsoftkustoclusters).

## <a name="cluster-metrics"></a>Метрики кластера

Метрики кластера отписывают общую работоспособность кластера. Например, использование ресурсов и приема и реагирование.

|**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
| Использование кэша | Процент | AVG, Max, min | Процент выделенных ресурсов кэширования, которые сейчас используются кластером. Кэш — это объем диска SSD, выделенный для действий пользователя в соответствии с заданной политикой кэширования. <br> <br> Среднее значение использования кэша, равное 80 % или меньше, считается нормальным состоянием для кластера. Если среднее использование кэша превышает 80%, кластер должен быть <br> [масштабирование](manage-cluster-vertical-scaling.md) до ценовой категории, оптимизированной для хранилища, или <br> [масштабирование](manage-cluster-horizontal-scaling.md) до большего числа экземпляров. Кроме того, можно адаптировать политику кэширования (уменьшить количество дней хранения данных в кэше). Если для использования кэша указано значение больше 100 %, значит объем кэшируемых данных (согласно политике кэширования) превышает общий размер кэша в кластере. | None |
| ЦП | Процент | AVG, Max, min | Процент выделенных вычислительных ресурсов, которые сейчас используются компьютерами в кластере. <br> <br> Средняя загрузка ЦП в 80 % и меньше считается нормальной для кластера. Максимальное значение загрузки ЦП — 100 %. Это означает отсутствие дополнительных вычислительных ресурсов для обработки данных. <br> Если кластер не работает хорошо, проверьте максимальное значение ЦП, чтобы определить, имеются ли заблокированные ЦП. | None |
| Использование приема | Процент | AVG, Max, min | Процент фактических ресурсов, используемых для приема данных, из общего числа ресурсов, выделенных (в рамках политики емкости) для приема. Политика емкости по умолчанию допускает максимум 512 параллельных операций приема или 75 % кластерных ресурсов, задействованных в приеме данных. <br> <br> Среднее значение используемых ресурсов приема, равное 80 % и меньше, считается нормальным состоянием для кластера. Максимальное значение использования ресурсов приема — 100 %. Это означает, что используются все кластерные ресурсы для приема данных и может возникнуть очередь приема. | None |
| Проверка активности | Count | Ср. | Отслеживает скорость реагирования кластера. <br> <br> Если кластер реагирует на запросы, возвращается значение 1. Если же кластер заблокирован или отключен, возвращается значение 0. |
| Общее число регулируемых команд | Счетчик | AVG, Max, min, Sum | Количество регулируемых (отклоненных) команд в кластере, так как достигнуто максимально допустимое число одновременных (параллельных) команд. | None |
| Общее число экстентов | Счетчик | AVG, Max, min, Sum | Общее число экстентов данных в кластере. <br> <br> Изменения в этой метрике могут привести к значительным изменениям в структуре данных и высокой нагрузке в кластере, так как объединение экстентов данных — это активность ЦП. | None |

## <a name="export-metrics"></a>Экспорт метрик

Экспорт метрик позволяет контролировать общую работоспособность и производительность операций экспорта, таких как задержка, результаты, число записей и использование.

|**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
Непрерывное экспортное число экспортированных записей    | Счетчик | Sum | Число экспортированных записей во всех заданиях непрерывного экспорта. | континуаусекспортнаме |
Максимальная длина непрерывного экспорта |    Счетчик   | Max   | Задержку (в минутах), сообщаемую заданиями непрерывного экспорта в кластере. | None |
Число ожидающих непрерывного экспорта | Счетчик | Max   | Число ожидающих заданий непрерывного экспорта. Эти задания готовы к запуску, но ожидают в очереди, возможно, из-за недостаточной емкости. 
Результат непрерывного экспорта    | Count |   Count   | Результат выполнения каждого непрерывного экспорта. | континуаусекспортнаме |
Использование экспорта |    Процент | Max   | Используемая емкость экспорта, из общей емкости экспорта в кластере (от 0 до 100). | None |

## <a name="ingestion-metrics"></a>Метрики приема

Метрики приема записывают общую работоспособность и производительность операций приема, таких как задержка, результаты и объем.

|**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
| Число больших двоичных объектов пакетной службы | Счетчик | AVG, Max, min | Количество источников данных в завершенном пакете для приема. | База данных |
| Длительность пакета | Секунды | AVG, Max, min | Длительность этапа пакетной обработки в потоке приема  | База данных |
| Размер пакета | Байты | AVG, Max, min | Несжатый ожидаемый размер данных в агрегированном пакете для приема. | База данных |
| Обработано пакетов | Счетчик | AVG, Max, min | Количество пакетов, завершенных для приема. `Batching Type`: указывает, достигнут ли пакет времени пакетного режима, размера данных или количества файлов, установленных [политикой пакетной обработки](./kusto/management/batchingpolicy.md). | База данных, тип пакетной обработки |
| Задержка обнаружения | Секунды | AVG, Max, min | Время из очереди данных, пока не будет обнаружено подключение к данным. Это время не включено в **общую длительность приема Kusto** или **Кустоевентаже (задержка приема)** . | База данных, таблица, тип подключения к данным, имя подключения к данным |
| Обработанные события (для концентраторов событий и Центров Интернета вещей) | Count | Max, min, Sum | Общее число событий, считанных из концентраторов событий и обработанных кластером. События разбиваются на события, отклоненные, и на события, принятые ядром кластера. | EventStatus |
| Задержка приема | Секунды | AVG, Max, min | Задержка приема данных (с момента получения данных в кластере до их подготовки к выполнению запроса). Период задержки приема зависит от сценария приема данных. | None |
| Результат приема | Count | Count | Общее число успешно выполненных операций приема. <br> <br> Используйте **разделение Apply** , чтобы создать контейнеры результатов успеха и сбоя и проанализировать измерения**Value**(  >  **состояние**значения).| IngestionResultDetails |
| Объем приема (в МБ) | Count | Max, Sum | Общий объем данных, принимаемых в кластер (в МБ) до сжатия. | База данных |
| Задержка этапа | Секунды | AVG, Max, min | Длительность обработки пакета данных определенным компонентом. Общая задержка этапа для всех компонентов пакета данных равна задержке приема. | База данных, тип подключения к данным, имя подключения к данным|

## <a name="streaming-ingest-metrics"></a>Потоковая передача метрик

Метрики приема потоковой передачи следят за данными приема потоковой передачи и частотой запросов, длительностью и результатами.

|**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
Скорость данных потокового приема |    Count   | RateRequestsPerSecond | Общий объем данных, принимаемых в кластер. | None |
Длительность потокового приема   | Миллисекунды  | AVG, Max, min | Общая длительность всех запросов приема потоковой передачи. | None |
Частота запросов потокового приема   | Count | Счетчик, AVG, Max, min, Sum | Общее число запросов приема потоковой передачи. | None |
Результат потокового приема | Count | Ср.   | Общее число запросов приема потоковой передачи по типу результата. | Результат |

## <a name="query-metrics"></a>Метрики запросов

Метрики производительности запросов записывают длительность запроса и общее число одновременных или регулируемых запросов.

|**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
| Query duration (Длительность запросов) | Миллисекунды | AVG, min, Max, Sum | Общее время до получения результатов запроса (не включает задержку в сети). | QueryStatus |
| Общее число одновременных запросов | Счетчик | AVG, Max, min, Sum | Число запросов, выполняемых параллельно в кластере. Эта метрика является хорошим способом оценки нагрузки на кластер. | None |
| Общее число регулируемых запросов | Счетчик | AVG, Max, min, Sum | Число регулируемых (отклоненных) запросов в кластере. Максимально допустимое число одновременных (параллельных) запросов определяется в политике параллельных запросов. | None |

## <a name="materialized-view-metrics"></a>Метрики материализованных представлений

|**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
|материализедвиевхеалс                    | 1, 0    | Ср.     |  Значение равно 1, если представление считается работоспособным, в противном случае — 0. | База данных, Материализедвиевнаме |
|материализедвиеважеминутес                | Минуты | Ср.     | `age`Представление определяется текущим временем за вычетом последнего времени приема, обработанного представлением. Значение метрики — время в минутах (чем ниже значение, представление — "повышает работоспособность базы"). | База данных, Материализедвиевнаме |
|материализедвиевресулт                    | 1       | Ср.     | Метрика включает `Result` измерение, указывающее результат последнего цикла материализации (см. Возможные значения ниже). Значение метрики всегда равно 1. | База данных, Материализедвиевнаме, результат |
|материализедвиеврекордсинделта            | Число записей | Ср. | Число записей, находящихся в данный момент в необработанной части исходной таблицы. Дополнительные сведения см. в статье [Работа с материализованными представлениями](./kusto/management/materialized-views/materialized-view-overview.md#how-materialized-views-work) .| База данных, Материализедвиевнаме |
|материализедвиевекстентсребуилд            | Число экстентов | Ср. | Число экстентов, перестроенных в цикле материализации. | База данных, Материализедвиевнаме|
|материализедвиевдаталосс                  | 1       | Max    | Метрика создается, когда необработанные исходные данные приближается к хранению. | База данных, Материализедвиевнаме, тип |

## <a name="next-steps"></a>Дальнейшие шаги

* [Учебник. прием и запрос данных мониторинга в Azure обозреватель данных](ingest-data-no-code.md)
* [Monitor Azure Data Explorer ingestion operations using diagnostic logs (Preview)](using-diagnostic-logs.md) (Мониторинг операций приема Azure Data Explorer с помощью журналов диагностики (предварительная версия))
* [Краткое руководство. Запрос данных в обозревателе данных Azure](web-query-data.md)
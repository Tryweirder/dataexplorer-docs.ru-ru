---
title: Мониторинг производительности обозреватель данных Azure, использование & работоспособности с помощью метрик
description: Узнайте, как использовать метрики обозреватель данных Azure для наблюдения за производительностью, работоспособностью и использованием кластера.
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: conceptual
ms.date: 01/19/2020
ms.openlocfilehash: 2b90f029d881c1f050bce4d458f08e9f1ba20ef9
ms.sourcegitcommit: afc369ab4c4bcc74f2dce22b397a340572db8ecf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2020
ms.locfileid: "87528169"
---
# <a name="monitor-azure-data-explorer-performance-health-and-usage-with-metrics"></a>Мониторинг производительности, работоспособности и использования Azure обозреватель данных с помощью метрик

Azure Data Explorer — это быстрая и полностью управляемая служба для аналитики большого объема потоковых данных в реальном времени, поступающих из приложений, а также с веб-сайтов, устройств Интернета вещей и т. д. Чтобы использовать обозреватель данных Azure, сначала нужно создать кластер и одну или несколько баз данных в этом кластере. Затем вы должны принять (загрузить) данные в базы данных, чтобы к ним можно было выполнять запросы. Метрики обозреватель данных Azure предоставляют ключевые индикаторы работоспособности и производительности ресурсов кластера. Используйте метрики, описанные в этой статье, чтобы отслеживать работоспособность и производительность кластера Azure обозреватель данных в конкретном сценарии в качестве отдельных метрик. Вы также можете использовать метрики в качестве базиса для рабочих [панелей мониторинга Azure](/azure/azure-portal/azure-portal-dashboards) и [оповещений Azure](/azure/azure-monitor/platform/alerts-metric-overview).

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас ее нет, можно создать [бесплатную учетную запись Azure](https://azure.microsoft.com/free/).
* [Кластер и база данных](create-cluster-database-portal.md).

## <a name="using-metrics"></a>Использование метрик

1. Войдите на [портал Microsoft Azure](https://portal.azure.com/).
1. В кластере Azure обозреватель данных выберите **метрики** , чтобы открыть панель метрики и начать анализ кластера.
    ![Выберите метрики ](media/using-metrics/select-metrics.png) .
1. На панели метрики: ![ панель метрик](media/using-metrics/metrics-pane.png)
    1. Чтобы создать диаграмму метрики, выберите имя **метрики** и соответствующую **статистическую** функцию для каждой метрики. Для кластера Azure обозреватель данных предварительно выбраны выбранные для **ресурса** и **метрики выборки пространства имен** . Дополнительные сведения о различных метриках см. в статье [Поддерживаемые метрики обозреватель данных Azure](#supported-azure-data-explorer-metrics).
    1. Выберите **Добавить метрику** , чтобы увидеть несколько метрик, построенных на одной диаграмме.
    1. Выберите **+ создать диаграмму** , чтобы увидеть несколько диаграмм в одном представлении.
    1. Для изменения диапазона времени используйте средство выбора времени (по умолчанию — последние 24 часа).
    1. Используйте [ **Добавление фильтра** и **Примените разбиение** ](/azure/azure-monitor/platform/metrics-getting-started#apply-dimension-filters-and-splitting) для метрик, имеющих измерения.
    1. Выберите **закрепить на панели мониторинга** , чтобы добавить конфигурацию диаграммы на панели мониторинга, чтобы ее можно было просмотреть снова.
    1. Задайте **новое правило генерации оповещений** , чтобы визуализировать метрики с помощью набора критериев. В новом правиле генерации оповещений будет указан целевой ресурс, метрика, разделение и измерения фильтров из диаграммы. Измените эти параметры на [панели создания правила генерации оповещений](/azure/azure-monitor/platform/metrics-charts#create-alert-rules).

Дополнительные сведения об использовании [Обозреватель метрик](/azure/azure-monitor/platform/metrics-getting-started).

## <a name="supported-azure-data-explorer-metrics"></a>Поддерживаемые метрики обозреватель данных Azure

Поддерживаемые метрики обозреватель данных Azure разделены на различные категории в соответствии с их использованием. 

### <a name="cluster-health-metrics"></a>Метрики работоспособности кластера

Метрики работоспособности кластера отписывают общую работоспособность кластера. Сюда входит использование ресурсов и приема и реагирование.

**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
| Использование кэша | Процент | AVG, Max, min | Процент выделенных ресурсов кэша, используемых в данный момент кластером. Кэш — это размер SSD, выделенного для действий пользователя в соответствии с заданной политикой кэширования. Среднее использование кэша, равное 80% или меньше, является устойчивым состоянием для кластера. Если среднее использование кэша превышает 80%, кластер следует [масштабировать](manage-cluster-vertical-scaling.md) до ценовой категории, оптимизированной для хранилища, или [масштабировать](manage-cluster-horizontal-scaling.md) до большего количества экземпляров. Кроме того, можно адаптировать политику кэширования (меньшее количество дней в кэше). Если использование кэша превышает 100%, размер данных для кэширования в соответствии с политикой кэширования превышает общий размер кэша в кластере. | None |
| ЦП | Процент | AVG, Max, min | Процент выделенных ресурсов вычислений, которые сейчас используются компьютерами в кластере. Средняя загрузка ЦП в 80% или менее является устойчивой для кластера. Максимальное значение ЦП — 100%, что означает отсутствие дополнительных вычислительных ресурсов для обработки данных. Если кластер не работает хорошо, проверьте максимальное значение ЦП, чтобы определить, имеются ли заблокированные ЦП. | None |
| Использование приема | Процент | AVG, Max, min | Процент фактических ресурсов, используемых для приема данных из общего числа выделенных ресурсов в политике емкости для выполнения приема. Политика емкости по умолчанию составляет не более 512 параллельных операций приема или 75% ресурсов кластера, вложенных в прием. Среднее использование приема, равное 80% или меньше, является устойчивым состоянием для кластера. Максимальное значение использования приема — 100%. Это означает, что используется вся возможность приема кластера и может возникнуть очередь приема. | None |
| Проверка активности | Count | Сред. | Отслеживает скорость реагирования кластера. Полностью реагирующий кластер возвращает значение 1, а заблокированный или отключенный кластер возвращает 0. |
| Общее число регулируемых команд | Count | AVG, Max, min, Sum | Количество регулируемых (отклоненных) команд в кластере, так как достигнуто максимально допустимое число одновременных (параллельных) команд. | None |
| Общее число экстентов | Count | AVG, Max, min, Sum | Общее число экстентов данных в кластере. Изменения в этой метрике могут привести к значительным изменениям в структуре данных и высокой нагрузке в кластере, так как объединение экстентов данных — это активность ЦП. | None |
| | | | |

### <a name="export-health-and-performance-metrics"></a>Экспорт метрик работоспособности и производительности

Экспорт метрик работоспособности и производительности позволяет контролировать общую работоспособность и производительность операций экспорта, таких как задержка, результаты, число записей и использование.

**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
Непрерывное экспортное число экспортированных записей    | Count | Sum | Число экспортированных записей во всех заданиях непрерывного экспорта. | None |
Максимальная длина непрерывного экспорта |    Count   | Максимум   | Задержку (в минутах), сообщаемую заданиями непрерывного экспорта в кластере. | None |
Число ожидающих непрерывного экспорта | Count | Максимум   | Число ожидающих заданий непрерывного экспорта. Эти задания готовы к запуску, но ожидают в очереди, возможно, из-за недостаточной емкости. 
Результат непрерывного экспорта    | Count |   Count   | Результат выполнения каждого непрерывного экспорта. | континуаусекспортнаме |
Использование экспорта |    Процент | Максимум   | Используемая емкость экспорта, из общей емкости экспорта в кластере (от 0 до 100). | None |
| | | | |

### <a name="ingestion-health-and-performance-metrics"></a>Метрики работоспособности приема и производительности

Метрики работоспособности приема и производительности записывают общую работоспособность и производительность операций приема, таких как задержка, результаты и объем.

**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
| Число больших двоичных объектов пакетной службы | Count | AVG, Max, min | Количество источников данных в завершенном пакете для приема. | База данных |
| Длительность пакета | Секунды | AVG, Max, min | Длительность этапа пакетной обработки в потоке приема  | База данных |
| Размер пакета | Байты | AVG, Max, min | Несжатый ожидаемый размер данных в агрегированном пакете для приема. | База данных |
| Обработано пакетов | Count | AVG, Max, min | Количество пакетов, завершенных для приема. `BatchCompletionReason`: Указывает, достигнут ли пакет времени пакетного режима, размера данных или количества файлов, установленных [политикой пакетной обработки](/azure/data-explorer/kusto/management/batchingpolicy). | База данных, Батчкомплетионреасон |
| Обработанные события (для концентраторов событий и Центров Интернета вещей) | Count | Max, min, Sum | Общее число событий, считанных из концентраторов событий и обработанных кластером. События разбиваются на события, отклоненные, и на события, принятые ядром кластера. | EventStatus |
| Задержка приема | Секунды | AVG, Max, min | Задержка приема данных с момента получения данных в кластере до их подготовки к выполнению запроса. Период задержки приема зависит от сценария приема. | None |
| Результат приема | Count | Count | Общее число успешно выполненных операций приема. Используйте **разделение Apply** , чтобы создать контейнеры результатов успеха и сбоя и проанализировать измерения**Value**(  >  **состояние**значения).| IngestionResultDetails |
| Объем приема (в МБ) | Count | Max, Sum | Общий объем данных, принимаемых в кластер (в МБ) до сжатия. | База данных |
| | | | |  

### <a name="query-performance"></a>Производительность запросов

Метрики производительности запросов записывают длительность запроса и общее число одновременных или регулируемых запросов.

**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
| Query duration (Длительность запросов) | Миллисекунды | AVG, min, Max, Sum | Общее время до получения результатов запроса (не включает задержку в сети). | QueryStatus |
| Общее число одновременных запросов | Count | AVG, Max, min, Sum | Число запросов, выполняемых параллельно в кластере. Эта метрика является хорошим способом оценки нагрузки на кластер. | None |
| Общее число регулируемых запросов | Count | AVG, Max, min, Sum | Число регулируемых (отклоненных) запросов в кластере. Максимально допустимое число одновременных (параллельных) запросов определяется в политике параллельных запросов. | None |
| | | | |

### <a name="streaming-ingest-metrics"></a>Потоковая передача метрик

Метрики приема потоковой передачи следят за данными приема потоковой передачи и частотой запросов, длительностью и результатами.

**Метрика** | **Единица измерения** | **Статистической обработки** | **Описание метрики** | **Измерения** |
|---|---|---|---|---|
Скорость данных потокового приема |    Count   | RateRequestsPerSecond | Общий объем данных, принимаемых в кластер. | None |
Длительность потокового приема   | Миллисекунды  | AVG, Max, min | Общая длительность всех запросов приема потоковой передачи. | None |
Частота запросов потокового приема   | Count | Счетчик, AVG, Max, min, Sum | Общее число запросов приема потоковой передачи. | None |
Результат потокового приема | Count | Сред.   | Общее число запросов приема потоковой передачи по типу результата. | Возвращаемый результат |
| | | | |

Дополнительные сведения о [поддерживаемых метриках кластера Azure обозреватель данных](/azure/azure-monitor/platform/metrics-supported#microsoftkustoclusters).


## <a name="next-steps"></a>Дальнейшие действия

* [Учебник. прием и запрос данных мониторинга в Azure обозреватель данных](ingest-data-no-code.md)
* [Monitor Azure Data Explorer ingestion operations using diagnostic logs (Preview)](using-diagnostic-logs.md) (Мониторинг операций приема Azure Data Explorer с помощью журналов диагностики (предварительная версия))
* [Краткое руководство. Запрос данных в обозревателе данных Azure](web-query-data.md)

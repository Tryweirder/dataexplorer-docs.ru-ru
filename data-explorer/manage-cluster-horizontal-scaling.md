---
title: Управление горизонтальным масштабированием кластера (масштабирование) в соответствии со спросом в Azure Data Explorer
description: В этой статье описаны шаги по масштабу и масштабирования в кластере Azure Data Explorer на основе изменения спроса.
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: conceptual
ms.date: 12/09/2019
ms.openlocfilehash: ff7420619cffc2287ab8ff6332df605d56329549
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81502287"
---
# <a name="manage-cluster-horizontal-scaling-scale-out-in-azure-data-explorer-to-accommodate-changing-demand"></a>Управление горизонтальным масштабированием кластера (масштабирование) в Azure Data Explorer для удовлетворения меняющегося спроса

Изменение размера кластера соответствующим образом очень важно для обеспечения производительности обозревателя данных Azure. Статический размер кластера может привести к недостаточной или чрезмерной нагрузке, и ни одна из этих ситуаций не является оптимальной. Поскольку спрос на кластер невозможно предсказать с абсолютной точностью, лучше *масштабировать* кластер, добавляя и удаляя емкость и ресурсы процессора с изменением спроса. 

Для масштабирования кластера Azure Data Explorer есть два рабочих процесса: 
* Горизонтальное масштабирование, также называемое масштабированием в и из.
* [Вертикальное масштабирование,](manage-cluster-vertical-scaling.md)также называемое масштабированием вверх и вниз.
В этой статье объясняется горизонтальный рабочий процесс масштабирования.

## <a name="configure-horizontal-scaling"></a>Настройка горизонтального масштабирования

Используя горизонтальное масштабирование, можно автоматически масштабировать количество экземпляров на основе заранее определенных правил и расписаний. Чтобы указать параметры автоматической шкалы для кластера:

1. На портале Azure перейдите на ресурс кластера Azure Data Explorer. В **настройках**выберите **Масштабирование.** 

2. В окне **масштабирования** выберите нужный метод автоматического масштаба: **Ручная шкала,** **Оптимизированная автомасштабная**шкала или **пользовательский автомасштаб.**

### <a name="manual-scale"></a>Ручное масштабирование

Ручная шкала — это параметр по умолчанию при создании кластера. Кластер имеет статическую емкость, которая не изменяется автоматически. Вы выбираете статическую емкость с помощью панели **подсчета экземпляров.** Масштабирование кластера остается в этом параметре до тех пор, пока вы не внесете еще одно изменение.

   ![Метод ручного масштаба](media/manage-cluster-horizontal-scaling/manual-scale-method.png)

### <a name="optimized-autoscale-preview"></a>Оптимизированная автомасштабная шкала (предварительный просмотр)

Оптимизированный автомасштаб является рекомендуемым методом автомасштабирования. Этот метод оптимизирует производительность кластера и затраты. Если кластер приближается к состоянию недостаточного использования, он будет масштабироваться. Это действие снижает затраты, но сохраняет уровень производительности. Если кластер приближается к состоянию чрезмерного использования, он будет масштабирован для поддержания оптимальной производительности. Для настройки оптимизированной автошкалы:

1. Выберите **оптимизированную автомасштаб.** 

1. Выберите минимальное количество экземпляров и максимальное количество экземпляров. Кластерное автоматическое масштабирование колеблется между этими двумя числами, в зависимости от нагрузки.

1. Щелкните **Сохранить**.

   ![Оптимизированный метод автомасштаба](media/manage-cluster-horizontal-scaling/optimized-autoscale-method.png)

Оптимизированная автомасштабия начинает работать. Его действия теперь видны в журнале активности Azure кластера.

#### <a name="logic-of-optimized-autoscale"></a>Логика оптимизированного автомасштаба 

**Масштабирование**

Когда кластер приближается к состоянию чрезмерного использования, масштабируйте для поддержания оптимальной производительности. Масштабирование будет происходить, когда:
* Количество экземпляров кластера ниже максимального количества экземпляров, определяемого пользователем.
* Использование кэша является высоким в течение более часа.
* Процессор высок в течение часа.
* Использование приема является высоким в течение более часа.

> [!NOTE]
> Логика масштабирования в настоящее время не учитывает метрику использования. Если эта метрика важна для случая использования, используйте [пользовательский автомасштаб.](#custom-autoscale)

**Свертывание**

Когда кластер приближается к состоянию недостаточного использования, масштабируйте, чтобы снизить затраты, но сохранить производительность. Несколько метрик используются для проверки того, что масштабирование безопасно в кластере. Следующие правила оцениваются ежечасно в течение 6 часов до масштабирования:
* Число экземпляров превышает 2 и превышает минимальное количество определенных экземпляров.
* Чтобы убедиться в отсутствии перегрузки ресурсов, необходимо проверить следующие метрики перед выполнением масштабирования: 
    * Использование кэша не является высоким
    * Процессор ниже среднего 
    * Использование заглатования ниже среднего 
    * Потоковое использование глотатель (если используется потоковое глотание) не является высоким
    * Сохранить живые события выше определенного минимума, обрабатываются должным образом, и вовремя.
    * Нет регулирования запроса 
    * Количество неудавшихся запросов ниже определенного минимума.

> [!NOTE]
> Шкала в логике в настоящее время требует 7-дневной оценки до внедрения оптимизированного масштаба дюйма Эта оценка проводится один раз в 24 часа. Если требуется быстрое изменение, используйте [ручную шкалу.](#manual-scale)

### <a name="custom-autoscale"></a>Пользовательские автомасштабы

С помощью пользовательского автомасштаба можно динамически масштабировать кластер на основе указанных показателей. На следующем графике показан поток и шаги для настройки пользовательского автомасштаба. Более подробная информация ниже графика.

1. В поле **настройки автоматического параметра** введите имя, такое как *масштабирование: использование кэша.* 

   ![Правило масштабирования](media/manage-cluster-horizontal-scaling/custom-autoscale-method.png)

2. Для **режима масштабирования**выберите **шкалу на основе метрики.** Этот режим обеспечивает динамическое масштабирование. Вы также можете выбрать **шкалу для определенного количества экземпляров.**

3. Выберите **правило : Добавить правило**.

4. В разделе **правило шкалы** справа введите значения для каждого параметра.

    **Критерии**

    | Параметр | Описание и значение |
    | --- | --- |
    | **Агрегация времени** | Выберите условия агрегирования, например **Среднее**. |
    | **Имя метрики** | Выберите метрику для операции масштабирования, например **Cache Utilization**. |
    | **Статистика интервала времени** | Выберите одно из значений: **Среднее**, **Минимум**, **Максимум** и **Сумма**. |
    | **Оператор** | Выберите нужный параметр, например **Больше или равно**. |
    | **Порог** | Выберите соответствующее значение. Например, для использования кэша 80 процентов является хорошей отправной точкой. |
    | **Продолжительность (в минутах)** | Выберите период времени, используемый системой при вычислении метрик. Начните со значения по умолчанию, равного 10 минутам. |
    |  |  |

    **Действие**

    | Параметр | Описание и значение |
    | --- | --- |
    | **Операция** | Выберите соответствующий параметр для свертывания или горизонтального масштабирования. |
    | **Количество экземпляров** | Выберите количество узлов или экземпляров, которые требуется добавить или удалить при выполнении условий метрики. |
    | **Охладите вниз (минуты)** | Выберите интервал времени ожидания между операциями масштабирования. Начните со значения по умолчанию, равного 5 минутам. |
    |  |  |

5. Выберите **Добавить**.

6. В разделе **пределов инстанции** слева введите значения для каждого параметра.

    | Параметр | Описание и значение |
    | --- | --- |
    | **Минимальный** | Число экземпляров в кластере, поддерживаемое вне зависимости от уровня использования. |
    | **Максимальная** | Число экземпляров в кластере, поддерживаемое в зависимости от уровня использования. |
    | **Значение по умолчанию** | Число экземпляров по умолчанию. Этот параметр используется при наличии проблем с чтением метрик ресурсов. |
    |  |  |

7. Щелкните **Сохранить**.

Теперь вы настроили горизонтальное масштабирование для кластера Azure Data Explorer. Добавьте еще одно правило для вертикального масштабирования. Если вам нужна помощь в проблемах кластерного масштабирования, [откройте запрос на поддержку](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview) на портале Azure.

## <a name="next-steps"></a>Следующие шаги

* [Мониторинг производительности, работоспособности и использования Azure Data Explorer с помощью метрик](using-metrics.md)
* [Управление вертикальным масштабированием кластера](manage-cluster-vertical-scaling.md) для соответствующего размера кластера.

---
title: Прием из центра Интернета вещей в Azure обозреватель данных | Документация Майкрософт
description: В этой статье описывается прием из центра Интернета вещей в Azure обозреватель данных.
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: how-to
ms.date: 08/13/2020
ms.openlocfilehash: 8a009c82f787dac0bd4a86209b07ffc14d9ec8cf
ms.sourcegitcommit: f354accde64317b731f21e558c52427ba1dd4830
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88874874"
---
# <a name="connect-to-iot-hub"></a>Подключение к Центру Интернета вещей

[Центр Интернета вещей Azure](https://docs.microsoft.com/azure/iot-hub/about-iot-hub) — это управляемая служба, размещенная в облаке, которая выступает в качестве центрального центра сообщений для двунаправленного обмена данными между приложением IOT и управляемыми ими устройствами. Azure обозреватель данных обеспечивает непрерывный прием от управляемых клиентами центров Интернета вещей, используя [встроенную конечную точку, совместимую с концентратором событий](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-d2c#routing-endpoints).

Конвейер приема Интернета вещей проходит через несколько шагов. Сначала вы создадите центр Интернета вещей и зарегистрируете устройство в этом центре Интернета вещей. Затем вы создадите целевую таблицу обозреватель данных Azure, в которую будут поступать [данные в определенном формате](#data-format), используя заданные [Свойства приема](#set-ingestion-properties). Подключению центра Интернета вещей необходимо сообщить о [событиях маршрутизации](#set-events-routing) для подключения к таблице Azure обозреватель данных. Данные внедряются с выбранными свойствами в соответствии с [сопоставлением свойств системы событий](#set-event-system-properties-mapping). Этим процессом можно управлять с помощью [портал Azure](ingest-data-iot-hub.md), программно с помощью [C#](data-connection-iot-hub-csharp.md) или [Python](data-connection-iot-hub-python.md)или с помощью [шаблона Azure Resource Manager](data-connection-iot-hub-resource-manager.md).


## <a name="create-iot-hub-connection"></a>Создание подключения центра Интернета вещей

> [!Note]
> Для лучшей производительности создайте все ресурсы в том же регионе, что и кластер Azure обозреватель данных.

[Создайте центр Интернета вещей](ingest-data-iot-hub.md#create-an-iot-hub), если у вас его еще нет.

> [!Note]
> * `device-to-cloud partitions`Число не изменяется, поэтому при задании числа секций следует учитывать долгосрочное масштабирование.
> * Группа потребителей должна быть уникальной для каждого потребителя. Создайте группу потребителей, выделенную для подключения к Azure обозреватель данных. Найдите ресурс в портал Azure и перейдите к нему, чтобы `Built-in endpoints` Добавить новую группу потребителей.

## <a name="data-format"></a>Формат данных

* Данные считываются из конечной точки концентратора событий в форме объектов [EVENTDATA](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.eventdata?view=azure-dotnet) .
* Полезные данные события могут быть в одном из [форматов, поддерживаемых обозреватель данных Azure](ingestion-supported-formats.md).
* См. раздел [Поддерживаемые сжатия](ingestion-supported-formats.md#supported-data-compression-formats).
  Исходный размер несжатых данных должен быть частью метаданных большого двоичного объекта, иначе Azure обозреватель данных выполнит оценку. Ограничение размера несжатого приема на файл составляет 4 ГБ.  

## <a name="set-ingestion-properties"></a>Задание свойств приема

Свойства приема указывают на процесс приема. Где можно направить данные и как обработать их. [Свойства приема](ingestion-properties.md) событий можно указать с помощью свойства [EVENTDATA. Properties](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.eventdata.properties?view=azure-dotnet#Microsoft_ServiceBus_Messaging_EventData_Properties). Задать можно следующие свойства.

|Свойство |Описание|
|---|---|
| Таблица | Имя существующей целевой таблицы (с учетом регистра). Переопределяет `Table` набор в `Data Connection` колонке. |
| Формат | Формат данных. Переопределяет `Data format` набор в `Data Connection` колонке. |
| инжестионмаппингреференце | Имя существующего [сопоставления приема](kusto/management/create-ingestion-mapping-command.md) , которое будет использоваться. Переопределяет `Column mapping` набор в `Data Connection` колонке.|
| Кодирование |  Кодировка данных, значение по умолчанию — UTF8. Может быть любой из [поддерживаемых кодировок .NET](https://docs.microsoft.com/dotnet/api/system.text.encoding?view=netframework-4.8#remarks). |

## <a name="set-events-routing"></a>Настройка маршрутизации событий

При настройке подключения центра Интернета вещей к кластеру Azure обозреватель данных необходимо указать свойства целевой таблицы (имя таблицы, формат данных и сопоставление). Это маршрутизация по умолчанию для данных, которая также называется статической маршрутизацией.
Можно также указать свойства целевой таблицы для каждого события с помощью свойств события. Соединение будет динамически маршрутизировать данные, как указано в [свойствах EVENTDATA. Properties](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.eventdata.properties?view=azure-dotnet#Microsoft_ServiceBus_Messaging_EventData_Properties), переопределяя статические свойства для этого события.

> [!Note]
> Если в **данные включены сведения о маршрутизации** , необходимо предоставить необходимые сведения о маршрутизации как часть свойств событий.

## <a name="set-event-system-properties-mapping"></a>Настройка сопоставления свойств системы событий

Системные свойства — это коллекция, используемая для хранения свойств, заданных службой центров Интернета вещей, на момент получения события. Подключение центра Интернета вещей Azure обозреватель данных внедряет выбранные свойства в целевую таблицу данных в таблице.

> [!Note]
> Для `csv` сопоставления свойства добавляются в начало записи в порядке, указанном в таблице ниже. Для `json` сопоставления свойства добавляются в соответствии с именами свойств, приведенными в следующей таблице.

### <a name="iot-hub-exposes-the-following-system-properties"></a>Центр Интернета вещей предоставляет следующие свойства системы:

|Свойство |Описание|
|---|---|
| message-id | Задаваемый пользователем идентификатор сообщения, используемый для шаблонов типа "запрос-ответ". |
| sequence-number | Число (уникальное для каждой очереди устройства), которое Центр Интернета вещей назначает каждому сообщению, отправленному из облака на устройство. |
| значение | Место назначения, которое указывается в сообщениях, отправляемых из облака на устройство . |
| absolute-expiry-time | Дата и время истечения срока действия сообщения. |
| iothub-enqueuedtime | Дата и время получения сообщения, отправленного с устройства в облако, Центром Интернета вещей. |
| correlation-id| Строковое свойство в сообщении ответа, которое обычно содержит идентификатор сообщения запроса в шаблонах "запрос-ответ". |
| user-id| Идентификатор, используемый для указания источника сообщений. |
| iothub-ack| Генератор отзывов на сообщения. |
| iothub-connection-device-id| Центр Интернета вещей устанавливает этот идентификатор в сообщениях, отправляемых с устройства в облако. Содержит идентификатор deviceId устройства, отправившего сообщение. |
| iothub-connection-auth-generation-id| Центр Интернета вещей устанавливает этот идентификатор в сообщениях, отправляемых с устройства в облако. Содержит идентификатор generationId устройства, с которого было отправлено сообщение (согласно разделу Свойства удостоверений устройств). |
| iothub-connection-auth-method| Центр Интернета вещей устанавливает этот метод проверки подлинности в сообщениях, отправляемых с устройства в облако. Это свойство содержит сведения о методе проверки подлинности, используемом для аутентификации устройства, отправляющего сообщение. |

Если в разделе **источника данных** таблицы были выбраны **Свойства системы событий** , необходимо включить свойства в схему таблицы и сопоставление.

### <a name="examples"></a>Примеры 

#### <a name="table-schema-example"></a>Пример схемы таблицы

Если данные содержат три столбца ( `Timespan` , `Metric` и `Value` ), а включаемые свойства — `x-opt-enqueued-time` и `x-opt-offset` , создайте или измените схему таблицы с помощью следующей команды:

```kusto
    .create-merge table TestTable (TimeStamp: datetime, Metric: string, Value: int, EventHubEnqueuedTime:datetime, EventHubOffset:long)
```

#### <a name="csv-mapping-example"></a>Пример сопоставления CSV

Выполните следующие команды, чтобы добавить данные в начало записи. Обратите внимание на порядковые значения: свойства добавляются в начало записи в порядке, указанном в таблице выше. Это важно для сопоставления CSV, при котором порядковые номера столбцов изменятся на основе сопоставленных системных свойств.

```kusto
    .create table TestTable ingestion csv mapping "CsvMapping1"
    '['
    '   { "column" : "Timespan", "Properties":{"Ordinal":"2"}},'
    '   { "column" : "Metric", "Properties":{"Ordinal":"3"}},'
    '   { "column" : "Value", "Properties":{"Ordinal":"4"}},'
    '   { "column" : "EventHubEnqueuedTime", "Properties":{"Ordinal":"0"}},'
    '   { "column" : "EventHubOffset", "Properties":{"Ordinal":"1"}}'
    ']'
```
 
#### <a name="json-mapping-example"></a>Пример сопоставления JSON

Данные добавляются с помощью имен системных свойств, которые отображаются в списке **системных свойств событий** в колонке **подключения к данным** . Выполните следующие команды:

```kusto
    .create table TestTable ingestion json mapping "JsonMapping1"
    '['
    '    { "column" : "Timespan", "Properties":{"Path":"$.timestamp"}},'
    '    { "column" : "Metric", "Properties":{"Path":"$.metric"}},'
    '    { "column" : "Value", "Properties":{"Path":"$.metric_value"}},'
    '    { "column" : "EventHubEnqueuedTime", "Properties":{"Path":"$.x-opt-enqueued-time"}},'
    '    { "column" : "EventHubOffset", "Properties":{"Path":"$.x-opt-offset"}}'
    ']'
```

### <a name="generate-data"></a>Создание данных

* См. [Пример проекта](https://github.com/Azure-Samples/azure-iot-samples-csharp/tree/master/iot-hub/Quickstarts/simulated-device) , который имитирует устройство и создает данные.

## <a name="next-steps"></a>Дальнейшие действия

Существует несколько методов приема данных в центре Интернета вещей. Пошаговые руководства для каждого метода см. по следующим ссылкам.

* [Прием данных из центра Интернета вещей в Azure обозреватель данных](ingest-data-iot-hub.md)
* [Создание подключения к данным центра Интернета вещей для Azure обозреватель данных с помощью C# (Предварительная версия)](data-connection-iot-hub-csharp.md)
* [Создание подключения к данным центра Интернета вещей для Azure обозреватель данных с помощью Python (Предварительная версия)](data-connection-iot-hub-python.md)
* [Создание подключения к данным центра Интернета вещей для Azure обозреватель данных с помощью шаблона Azure Resource Manager](data-connection-iot-hub-resource-manager.md)
